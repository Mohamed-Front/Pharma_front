import{_ as G,i as Q,u as U,j as W,r as m,w as X,d as Y,a5 as Z,o as i,c as n,k as l,z as u,v as N,m as r,y as $,t as v,F as A,x as C,B as I,J as S,s as F,K as T,L as ee,D as B,M as j,N as ae,l as L,S as te,q as se,O as re}from"./index-d45c326e.js";const le={class:"min-h-screen bg-gray-100 flex justify-center items-start p-4"},oe={class:"w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden"},ie=["aria-selected"],ne=["aria-selected"],de=["id"],ce={key:0,class:"flex justify-end mb-4"},ue={key:1,class:"flex flex-col items-center justify-center h-64 text-gray-500"},_e={class:"text-lg"},me={key:2,class:"space-y-4"},ve={class:"flex justify-between items-start p-4"},pe={key:3,class:"space-y-4"},ge=["onClick","aria-label"],fe={class:"flex justify-between items-center"},he={class:"flex-1 min-w-0"},ye=["aria-label"],xe={class:"items-center mx-4"},ke={class:"text-gray-400 text-sm flex-shrink-0"},be={key:0,class:"mt-2 text-xs text-gray-500"},we={key:4,class:"flex flex-col items-center justify-center h-64 text-gray-500"},$e={class:"text-lg"},De={__name:"index",setup(Ne){const M=Q(),{t:s}=U(),x=W(),f=m(!0),h=m(null),D=()=>({data:[],total:0,unread_count:0,current_page:1,last_page:1}),c=m(D()),p=m(D()),y=m(D()),o=m(0),R=m([]),k=m(1),P=m(10),V=e=>{if(!e)return"";const a=new Date,d=new Date(e),t=Math.floor((a-d)/(1e3*60)),_=Math.floor(t/60);return _>0?`${s("since")||"since"} ${_} ${s("hours_ago")||"hours ago"}`:t>0?`${s("since")||"since"} ${t} ${s("minutes_ago")||"minutes ago"}`:s("just_now")||"just now"},q=e=>{const a=d=>{const t=e[d]||{},_=t.data||[];return{data:_,total:t.total||0,unread_count:_.filter(g=>!g.read_at).length,current_page:t.current_page||1,last_page:t.last_page||1}};c.value=a("admin_notifications"),p.value=a("pharmacy_notifications"),y.value=a("warehouse_notifications")},E=()=>{let e;switch(o.value){case 0:e=c.value;break;case 1:e=p.value;break;case 2:e=y.value;break;default:e=D()}R.value=e.data,k.value=e.current_page},b=async(e=1)=>{f.value=!0,h.value=null;try{const a=await I.get(`/api/notification/get?page=${e}&per_page=${P.value}`);f.value=!1,q(a.data.data),E()}catch(a){f.value=!1,h.value=a.message||s("notification.loadError")||"Failed to load notifications.",x.add({severity:"error",summary:s("error"),detail:h.value,life:3e3}),console.error("Error fetching data:",a)}},O=async e=>{if(!e.read_at)try{await I.post(`/api/notification/read/${e.id}`),e.read_at=new Date().toISOString(),c.value.unread_count=c.value.data.filter(a=>!a.read_at).length,p.value.unread_count=p.value.data.filter(a=>!a.read_at).length,y.value.unread_count=y.value.data.filter(a=>!a.read_at).length,x.add({severity:"success",summary:s("success"),detail:s("notification.markedRead")||"Notification marked as read.",life:1500})}catch(a){x.add({severity:"error",summary:s("error"),detail:s("notification.markAsReadError")||"Failed to mark notification as read.",life:3e3}),console.error("Error marking notification as read:",a)}},z=async()=>{f.value=!0;try{const e=o.value===0?"admin":o.value===1?"pharmacy":o.value===2?"warehouse":null;if(!e)return;await I.post(`/api/notification/read-all?type=${e}`);const a=e==="admin"?c:e==="pharmacy"?p:y;a.value.data.forEach(d=>d.read_at=d.read_at||new Date().toISOString()),a.value.unread_count=0,x.add({severity:"success",summary:s("success"),detail:s("notification.markedAllRead")||"All notifications marked as read.",life:3e3}),b(k.value)}catch(e){x.add({severity:"error",summary:s("error"),detail:s("notification.markAllReadError")||"Failed to mark all notifications as read.",life:3e3}),console.error("Error marking all notifications as read:",e)}finally{}},H=e=>{var d,t,_;O(e);const a=e.redirect_id||((d=e.metadata)==null?void 0:d[e.redirect_type.split("_")[0]+"_id"]);if(e.type==="pharmacy")if(e.redirect_type==="order_comment"){const g=(t=e.metadata)==null?void 0:t.order_id,w=(_=e.metadata)==null?void 0:_.comment_id;g&&w?M.push({name:"order_show",params:{id:g},query:{comment_id:w}}):console.warn("Pharmacy Comment Notification is missing required metadata.")}else e.redirect_type==="order_created"&&a?M.push({name:"order_show",params:{id:a}}):console.log(`Pharmacy notification type ${e.redirect_type} not handled yet. Redirect ID: ${a}`);else console.log(`Default redirect for ${e.type} notification type: ${e.redirect_type}, ID: ${a}`)},J=e=>{o.value=e.index,b(1)},K=e=>{const a=e.page+1;k.value=a,b(a)};return X(o,E),Y(()=>{b()}),(e,a)=>{const d=Z("tooltip");return i(),n("div",le,[l("div",oe,[u(r(ee),{"active-index":o.value,onTabChange:J,class:"bg-gradient-to-r from-[#43A167] to-[#8fd3a9]",role:"tablist"},{default:N(()=>[u(r(S),null,{header:N(()=>[l("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":o.value===0,"aria-controls":"admin-notifications"},[a[1]||(a[1]=l("i",{class:"pi pi-user text-xl"},null,-1)),l("span",null,v(r(s)("notifications.admin_messages")||"Admin Messages"),1),c.value.unread_count>0?(i(),F(r(T),{key:0,value:c.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):$("",!0)],8,ie)]),_:1}),u(r(S),null,{header:N(()=>[l("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":o.value===1,"aria-controls":"pharmacy-notifications"},[a[2]||(a[2]=l("i",{class:"pi pi-building text-xl"},null,-1)),l("span",null,v(r(s)("notifications.pharmacy_notes")||"Pharmacy Notes"),1),p.value.unread_count>0?(i(),F(r(T),{key:0,value:p.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):$("",!0)],8,ne)]),_:1})]),_:1},8,["active-index"]),l("div",{class:"p-6 bg-gray-50 min-h-[400px]",id:o.value===0?"admin-notifications":o.value===1?"pharmacy-notifications":"warehouse-notifications",role:"tabpanel"},[o.value===0&&c.value.total>0&&!f.value&&!h.value?(i(),n("div",ce,[u(r(B),{label:r(s)("mark_all_read")||"Mark All As Read",icon:"pi pi-check-double",severity:"success",outlined:"",onClick:z,disabled:c.value.unread_count===0,class:"text-sm"},null,8,["label","disabled"])])):$("",!0),h.value?(i(),n("div",ue,[a[3]||(a[3]=l("i",{class:"pi pi-exclamation-triangle text-5xl mb-4 opacity-50"},null,-1)),l("p",_e,v(h.value),1),u(r(B),{label:r(s)("retry")||"Retry",icon:"pi pi-refresh",class:"mt-4",onClick:a[0]||(a[0]=t=>b(k.value))},null,8,["label"])])):f.value?(i(),n("div",me,[(i(),n(A,null,C(5,t=>u(r(ae),{key:t,class:"shadow-md rounded-lg"},{content:N(()=>[l("div",ve,[u(r(j),{width:"60%",height:"1.5rem",class:"rounded"}),u(r(j),{width:"15%",height:"1rem",class:"rounded"})]),u(r(j),{width:"90%",height:"1rem",class:"mt-2 mx-4 rounded"})]),_:1})),64))])):R.value.length>0?(i(),n("div",pe,[(i(!0),n(A,null,C(R.value,(t,_)=>(i(),n("div",{key:t.id,class:L(["notification-item p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer",{"bg-blue-50 border-l-4 border-[#43A167]":!t.read_at}]),onClick:g=>H(t),role:"button","aria-label":t.title||r(s)("no_title")},[l("div",fe,[l("div",he,[l("div",{class:L(["font-semibold text-lg truncate",{"text-gray-900":!t.read_at,"text-gray-500":t.read_at}])},v(t.title||r(s)("no_title")),3)]),o.value===0&&!t.read_at?te((i(),n("i",{key:0,"aria-label":r(s)("mark_read")||"Mark as Read",class:"pi pi-check"},null,8,ye)),[[d,r(s)("mark_read")||"Mark as Read",void 0,{top:!0}]]):$("",!0),l("div",xe,[l("p",ke,v(V(t.created_at)),1)])]),l("div",{class:L(["mt-2 text-sm leading-relaxed",{"text-gray-700":!t.read_at,"text-gray-500":t.read_at}])},v(t.body||r(s)("no_body")),3),t.metadata?(i(),n("div",be,[(i(!0),n(A,null,C(t.metadata,(g,w)=>(i(),n("span",{key:w},[se(v(w)+": "+v(g),1),a[4]||(a[4]=l("br",null,null,-1))]))),128))])):$("",!0)],10,ge))),128)),u(r(re),{rows:P.value,totalRecords:o.value===0?c.value.total:o.value===1?p.value.total:y.value.total,first:(k.value-1)*P.value,onPage:K,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink"},null,8,["rows","totalRecords","first"])])):(i(),n("div",we,[a[5]||(a[5]=l("i",{class:"pi pi-bell-slash text-5xl mb-4 opacity-50"},null,-1)),l("p",$e,v(r(s)("notification.noData")||"No notifications in this section."),1)]))],8,de)])])}}},Pe=G(De,[["__scopeId","data-v-a061f7ef"]]);export{Pe as default};
