import{_ as O,u as A,j as I,r as m,g as W,w as z,d as D,o,c as d,k as s,t as u,m as n,z as _,F as j,x as P,v as S,y as h,s as T,l as V,B,H as M,E as q,D as b,A as H}from"./index-800b62dc.js";const Q={class:"bg-gray-50 min-h-screen"},R={class:"py-10 px-4 max-w-7xl mx-auto"},G={class:"text-2xl md:text-3xl font-bold text-gray-900 mb-8 text-center"},J={class:"flex justify-center mb-8"},K={class:"relative w-full max-w-lg"},X={key:0,class:"flex justify-center mb-10"},Y={key:1,class:"text-center text-gray-500 py-10"},Z={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10"},ee={class:"flex justify-between"},ae={class:"flex justify-between items-start mb-2"},se={class:"bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-full"},te={class:"text-lg md:text-xl font-bold text-gray-900"},re={class:"text-sm text-gray-600"},le=["src","alt"],oe={class:"flex items-center gap-2 my-3"},ne={class:"text-sm text-gray-700"},ie={class:"text-sm text-gray-700"},de={class:"flex flex-wrap gap-2 mb-4"},ce={class:"flex items-center justify-between w-full mt-auto mb-4"},ue={key:0,class:"bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full"},ge={class:"text-lg md:text-xl font-bold text-green-600"},fe={key:3,class:"flex justify-center items-center gap-2"},me={key:0,class:"px-4 py-2 text-gray-500"},pe={__name:"offers",setup(ve){const{t:l}=A(),w=I(),p=m([]),c=m(1),i=m(1),y=m(!1),g=m(""),x=m({}),k=m(localStorage.getItem("appLang")||"ar"),L=[{id:0,name_en:"Fallback Product",name_ar:"منتج احتياطي",pharmaceutical_form:"Unknown",scientific_structure:[],discount:"0%",price:0,media:[{url:"/images/fallback-product.jpg"}],warehouse:{name:"Unknown Warehouse",address:"Unknown Address"}}],$=async(r=1)=>{var a;y.value=!0;try{const e=g.value?`search=${encodeURIComponent(g.value)}&`:"",f=await B.get(`/api/pharmacy-home/get/offers?${e}page=${r}`);if(f.data.success){if(p.value=f.data.data.filter(t=>t.product&&t.warehouse).map(t=>{var v,E;return{id:t.id,product_id:t.product.id,name_en:t.product.commercial_name||"Unknown Product",name_ar:t.product.commercial_name||"منتج غير معروف",pharmaceutical_form:t.product.pharmaceutical_form||"Unknown",scientific_structure:t.product.scientific_structure||[],discount:t.discount_type===1?`${t.discount_value}%`:`${t.discount_value} $`,price:parseFloat(t.product.price)||0,media:t.product.media||[{url:"/images/fallback-product.jpg"}],warehouse:{name:((v=t.warehouse)==null?void 0:v.name)||"Unknown Warehouse",address:((E=t.warehouse)==null?void 0:E.address)||"Unknown Address"}}}),i.value=f.data.pagination.last_page||1,c.value=f.data.pagination.current_page||1,p.value.length===0)throw new Error("No valid products found")}else p.value=L,i.value=1,c.value=1,w.add({severity:"warn",summary:l("warning"),detail:l("error.noOffers"),life:3e3})}catch(e){p.value=L,i.value=1,c.value=1,w.add({severity:"error",summary:l("error"),detail:l("error.fetchOffers"),life:3e3}),console.error("Error fetching offers:",((a=e.response)==null?void 0:a.data)||e.message)}finally{y.value=!1}},N=async r=>{var a;x.value[r]=!0;try{const e=await B.post("/api/cart/add/item",{product_id:r,quantity:1});if(e.data.success)w.add({severity:"success",summary:l("success"),detail:l("cart.addSuccess"),life:3e3});else throw new Error(e.data.message||l("error.addToCart"))}catch(e){w.add({severity:"error",summary:l("error"),detail:e.message||l("error.addToCart"),life:3e3}),console.error("Error adding to cart:",((a=e.response)==null?void 0:a.data)||e.message)}finally{x.value[r]=!1}},U=W(()=>g.value?p.value.filter(r=>(k.value==="en"?r.name_en.toLowerCase():r.name_ar.toLowerCase()).includes(g.value.toLowerCase())||r.scientific_structure.some(a=>a.toLowerCase().includes(g.value.toLowerCase()))):p.value),C=r=>{r>=1&&r<=i.value&&(c.value=r,$(r))},F=r=>{r.target.src="/images/fallback-product.jpg"};return z(g,()=>{c.value=1,$(1)}),D(()=>{$()}),(r,a)=>(o(),d("div",Q,[s("div",R,[s("h1",G,u(n(l)("offers.title")),1),s("div",J,[s("div",K,[_(n(M),{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),placeholder:n(l)("search.placeholder"),class:"w-full p-3 pr-12 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent","aria-label":"Search offers"},null,8,["modelValue","placeholder"]),a[4]||(a[4]=s("i",{class:"pi pi-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500","aria-label":"Search icon"},null,-1))])]),y.value?(o(),d("div",X,[_(n(q),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):!y.value&&U.value.length===0?(o(),d("div",Y,u(n(l)("error.noOffers")),1)):(o(),d("div",Z,[(o(!0),d(j,null,P(U.value,e=>{var f,t;return o(),d("div",{key:e.id,class:"bg-white rounded-xl shadow-md p-4 relative overflow-hidden flex flex-col"},[s("div",ee,[s("div",null,[s("div",ae,[s("span",se,u(n(l)("offers.only")),1)]),s("div",null,[s("h3",te,u(k.value==="en"?e.name_en:e.name_ar),1),s("p",re,u(e.pharmaceutical_form),1)])]),s("div",null,[(t=(f=e.media)==null?void 0:f[0])!=null&&t.url?(o(),d("img",{key:0,src:e.media[0].url,alt:k.value==="en"?e.name_en:e.name_ar,class:"w-16 h-16 object-cover rounded-lg",onError:F},null,40,le)):h("",!0)])]),s("div",oe,[a[5]||(a[5]=s("i",{class:"pi pi-map-marker text-green-600 text-lg"},null,-1)),s("span",ne,u(e.warehouse.name),1),a[6]||(a[6]=s("i",{class:"pi pi-building text-green-600 text-lg"},null,-1)),s("span",ie,u(e.warehouse.address),1)]),s("div",de,[(o(!0),d(j,null,P(e.scientific_structure,v=>(o(),d("span",{key:v,class:"bg-gray-200 text-gray-800 text-xs font-medium px-3 py-1 rounded-full"},u(v),1))),128))]),s("div",ce,[e.discount?(o(),d("span",ue,u(e.discount),1)):h("",!0),s("span",ge,u(e.price)+" $ ",1)]),_(n(b),{label:x.value[e.id]?n(l)("cart.adding"):n(l)("cart.addToCart"),icon:x.value[e.id]?"pi pi-spin pi-spinner ml-2":"pi pi-cart-plus ml-2",class:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 w-full rounded-lg transition-colors flex items-center justify-center",disabled:x.value[e.id],onClick:v=>N(e.product_id),"aria-label":n(l)("cart.addToCart")+" "+(k.value==="en"?e.name_en:e.name_ar)},null,8,["label","icon","disabled","onClick","aria-label"])])}),128))])),!y.value&&i.value>1?(o(),d("div",fe,[_(n(b),{disabled:c.value===1,class:"px-4 py-2 bg-white text-gray-600 rounded-lg shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors disabled:opacity-50","aria-label":"Previous page",onClick:a[1]||(a[1]=e=>C(c.value-1))},{default:S(()=>[...a[7]||(a[7]=[s("i",{class:"pi pi-chevron-right"},null,-1)])]),_:1},8,["disabled"]),(o(!0),d(j,null,P(Math.min(i.value,5),e=>(o(),T(n(b),{key:e,label:e.toString(),class:V([c.value===e?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-100","px-4 py-2 rounded-lg shadow-sm transition-colors"]),onClick:f=>C(e),"aria-label":"Page "+e},null,8,["label","class","onClick","aria-label"]))),128)),i.value>5?(o(),d("span",me,"...")):h("",!0),i.value>5?(o(),T(n(b),{key:1,label:i.value.toString(),class:V([c.value===i.value?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-100","px-4 py-2 rounded-lg shadow-sm transition-colors"]),onClick:a[2]||(a[2]=e=>C(i.value)),"aria-label":"Page "+i.value},null,8,["label","class","aria-label"])):h("",!0),_(n(b),{disabled:c.value===i.value,class:"px-4 py-2 bg-white text-gray-600 rounded-lg shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors disabled:opacity-50","aria-label":"Next page",onClick:a[3]||(a[3]=e=>C(c.value+1))},{default:S(()=>[...a[8]||(a[8]=[s("i",{class:"pi pi-chevron-left"},null,-1)])]),_:1},8,["disabled"])])):h("",!0),_(n(H))])]))}},ye=O(pe,[["__scopeId","data-v-9ed8d983"]]);export{ye as default};
