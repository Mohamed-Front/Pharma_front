import{_ as C,i as O,P as T,j as G,u as L,r as g,w as N,d as M,a5 as R,o as p,c as v,S,k as a,t as f,q as _,z as n,l as c,m as r,y as q,C as z,F as I,B as x,a8 as V,aq as b,H as D,R as P,D as A,A as H}from"./index-d45c326e.js";const J={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},K={class:"text-3xl font-bold text-center mb-8 text-gray-800"},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},W={class:"space-y-2"},X={for:"product",class:"block text-sm font-medium text-gray-700"},Y={class:"space-y-2"},Z={for:"quantity",class:"block text-sm font-medium text-gray-700"},ee={class:"space-y-2"},te={for:"quantity_unit",class:"block text-sm font-medium text-gray-700"},le={class:"space-y-2"},ae={for:"discount_type",class:"block text-sm font-medium text-gray-700"},ie={key:0,class:"space-y-2"},se={for:"discount_value",class:"block text-sm font-medium text-gray-700"},ue={key:0,class:"text-gray-500"},oe={key:1,class:"space-y-2"},de={for:"gift_product_id",class:"block text-sm font-medium text-gray-700"},ne={key:2,class:"space-y-2"},re={for:"gift_quantity",class:"block text-sm font-medium text-gray-700"},fe={class:"space-y-2"},_e={for:"min_limit",class:"block text-sm font-medium text-gray-700"},ce={class:"space-y-2"},me={for:"max_limit",class:"block text-sm font-medium text-gray-700"},pe={class:"space-y-2"},ve={for:"start_date",class:"block text-sm font-medium text-gray-700"},ye={class:"space-y-2"},ge={for:"end_date",class:"block text-sm font-medium text-gray-700"},be={class:"space-y-2 md:col-span-2"},qe={for:"description",class:"block text-sm font-medium text-gray-700"},xe={class:"pt-6 flex justify-center"},Ve={__name:"update",setup($e){const k=O(),$=T(),m=G(),{t:o}=L(),w=g(!1),h=g([]),y=g(!1),e=g({product_id:null,min_limit:null,max_limit:null,quantity:null,quantity_unit:null,discount_type:null,discount_value:null,gift_product_id:null,gift_quantity:null,start_date:null,end_date:null,description:""}),i=g({product_id:!1,quantity:!1,quantity_unit:!1,discount_type:!1,discount_value:!1,gift_product_id:!1,gift_quantity:!1,min_limit:!1,max_limit:!1,start_date:!1,end_date:!1}),j=async()=>{try{const l=await x.get("/api/product");h.value=l.data.data}catch(l){console.error("Error fetching products:",l),m.add({severity:"error",summary:o("error"),detail:o("error_fetching_data"),life:3e3})}},E=async l=>{var t,u;try{const d=(await x.get(`/api/offer/${l}`)).data.data;e.value={product_id:d.product_id,quantity:d.quantity,quantity_unit:d.quantity_unit,discount_type:d.discount_type,discount_value:d.discount_value??null,gift_product_id:d.gift_product_id??null,gift_quantity:d.gift_quantity??null,min_limit:d.min_limit,max_limit:d.max_limit,start_date:((t=d.start_date)==null?void 0:t.split("T")[0])||null,end_date:((u=d.end_date)==null?void 0:u.split("T")[0])||null,description:d.description||""}}catch(s){console.error("Error fetching offer:",s),m.add({severity:"error",summary:o("error"),detail:o("error_fetching_offer"),life:3e3}),k.push({name:"offers"})}};N(()=>e.value.discount_type,l=>{l===3?e.value.discount_value=null:(e.value.gift_product_id=null,e.value.gift_quantity=null)});const F=()=>{if(Object.keys(i.value).forEach(l=>i.value[l]=!1),i.value.product_id=!e.value.product_id,i.value.quantity=e.value.quantity===null||e.value.quantity==="",i.value.quantity_unit=!e.value.quantity_unit,i.value.discount_type=!e.value.discount_type,i.value.min_limit=e.value.min_limit===null||e.value.min_limit==="",i.value.max_limit=e.value.max_limit===null||e.value.max_limit==="",i.value.start_date=!e.value.start_date,i.value.end_date=!e.value.end_date,e.value.discount_type===3?(i.value.gift_product_id=!e.value.gift_product_id,i.value.gift_quantity=e.value.gift_quantity===null||e.value.gift_quantity<=0):i.value.discount_value=e.value.discount_value===null||e.value.discount_value==="",e.value.min_limit!=null&&e.value.max_limit!=null&&e.value.min_limit>e.value.max_limit&&(i.value.max_limit=!0),e.value.quantity!=null&&e.value.min_limit!=null&&e.value.max_limit!=null&&(e.value.quantity<e.value.min_limit||e.value.quantity>e.value.max_limit)&&(i.value.quantity=!0),e.value.discount_type===1&&e.value.discount_value!=null&&(e.value.discount_value<0||e.value.discount_value>100)&&(i.value.discount_value=!0),e.value.discount_type===2&&e.value.discount_value!=null&&e.value.discount_value<0&&(i.value.discount_value=!0),e.value.start_date&&e.value.end_date){const l=new Date(e.value.start_date);new Date(e.value.end_date)<l&&(i.value.end_date=!0,m.add({severity:"error",summary:o("error"),detail:o("end_date_before_start"),life:3e3}))}return!Object.values(i.value).some(Boolean)},B=async()=>{var l,t;if(!F()){m.add({severity:"error",summary:o("error"),detail:o("please_fill_required_fields"),life:3e3});return}w.value=!0;try{const u={...e.value};u.discount_type!==3&&(delete u.gift_product_id,delete u.gift_quantity),u.discount_type===3&&delete u.discount_value,y.value?(await x.put(`/api/offer/${$.params.id}`,u),m.add({severity:"success",summary:o("success"),detail:o("offer_updated"),life:3e3})):(await x.post("/api/offer",u),m.add({severity:"success",summary:o("success"),detail:o("offer_created"),life:3e3})),k.push({name:"offers"})}catch(u){console.error("Error:",u);let s=y.value?o("error_updating_offer"):o("error_creating_offer");if(((l=u.response)==null?void 0:l.status)===422){const d=u.response.data.errors;s=Object.values(d).flat().join(", "),Object.keys(d).forEach(U=>{U in i.value&&(i.value[U]=!0)})}else((t=u.response)==null?void 0:t.status)===500&&(s=o("server_error"));m.add({severity:"error",summary:o("error"),detail:s,life:3e3})}finally{w.value=!1}};return M(()=>{j(),$.params.id&&(y.value=!0,E($.params.id))}),(l,t)=>{const u=R("can");return p(),v(I,null,[S((p(),v("div",J,[a("h1",K,f(l.$t(y.value?"offer.edit_offer":"offer.create_new_offer")),1),a("form",{onSubmit:z(B,["prevent"]),class:"space-y-6"},[a("div",Q,[a("div",W,[a("label",X,[_(f(l.$t("offer.product"))+" ",1),t[12]||(t[12]=a("span",{class:"text-red-500"},"*",-1))]),n(r(V),{filter:"",id:"product",modelValue:e.value.product_id,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value.product_id=s),options:h.value,optionLabel:"commercial_name",optionValue:"id",placeholder:l.$t("offer.select_product"),class:c(["w-full",{"p-invalid":i.value.product_id}])},null,8,["modelValue","options","placeholder","class"])]),a("div",Y,[a("label",Z,[_(f(l.$t("offer.quantity"))+" ",1),t[13]||(t[13]=a("span",{class:"text-red-500"},"*",-1))]),n(r(b),{id:"quantity",modelValue:e.value.quantity,"onUpdate:modelValue":t[1]||(t[1]=s=>e.value.quantity=s),useGrouping:!1,min:0,placeholder:l.$t("offer.enter_quantity"),class:c(["w-full",{"p-invalid":i.value.quantity}])},null,8,["modelValue","placeholder","class"])]),a("div",ee,[a("label",te,[_(f(l.$t("offer.quantity_unit"))+" ",1),t[14]||(t[14]=a("span",{class:"text-red-500"},"*",-1))]),n(r(V),{id:"quantity_unit",modelValue:e.value.quantity_unit,"onUpdate:modelValue":t[2]||(t[2]=s=>e.value.quantity_unit=s),options:[{label:"Tablets",value:1},{label:"Capsules",value:2},{label:"Units",value:3},{label:"Bottle",value:4},{label:"Can",value:5}],optionLabel:"label",optionValue:"value",placeholder:l.$t("offer.select_quantity_unit"),class:c(["w-full",{"p-invalid":i.value.quantity_unit}])},null,8,["modelValue","placeholder","class"])]),a("div",le,[a("label",ae,[_(f(l.$t("offer.discount_type"))+" ",1),t[15]||(t[15]=a("span",{class:"text-red-500"},"*",-1))]),n(r(V),{id:"discount_type",modelValue:e.value.discount_type,"onUpdate:modelValue":t[3]||(t[3]=s=>e.value.discount_type=s),options:[{label:l.$t("offer.percentage"),value:1},{label:l.$t("offer.fixed_amount"),value:2},{label:l.$t("offer.gift"),value:3}],optionLabel:"label",optionValue:"value",placeholder:l.$t("offer.select_discount_type"),class:c(["w-full",{"p-invalid":i.value.discount_type}])},null,8,["modelValue","options","placeholder","class"])]),e.value.discount_type===1||e.value.discount_type===2?(p(),v("div",ie,[a("label",se,[_(f(e.value.discount_type===1?l.$t("offer.percentage"):l.$t("offer.fixed_amount"))+" ",1),t[16]||(t[16]=a("span",{class:"text-red-500"},"*",-1))]),n(r(b),{id:"discount_value",modelValue:e.value.discount_value,"onUpdate:modelValue":t[4]||(t[4]=s=>e.value.discount_value=s),mode:(e.value.discount_type===1,"decimal"),minFractionDigits:e.value.discount_type===1?0:2,maxFractionDigits:2,min:0,max:e.value.discount_type===1?100:null,placeholder:l.$t("offer.enter_discount_value"),class:c(["w-full",{"p-invalid":i.value.discount_value}])},null,8,["modelValue","mode","minFractionDigits","max","placeholder","class"]),e.value.discount_type===1?(p(),v("small",ue,"Max 100%")):q("",!0)])):q("",!0),e.value.discount_type===3?(p(),v("div",oe,[a("label",de,[_(f(l.$t("offer.gift_product"))+" ",1),t[17]||(t[17]=a("span",{class:"text-red-500"},"*",-1))]),n(r(V),{filter:"",id:"gift_product_id",modelValue:e.value.gift_product_id,"onUpdate:modelValue":t[5]||(t[5]=s=>e.value.gift_product_id=s),options:h.value,optionLabel:"commercial_name",optionValue:"id",placeholder:l.$t("offer.select_gift_product"),class:c(["w-full",{"p-invalid":i.value.gift_product_id}])},null,8,["modelValue","options","placeholder","class"])])):q("",!0),e.value.discount_type===3?(p(),v("div",ne,[a("label",re,[_(f(l.$t("offer.gift_quantity"))+" ",1),t[18]||(t[18]=a("span",{class:"text-red-500"},"*",-1))]),n(r(b),{id:"gift_quantity",modelValue:e.value.gift_quantity,"onUpdate:modelValue":t[6]||(t[6]=s=>e.value.gift_quantity=s),useGrouping:!1,min:1,placeholder:l.$t("offer.enter_gift_quantity"),class:c(["w-full",{"p-invalid":i.value.gift_quantity}])},null,8,["modelValue","placeholder","class"])])):q("",!0),a("div",fe,[a("label",_e,[_(f(l.$t("offer.min_limit_tooltip"))+" ",1),t[19]||(t[19]=a("span",{class:"text-red-500"},"*",-1))]),n(r(b),{id:"min_limit",modelValue:e.value.min_limit,"onUpdate:modelValue":t[7]||(t[7]=s=>e.value.min_limit=s),useGrouping:!1,min:0,placeholder:l.$t("offer.enter_min_limit"),class:c(["w-full",{"p-invalid":i.value.min_limit}])},null,8,["modelValue","placeholder","class"])]),a("div",ce,[a("label",me,[_(f(l.$t("offer.max_limit_tooltip"))+" ",1),t[20]||(t[20]=a("span",{class:"text-red-500"},"*",-1))]),n(r(b),{id:"max_limit",modelValue:e.value.max_limit,"onUpdate:modelValue":t[8]||(t[8]=s=>e.value.max_limit=s),useGrouping:!1,min:0,placeholder:l.$t("offer.enter_max_limit"),class:c(["w-full",{"p-invalid":i.value.max_limit}])},null,8,["modelValue","placeholder","class"])]),a("div",pe,[a("label",ve,[_(f(l.$t("offer.start_date"))+" ",1),t[21]||(t[21]=a("span",{class:"text-red-500"},"*",-1))]),n(r(D),{id:"start_date",modelValue:e.value.start_date,"onUpdate:modelValue":t[9]||(t[9]=s=>e.value.start_date=s),type:"date",class:c(["w-full",{"p-invalid":i.value.start_date}])},null,8,["modelValue","class"])]),a("div",ye,[a("label",ge,[_(f(l.$t("offer.end_date"))+" ",1),t[22]||(t[22]=a("span",{class:"text-red-500"},"*",-1))]),n(r(D),{id:"end_date",modelValue:e.value.end_date,"onUpdate:modelValue":t[10]||(t[10]=s=>e.value.end_date=s),type:"date",class:c(["w-full",{"p-invalid":i.value.end_date}])},null,8,["modelValue","class"])]),a("div",be,[a("label",qe,f(l.$t("offer.description")),1),n(r(P),{id:"description",modelValue:e.value.description,"onUpdate:modelValue":t[11]||(t[11]=s=>e.value.description=s),placeholder:l.$t("offer.enter_description"),class:"w-full",rows:"4"},null,8,["modelValue","placeholder"])])]),a("div",xe,[n(r(A),{type:"submit",label:l.$t(y.value?"offer.update_offer":"offer.create_offer"),icon:"pi pi-plus",loading:w.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300"},null,8,["label","loading"])])],32)])),[[u,"create offers"]]),n(r(H))],64)}}},he=C(Ve,[["__scopeId","data-v-f76566ba"]]);export{he as default};
