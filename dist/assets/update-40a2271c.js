import{_ as Q,a as X,z as Y,P as Z,u as ee,r as c,o as te,d as m,e as g,h as b,g as l,t as i,i as n,w as ae,D as C,b as h,B as V,A as w,F as le,y as oe,C as se}from"./index-2cd76906.js";const ie={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},re={class:"text-3xl font-bold text-center mb-8 text-gray-800"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ue={class:"space-y-2"},ce={for:"category",class:"block text-sm font-medium text-gray-700"},de={class:"space-y-2"},pe={for:"company",class:"block text-sm font-medium text-gray-700"},me={class:"space-y-2 relative"},_e={for:"commercial_name",class:"block text-sm font-medium text-gray-700"},ve={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},fe={class:"py-1"},ye=["onClick"],ge={class:"space-y-2 md:col-span-2"},be={for:"scientific_structure",class:"block text-sm font-medium text-gray-700"},he={class:"space-y-2 md:col-span-2"},xe={for:"usage",class:"block text-sm font-medium text-gray-700"},Ve={class:"space-y-2"},we={for:"calibres",class:"block text-sm font-medium text-gray-700"},$e={class:"space-y-2"},ke={for:"quantity",class:"block text-sm font-medium text-gray-700"},qe={class:"space-y-2"},Ue={for:"quantity_unit",class:"block text-sm font-medium text-gray-700"},De={class:"space-y-2"},Ce={for:"price",class:"block text-sm font-medium text-gray-700"},Fe={class:"space-y-2"},Ie={for:"price_unit",class:"block text-sm font-medium text-gray-700"},Ne={class:"space-y-2"},Te={for:"expiration_from",class:"block text-sm font-medium text-gray-700"},Be={class:"space-y-2"},Se={for:"expiration_to",class:"block text-sm font-medium text-gray-700"},Le={class:"space-y-2 md:col-span-2"},Re={for:"storage_notes",class:"block text-sm font-medium text-gray-700"},Pe={class:"space-y-2"},Me={for:"pharmaceutical_form",class:"block text-sm font-medium text-gray-700"},je={class:"md:col-span-2 space-y-2"},Ge={class:"block text-sm font-medium text-gray-700"},ze={class:"flex justify-center"},Ae={key:0,class:"p-4"},Oe={class:"relative group"},Ee=["src"],We={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center rounded-lg transition-all"},Je={class:"opacity-0 group-hover:opacity-100 flex space-x-3 transition-all"},He={class:"mt-2 text-center text-sm text-gray-500"},Ke={key:1,class:"p-8 flex flex-col items-center"},Qe={class:"text-sm text-center text-gray-600"},Xe={class:"text-blue-500 font-medium"},Ye={class:"pt-6 flex justify-center"},Ze={__name:"update",setup(et){const d=X(),B=Y(),F=Z(),{t:r}=ee(),$=c(!1),k=c([]),q=c([]),U=c([]),D=c(null),_=c(null),x=c(!1),v=c([]),f=c(!1),y=c({company_id:!1,commercial_name:!1,price:!1,price_unit:!1}),a=c({category_id:null,company_id:null,commercial_name:"",scientific_structure:[],usage:"",calibres:"",quantity:null,quantity_unit:null,price:null,price_unit:null,expiration_from:null,expiration_to:null,storage_notes:"",pharmaceutical_form:""}),S=async()=>{try{const[e,t,o]=await Promise.all([h.get("/api/category"),h.get("/api/company"),h.get("/api/scientific-structure")]);k.value=e.data.data||[],q.value=t.data.data||[],U.value=o.data.data||[]}catch{d.add({severity:"error",summary:r("error"),detail:r("error_fetching_data"),life:3e3})}},L=async()=>{var e;try{const o=(await h.get(`/api/product/${F.params.id}`)).data.data;a.value={category_id:o.category_id,company_id:o.company_id,commercial_name:o.commercial_name||"",scientific_structure:Array.isArray(o.scientific_structure)?o.scientific_structure.map(u=>u.name||u):[],usage:o.usage||"",calibres:o.calibres||"",quantity:o.quantity?Number(o.quantity):null,quantity_unit:o.quantity_unit,price:o.price?parseFloat(o.price):null,price_unit:o.price_unit,expiration_from:o.expiration_from,expiration_to:o.expiration_to,storage_notes:o.storage_notes||"",pharmaceutical_form:o.pharmaceutical_form||""},o.media&&((e=o.media[0])!=null&&e.url)&&(_.value=o.media[0].url),R()}catch{d.add({severity:"error",summary:r("error"),detail:r("error_fetching_product"),life:3e3})}},R=()=>{a.value.category_id&&!k.value.find(e=>e.id===a.value.category_id)&&k.value.push({id:a.value.category_id,name_ar:r("product.unknown_category")}),a.value.company_id&&!q.value.find(e=>e.id===a.value.company_id)&&q.value.push({id:a.value.company_id,name:r("product.unknown_company")}),a.value.scientific_structure.forEach(e=>{e&&!U.value.find(t=>t.name===e)&&U.value.push({name:e})})},P=async e=>{if(!e||e.length<2){v.value=[],f.value=!1;return}try{const t=await h.get(`/api/product/by/name?name=${encodeURIComponent(e)}`);v.value=(t.data.data||[]).filter(o=>o.commercial_name!==a.value.commercial_name),f.value=v.value.length>0}catch{d.add({severity:"error",summary:r("error"),detail:r("error_fetching_names"),life:3e3})}},M=e=>{a.value.commercial_name=e,v.value=[],f.value=!1},j=e=>{const t=e.target.value;a.value.commercial_name=t,P(t)},G=e=>{e.preventDefault(),x.value=!0},z=()=>{x.value=!1},A=e=>{if(e.size>1024*1024){d.add({severity:"warn",summary:r("warning"),detail:r("image_too_large"),life:3e3});return}D.value=e;const t=new FileReader;t.onload=o=>_.value=o.target.result,t.readAsDataURL(e),x.value=!1},I=e=>{var o,u,p;const t=((o=e.target.files)==null?void 0:o[0])||((p=(u=e.dataTransfer)==null?void 0:u.files)==null?void 0:p[0]);t&&t.type.startsWith("image/")?A(t):d.add({severity:"error",summary:r("error"),detail:r("invalid_image_type"),life:3e3})},O=()=>{D.value=null,_.value&&!_.value.startsWith("data:")||(_.value=null)},E=()=>{var e;return y.value={company_id:!a.value.company_id,commercial_name:!((e=a.value.commercial_name)!=null&&e.trim()),price:a.value.price===null||a.value.price<=0,price_unit:!a.value.price_unit},!Object.values(y.value).some(Boolean)},W=async()=>{var t,o;if(!E()){d.add({severity:"error",summary:r("error"),detail:r("validation_failed"),life:3e3});return}$.value=!0;const e=new FormData;e.append("_method","post"),e.append("category_id",a.value.category_id||""),e.append("company_id",a.value.company_id||""),e.append("commercial_name",a.value.commercial_name||""),a.value.scientific_structure.forEach((u,p)=>e.append(`scientific_structure[${p}]`,u)),e.append("usage",a.value.usage||""),e.append("calibres",a.value.calibres||""),e.append("quantity",a.value.quantity?Math.floor(a.value.quantity):""),e.append("quantity_unit",a.value.quantity_unit||""),e.append("price",a.value.price?Number(a.value.price).toFixed(2):""),e.append("price_unit",a.value.price_unit||""),e.append("expiration_from",a.value.expiration_from||""),e.append("expiration_to",a.value.expiration_to||""),e.append("storage_notes",a.value.storage_notes||""),e.append("pharmaceutical_form",a.value.pharmaceutical_form||""),D.value&&e.append("product_image",D.value);try{await h.post(`/api/product/${F.params.id}`,e,{headers:{"Content-Type":"multipart/form-data"}}),d.add({severity:"success",summary:r("success"),detail:r("product_updated"),life:3e3}),B.push({name:"products"})}catch(u){const p=((o=(t=u.response)==null?void 0:t.data)==null?void 0:o.message)||r("error_updating_product");d.add({severity:"error",summary:r("error"),detail:p,life:5e3})}finally{$.value=!1}};return te(()=>{S(),L()}),(e,t)=>{const o=m("Dropdown"),u=m("InputText"),p=m("MultiSelect"),N=m("Textarea"),T=m("InputNumber"),J=m("Button"),H=m("Form"),K=m("Toast");return g(),b("div",ie,[l("h1",re,i(e.$t("product.update_product")),1),n(H,{onSubmit:C(W,["prevent"]),class:"space-y-6"},{default:ae(()=>[l("div",ne,[l("div",ue,[l("label",ce,i(e.$t("product.category")),1),n(o,{filter:"",id:"category",modelValue:a.value.category_id,"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.category_id=s),options:k.value,optionLabel:"name_ar",optionValue:"id",placeholder:e.$t("product.select_category"),class:"w-full"},null,8,["modelValue","options","placeholder"])]),l("div",de,[l("label",pe,[V(i(e.$t("product.company"))+" ",1),t[16]||(t[16]=l("span",{class:"text-red-500"},"*",-1))]),n(o,{filter:"",id:"company",modelValue:a.value.company_id,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.company_id=s),options:q.value,optionLabel:"name",optionValue:"id",placeholder:e.$t("product.select_company"),class:w(["w-full",{"p-invalid":y.value.company_id}])},null,8,["modelValue","options","placeholder","class"])]),l("div",me,[l("label",_e,[V(i(e.$t("product.commercial_name"))+" ",1),t[17]||(t[17]=l("span",{class:"text-red-500"},"*",-1))]),n(u,{id:"commercial_name",modelValue:a.value.commercial_name,"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.commercial_name=s),placeholder:e.$t("product.enter_commercial_name"),class:w(["w-full",{"p-invalid":y.value.commercial_name}]),onInput:j,onFocus:t[3]||(t[3]=s=>f.value=v.value.length>0),onBlur:t[4]||(t[4]=s=>e.setTimeout(()=>f.value=!1,200))},null,8,["modelValue","placeholder","class"]),f.value?(g(),b("div",ve,[l("ul",fe,[(g(!0),b(le,null,oe(v.value,s=>(g(),b("li",{key:s.id,onClick:tt=>M(s.commercial_name),class:"px-4 py-2 text-sm hover:bg-blue-50 cursor-pointer"},i(s.commercial_name),9,ye))),128))])])):se("",!0)]),l("div",ge,[l("label",be,i(e.$t("product.scientific_structure")),1),n(p,{id:"scientific_structure",modelValue:a.value.scientific_structure,"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.scientific_structure=s),options:U.value,optionLabel:"name",optionValue:"name",placeholder:e.$t("product.select_scientific_structure"),display:"chip",class:"w-full"},null,8,["modelValue","options","placeholder"])]),l("div",he,[l("label",xe,i(e.$t("product.usage")),1),n(N,{id:"usage",modelValue:a.value.usage,"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.usage=s),placeholder:e.$t("product.enter_usage"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",Ve,[l("label",we,i(e.$t("product.calibres")),1),n(u,{id:"calibres",modelValue:a.value.calibres,"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.calibres=s),placeholder:e.$t("product.enter_calibres"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",$e,[l("label",ke,i(e.$t("product.quantity")),1),n(T,{id:"quantity",modelValue:a.value.quantity,"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.quantity=s),useGrouping:!1,min:1,class:"w-full"},null,8,["modelValue"])]),l("div",qe,[l("label",Ue,i(e.$t("product.quantity_unit")),1),n(o,{id:"quantity_unit",modelValue:a.value.quantity_unit,"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.quantity_unit=s),options:[{label:"Tablets",value:1},{label:"Capsules",value:2},{label:"Units",value:3}],optionLabel:"label",optionValue:"value",placeholder:e.$t("product.select_quantity_unit"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",De,[l("label",Ce,[V(i(e.$t("product.price"))+" ",1),t[18]||(t[18]=l("span",{class:"text-red-500"},"*",-1))]),n(T,{id:"price",modelValue:a.value.price,"onUpdate:modelValue":t[10]||(t[10]=s=>a.value.price=s),mode:"decimal",minFractionDigits:2,maxFractionDigits:2,min:.01,class:w(["w-full",{"p-invalid":y.value.price}])},null,8,["modelValue","class"])]),l("div",Fe,[l("label",Ie,[V(i(e.$t("product.price_unit"))+" ",1),t[19]||(t[19]=l("span",{class:"text-red-500"},"*",-1))]),n(o,{id:"price_unit",modelValue:a.value.price_unit,"onUpdate:modelValue":t[11]||(t[11]=s=>a.value.price_unit=s),options:[{label:"ل.س",value:"ل.س"},{label:"$",value:"$"}],optionLabel:"label",optionValue:"value",placeholder:e.$t("product.select_price_unit"),class:w(["w-full",{"p-invalid":y.value.price_unit}])},null,8,["modelValue","placeholder","class"])]),l("div",Ne,[l("label",Te,i(e.$t("product.expiration_from")),1),n(u,{type:"date",modelValue:a.value.expiration_from,"onUpdate:modelValue":t[12]||(t[12]=s=>a.value.expiration_from=s),mode:"decimal",class:"w-full"},null,8,["modelValue"])]),l("div",Be,[l("label",Se,i(e.$t("product.expiration_to")),1),n(u,{type:"date",modelValue:a.value.expiration_to,"onUpdate:modelValue":t[13]||(t[13]=s=>a.value.expiration_to=s),mode:"decimal",class:"w-full"},null,8,["modelValue"])]),l("div",Le,[l("label",Re,i(e.$t("product.storage_notes")),1),n(N,{id:"storage_notes",modelValue:a.value.storage_notes,"onUpdate:modelValue":t[14]||(t[14]=s=>a.value.storage_notes=s),placeholder:e.$t("product.enter_storage_notes"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",Pe,[l("label",Me,i(e.$t("product.pharmaceutical_form")),1),n(u,{id:"pharmaceutical_form",modelValue:a.value.pharmaceutical_form,"onUpdate:modelValue":t[15]||(t[15]=s=>a.value.pharmaceutical_form=s),placeholder:e.$t("product.enter_pharmaceutical_form"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",je,[l("label",Ge,i(e.$t("product.product_image")),1),l("div",ze,[l("label",{onDragover:C(G,["prevent"]),onDragleave:z,onDrop:C(I,["prevent"]),class:w([{"border-blue-500 bg-blue-50":x.value,"border-gray-300":!x.value},"cursor-pointer w-full max-w-md rounded-xl border-2 border-dashed transition-colors duration-300"])},[l("input",{type:"file",onChange:I,accept:"image/*",class:"hidden"},null,32),_.value?(g(),b("div",Ae,[l("div",Oe,[l("img",{src:_.value,alt:"Preview",class:"w-full h-64 object-cover rounded-lg shadow-md group-hover:scale-105 transition-transform"},null,8,Ee),l("div",We,[l("div",Je,[l("button",{type:"button",onClick:C(O,["stop"]),class:"bg-red-500 text-white p-2 rounded-full hover:bg-red-600"},[...t[20]||(t[20]=[l("i",{class:"pi pi-trash text-sm"},null,-1)])]),t[21]||(t[21]=l("button",{type:"button",class:"bg-white text-gray-700 p-2 rounded-full hover:bg-gray-100"},[l("i",{class:"pi pi-pencil text-sm"})],-1))])])]),l("p",He,i(e.$t("product.click_or_drag_to_change_photo")),1)])):(g(),b("div",Ke,[t[22]||(t[22]=l("div",{class:"bg-blue-100 p-4 rounded-full mb-4"},[l("i",{class:"pi pi-image text-blue-500 text-2xl"})],-1)),l("p",Qe,[l("span",Xe,i(e.$t("product.click_to_upload")),1),V(" "+i(e.$t("product.or_drag_and_drop")),1)]),t[23]||(t[23]=l("p",{class:"text-xs text-gray-400"},"SVG, PNG, JPG, GIF (max 1MB)",-1))]))],34)])])]),l("div",Ye,[n(J,{type:"submit",label:e.$t("product.update_product"),icon:"pi pi-check",loading:$.value,disabled:$.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all"},null,8,["label","loading","disabled"])])]),_:1}),n(K)])}}},lt=Q(Ze,[["__scopeId","data-v-0d5edf4b"]]);export{lt as default};
