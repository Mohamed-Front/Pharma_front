import{_ as U,i as A,P as R,r as u,g as M,d as O,a5 as W,S as k,o as n,c as r,k as s,t as o,q as j,T as L,F as p,x as g,C as z,y as T,B as y,a7 as q}from"./index-d45c326e.js";const H={class:"permission-manager"},J={class:"controls"},K={class:"name-input"},Q={for:"roleName"},X=["placeholder"],Y={key:0,class:"loading"},Z={key:0,class:"empty-state"},x={key:1,class:"table-view"},ee=["rowspan"],se=["id","checked",".indeterminate","onChange","aria-label"],le=["for"],te=["onClick","disabled"],ae=["id","value","aria-label"],oe={key:2,class:"card-view"},ie={class:"permission-groups"},ne={class:"group-header"},re=["id","checked",".indeterminate","onChange","aria-label"],de=["for"],ue={class:"permission-items"},ce={class:"permission-info"},ve=["id","value","aria-label"],me=["for"],pe=["onClick","disabled"],he=["disabled"],be={class:"modal-content"},fe={__name:"update",setup($e){const G=A(),h=R(),D=u([]),w=u(null),c=u(!0),d=u([]),v=u(""),$=u(!1),N=u(""),_=u(!1),b=M(()=>h.params.id),I=()=>{y.get("/api/role/all/permissions").then(e=>{D.value=e.data.data,b.value?S():c.value=!1}).catch(()=>{c.value=!1,alert("Failed to fetch permissions")})},S=()=>{if(!h.params.id||isNaN(Number(h.params.id))){c.value=!1,alert("Invalid role ID");return}y.get(`/api/role/${h.params.id}`).then(e=>{w.value=e.data.data,v.value=w.value.name,d.value=w.value.permissions.map(l=>l.id),c.value=!1}).catch(()=>{c.value=!1,alert("Failed to fetch role data")})},B=e=>{const l={};return e.forEach(i=>{const t=i.name.match(/^(list|show|create|edit|delete)\s+(.+)/),a=t?t[2]:"other";l[a]||(l[a]={name:a.charAt(0).toUpperCase()+a.slice(1),value:a,permissions:[]}),l[a].permissions.push(i)}),Object.values(l).sort((i,t)=>i.name.localeCompare(t.name))},f=M(()=>B(D.value)),P=e=>{const l=e.permissions.map(i=>i.id);C(e.value)?d.value=d.value.filter(i=>!l.includes(i)):d.value=[...new Set([...d.value,...l])]},C=e=>{const l=f.value.find(i=>i.value===e);return!l||l.permissions.length===0?!1:l.permissions.every(i=>d.value.includes(i.id))},V=e=>{const l=f.value.find(a=>a.value===e);if(!l||l.permissions.length===0)return!1;const i=l.permissions.some(a=>d.value.includes(a.id)),t=l.permissions.every(a=>d.value.includes(a.id));return i&&!t},F=e=>{N.value=e||"No description available",$.value=!0},E=()=>{if(!v.value){alert("Please enter a role name");return}const e={name:v.value,permissions:d.value};(b.value?y.put(`/api/role/${h.params.id}`,e):y.post("/api/role",e)).then(()=>{G.push({name:"roles"})}).catch(i=>{alert("Failed to submit role"),console.error("Error:",i)})};return O(()=>{I()}),(e,l)=>{const i=W("can");return k((n(),r("div",H,[s("h1",null,o(b.value?e.$t("role.edit"):e.$t("role.create")),1),s("div",J,[s("div",K,[s("label",Q,[j(o(e.$t("role.role_Name"))+" ",1),l[6]||(l[6]=s("span",{class:"required"},"*",-1))]),k(s("input",{type:"text",id:"roleName","onUpdate:modelValue":l[0]||(l[0]=t=>v.value=t),placeholder:e.$t("role.enter_role_name"),required:""},null,8,X),[[L,v.value]])]),s("button",{onClick:l[1]||(l[1]=t=>_.value=!_.value),class:"view-toggle"},o(_.value?e.$t("role.switchToCardView"):e.$t("role.switchToTableView")),1)]),c.value?(n(),r("div",Y,o(b.value?e.$t("role.loading.roleData"):e.$t("role.loading.permissions")),1)):(n(),r(p,{key:1},[f.value.length===0?(n(),r("div",Z,o(e.$t("role.noPermissionsAvailable")),1)):_.value?(n(),r("div",x,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,o(e.$t("role.group")),1),s("th",null,o(e.$t("role.permission")),1),s("th",null,o(e.$t("role.description")),1),s("th",null,o(e.$t("role.select")),1)])]),s("tbody",null,[(n(!0),r(p,null,g(f.value,t=>(n(),r(p,{key:t.value},[(n(!0),r(p,null,g(t.permissions,a=>(n(),r("tr",{key:a.id},[t.permissions.indexOf(a)===0?(n(),r("td",{key:0,rowspan:t.permissions.length},[s("input",{type:"checkbox",id:`group-${t.value}-table`,checked:C(t.value),".indeterminate":V(t.value),onChange:m=>P(t),"aria-label":e.$t("role.toggleGroup",{group:t.name})},null,40,se),s("label",{for:`group-${t.value}-table`},o(t.name),9,le)],8,ee)):T("",!0),s("td",null,o(a.name),1),s("td",null,[s("button",{onClick:m=>F(a.description),class:"description-btn",disabled:!a.description},o(a.description?e.$t("role.view"):e.$t("role.none")),9,te)]),s("td",null,[k(s("input",{type:"checkbox",id:`permission-${a.id}-table`,value:a.id,"onUpdate:modelValue":l[2]||(l[2]=m=>d.value=m),"aria-label":e.$t("role.togglePermission",{permission:a.name})},null,8,ae),[[q,d.value]])])]))),128))],64))),128))])])])):(n(),r("div",oe,[s("div",ie,[(n(!0),r(p,null,g(f.value,t=>(n(),r("div",{key:t.value,class:"permission-group"},[s("div",ne,[s("input",{class:"mx-2 my-auto",type:"checkbox",id:`group-${t.value}`,checked:C(t.value),".indeterminate":V(t.value),onChange:a=>P(t),"aria-label":e.$t("role.toggleGroup",{group:t.name})},null,40,re),s("label",{for:`group-${t.value}`},o(t.name),9,de)]),s("div",ue,[(n(!0),r(p,null,g(t.permissions,a=>(n(),r("div",{key:a.id,class:"permission-item"},[s("div",ce,[k(s("input",{type:"checkbox",id:`permission-${a.id}`,value:a.id,"onUpdate:modelValue":l[3]||(l[3]=m=>d.value=m),"aria-label":e.$t("role.togglePermission",{permission:a.name})},null,8,ve),[[q,d.value]]),s("label",{for:`permission-${a.id}`},o(a.name),9,me)]),s("button",{onClick:m=>F(a.description),class:"description-btn",disabled:!a.description},o(a.description?e.$t("role.viewDescription"):e.$t("role.noDescription")),9,pe)]))),128))])]))),128))])]))],64)),s("button",{onClick:E,class:"submit-btn",disabled:d.value.length===0||!v.value},o(b.value?e.$t("role.updateWithPermissions"):e.$t("role.createWithPermissions")),9,he),$.value?(n(),r("div",{key:2,class:"modal-overlay",onClick:l[5]||(l[5]=z(t=>$.value=!1,["self"]))},[s("div",be,[s("h3",null,o(e.$t("role.permission_Description")),1),s("p",null,o(N.value),1),s("button",{onClick:l[4]||(l[4]=t=>$.value=!1),class:"close-modal"},o(e.$t("role.close")),1)])])):T("",!0)])),[[i,"edit roles"]])}}},ke=U(fe,[["__scopeId","data-v-a1452e20"]]);export{ke as default};
