import{_ as K,u as O,a as X,z as Y,r as E,c as w,o as Z,e as n,h as i,g as t,t as o,j as c,A as T,F as y,y as v,i as Q,C as g,b as I,s as tt,B as G,k as et}from"./index-2cd76906.js";const st={class:"bg-gray-100 min-h-screen p-4 sm:p-8 font-[Inter]"},rt={class:"max-w-7xl mx-auto flex flex-col lg:flex-row gap-8"},at={class:"flex-shrink-0 w-full lg:w-96 bg-white rounded-3xl shadow-lg p-6 flex flex-col items-stretch"},lt={class:"flex items-center border-b pb-4 mb-4"},ot={class:"text-xl font-bold"},nt={class:"flex justify-between py-2 text-gray-600"},it={class:"font-medium"},ct={class:"flex justify-between py-2 text-gray-600"},dt={class:"text-red-500"},ut={class:"font-medium"},mt={class:"flex justify-between font-bold text-lg border-t pt-4 mt-4"},pt=["disabled"],ft={class:"flex items-center justify-center mt-4 text-xs text-gray-500"},_t={class:"flex-grow w-full bg-white rounded-3xl shadow-lg p-6 flex flex-col"},gt={class:"flex flex-wrap gap-2 mb-6 border-b pb-4"},xt=["onClick"],yt={key:0,class:"flex justify-center mb-10"},vt={key:1,class:"text-center text-gray-600 py-8"},bt={key:2,class:"mb-8"},ht={class:"flex items-center pb-4 mb-4"},wt={class:"text-xl font-bold"},kt={key:0,class:"text-center text-gray-500 p-4 border rounded-xl"},Ct={key:0,class:"text-lg font-semibold text-gray-700 mb-4"},jt={class:"flex items-center w-full sm:w-auto mb-4 sm:mb-0"},Et={class:"w-16 h-16 bg-green-100 rounded-xl flex items-center justify-center shrink-0"},It=["src","alt"],qt={class:"flex-grow mx-4"},St={class:"font-bold text-lg"},$t={class:"text-sm text-gray-500"},Dt={class:"flex flex-wrap gap-2 mt-2"},Nt={key:0,class:"text-sm text-red-500 mt-1"},Tt={key:1,class:"mt-3 space-y-2"},Gt={class:"font-semibold"},Mt={class:"mt-1"},zt={class:"text-xs text-gray-600 mt-1"},Bt={class:"flex items-center w-full sm:w-auto justify-between sm:justify-start"},Lt={class:"flex items-center ml-4"},Qt={class:"font-bold text-lg"},Vt=["disabled","onClick"],Wt={class:"flex items-center bg-gray-200 rounded-full px-2 py-1"},Ft=["disabled","onClick"],Pt=["value","disabled","onChange"],Ut=["disabled","onClick"],Rt={key:3,class:"my-8 border-t border-gray-200"},At={key:4},Ht={class:"flex items-center pb-4 mb-4"},Jt={class:"text-xl font-bold text-purple-700"},Kt={key:0,class:"text-lg font-semibold text-gray-700 mb-4"},Ot={class:"flex items-center w-full sm:w-auto mb-4 sm:mb-0"},Xt={class:"w-16 h-16 bg-purple-100 rounded-xl flex items-center justify-center shrink-0"},Yt=["src","alt"],Zt={class:"flex-grow mx-4"},te={class:"font-bold text-lg text-purple-800"},ee={class:"text-sm text-purple-600"},se={class:"flex flex-wrap gap-2 mt-2"},re={class:"flex items-center w-full sm:w-auto justify-between sm:justify-start text-purple-800"},ae={class:"font-bold text-lg mr-4"},le={class:"flex items-center bg-purple-200 rounded-full px-2 py-1 opacity-70 cursor-not-allowed"},oe={class:"px-4 font-bold text-lg"},ne={__name:"cart",setup(ie){const{t:r}=O(),m=X();Y();const _=E([]),f=E([]),p=E("all"),k=E(!1),x=E({}),q=l=>l.items.filter(e=>e.is_gift!==1),S=l=>l.items.filter(e=>e.is_gift===1),M=w(()=>C.value.flatMap(l=>q(l)).length),$=w(()=>C.value.flatMap(l=>S(l)).length),D=(l,e)=>{let a=[];if(e==="all")a=l.flatMap(s=>s.items);else{const s=l.find(d=>d.warehouse_id===e);a=s?s.items:[]}return a.filter(s=>s.is_gift!==1)},C=w(()=>p.value==="all"?f.value:f.value.filter(l=>l.warehouse_id===p.value)),V=w(()=>D(f.value,p.value).reduce((e,a)=>e+(a.original_price||0),0)),W=w(()=>D(f.value,p.value).reduce((e,a)=>e+(a.total_discounts||0),0)),F=w(()=>D(f.value,p.value).reduce((e,a)=>e+(a.total_price||0),0)),P=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),z=l=>{l.target.style.display="none",l.target.nextElementSibling&&(l.target.nextElementSibling.style.display="block")},U=(l,e)=>l>=e.min_limit,h=async()=>{var l,e;k.value=!0;try{const a=await I.get("/api/cart/get");a.data.success&&a.data.data?(f.value=a.data.data.warehouses.map(s=>({...s,name:s.warehouse_name||`Warehouse ${s.warehouse_id}`,items:s.items.map(d=>({...d,description:d.description||r("cart.defaultDescription")})).sort((d,b)=>d.is_gift-b.is_gift)})),_.value=f.value.flatMap(s=>s.items)):(f.value=[],_.value=[],m.add({severity:"warn",summary:r("warning"),detail:r("cart.empty"),life:3e3}))}catch(a){f.value=[],_.value=[];const s=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||r("cart.fetchError");m.add({severity:"error",summary:r("error"),detail:s,life:3e3}),console.error("Error fetching cart:",a)}finally{k.value=!1}},R=async l=>{const e=_.value.find(a=>a.id===l);if(!(e&&e.is_gift===1)){x.value[l]=!0;try{const a=await I.post("/api/cart/remove/item",{item_id:l});if(a.data.success)await h(),m.add({severity:"success",summary:r("success"),detail:r("cart.removeSuccess"),life:3e3});else throw new Error(a.data.message||r("cart.removeError"))}catch(a){m.add({severity:"error",summary:r("error"),detail:a.message||r("cart.removeError"),life:3e3})}finally{delete x.value[l]}}},N=async(l,e)=>{const a=_.value.find(d=>d.id===l),s=parseInt(e);if(!(!a||a.is_gift===1)){if(isNaN(s)||s<1){m.add({severity:"warn",summary:r("warning"),detail:r("cart.invalidQuantity"),life:3e3}),await h();return}if(s!==a.quantity){x.value[l]=!0;try{const d=await I.post("/api/cart/add/item?update=1",{product_id:a.product_id,quantity:s});if(d.data.success)await h(),m.add({severity:"success",summary:r("success"),detail:r("cart.updateSuccess"),life:3e3});else throw new Error(d.data.message||r("cart.updateError"))}catch(d){await h(),m.add({severity:"error",summary:r("error"),detail:d.message||r("cart.updateError"),life:3e3})}finally{delete x.value[l]}}}},A=async l=>{const e=_.value.find(a=>a.id===l);!e||e.is_gift===1||await N(l,e.quantity+1)},H=async l=>{const e=_.value.find(a=>a.id===l);!e||e.quantity<=1||e.is_gift===1||await N(l,e.quantity-1)},J=async()=>{const l=C.value.map(e=>e.warehouse_id);if(l.length===0){m.add({severity:"warn",summary:r("warning"),detail:r("cart.empty"),life:3e3});return}try{const e=l.join(",");m.add({severity:"info",summary:r("info"),detail:r("cart.checkoutProcessing"),life:3e3});const a=await I.post(`/api/order?select=${encodeURIComponent(e)}`);if(a.data.success)m.add({severity:"success",summary:r("success"),detail:r("cart.orderSuccess"),life:3e3}),await h(),p.value="all";else throw new Error(a.data.message||r("cart.checkoutError"))}catch(e){m.add({severity:"error",summary:r("error"),detail:e.message||r("cart.checkoutError"),life:3e3})}},B=l=>{p.value=l};return Z(h),(l,e)=>(n(),i("div",st,[t("div",rt,[t("div",at,[t("div",lt,[t("h2",ot,o(c(r)("cart.orderDetails")),1),e[1]||(e[1]=t("i",{class:"pi pi-shopping-cart text-green-600 text-2xl mx-2"},null,-1))]),t("div",nt,[t("span",null,o(V.value)+" "+o(c(r)("currency")),1),t("span",it,o(c(r)("cart.subtotal")),1)]),t("div",ct,[t("span",dt,"-"+o(W.value)+" "+o(c(r)("currency")),1),t("span",ut,o(c(r)("cart.discount")),1)]),t("div",mt,[t("span",null,o(F.value)+" "+o(c(r)("currency")),1),t("span",null,o(c(r)("cart.total")),1)]),t("button",{class:"bg-green-600 text-white rounded-full py-3 mt-8 font-bold text-lg shadow-lg hover:bg-green-700 transition duration-300",disabled:k.value||_.value.length===0,onClick:J},o(c(r)("cart.checkout")),9,pt),t("div",ft,[e[2]||(e[2]=t("i",{class:"pi pi-check-circle text-green-600 mr-1"},null,-1)),t("span",null,o(c(r)("cart.securePayment")),1)])]),t("div",_t,[t("div",gt,[t("button",{class:T(["px-4 py-2 rounded-lg shadow-sm border",p.value==="all"?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border-gray-200 hover:bg-gray-100"]),onClick:e[0]||(e[0]=a=>B("all"))},o(c(r)("cart.all")),3),(n(!0),i(y,null,v(f.value,a=>(n(),i("button",{key:a.warehouse_id,class:T(["px-4 py-2 rounded-lg shadow-sm border",p.value===a.warehouse_id?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border-gray-200 hover:bg-gray-100"]),onClick:s=>B(a.warehouse_id)},o(a.warehouse_name),11,xt))),128))]),k.value?(n(),i("div",yt,[Q(c(tt),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):!k.value&&_.value.length===0?(n(),i("div",vt,[t("p",null,o(c(r)("cart.empty")),1)])):(n(),i("div",bt,[t("div",ht,[t("h2",wt,o(c(r)("cart.requestedItems"))+" ("+o(M.value)+")",1),e[3]||(e[3]=t("i",{class:"pi pi-box text-green-600 text-2xl mx-2"},null,-1))]),M.value===0?(n(),i("div",kt,o(c(r)("cart.noPurchasedItems")),1)):g("",!0),(n(!0),i(y,null,v(C.value,a=>(n(),i("div",{key:a.warehouse_id,class:"mb-6"},[p.value!=="all"&&q(a).length>0?(n(),i("h3",Ct,o(a.name),1)):g("",!0),(n(!0),i(y,null,v(q(a),s=>{var d,b,j;return n(),i("div",{key:s.id,class:"flex flex-col sm:flex-row items-center justify-between border-b pb-4 mb-4 last:border-b-0 last:mb-0"},[t("div",jt,[t("div",Et,[(b=(d=s.product.media)==null?void 0:d[0])!=null&&b.url?(n(),i("img",{key:0,src:s.product.media[0].url,alt:s.product.commercial_name,class:"w-full h-full object-cover rounded-xl",loading:"lazy",onError:z},null,40,It)):g("",!0)]),t("div",qt,[t("h3",St,o(s.product.commercial_name),1),t("p",$t,o(s.description||c(r)("cart.defaultDescription")),1),t("div",Dt,[(n(!0),i(y,null,v(s.product.scientific_structure,u=>(n(),i("span",{key:u,class:"bg-gray-200 text-gray-800 text-xs font-medium px-3 py-1 rounded-full"},o(u),1))),128))]),s.total_discounts>0?(n(),i("p",Nt,o(c(r)("cart.discount"))+": -"+o(s.total_discounts)+" "+o(c(r)("currency")),1)):g("",!0),s.product.has_active_offer&&((j=s.product.active_offers)!=null&&j.length)?(n(),i("div",Tt,[(n(!0),i(y,null,v(s.product.active_offers,u=>{var L;return n(),i("div",{key:u.id,class:T(["bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 text-green-800 text-xs font-medium p-3 rounded-lg",{"ring-2 ring-green-500":U(s.quantity,u)}])},[t("p",Gt,o(u.description),1),t("p",Mt,[e[4]||(e[4]=t("i",{class:"pi pi-gift mr-1"},null,-1)),t("strong",null,o(c(r)("cart.gift"))+":",1),G(" "+o(u.gift_quantity)+" Ã— "+o(((L=u.gift_product)==null?void 0:L.commercial_name)||c(r)("cart.unknownGift")),1)]),t("p",null,[t("strong",null,o(c(r)("cart.minLimit"))+":",1),G(" "+o(u.min_limit)+" ",1),e[5]||(e[5]=t("span",{class:"mx-2"},"|",-1)),t("strong",null,o(c(r)("cart.maxLimit"))+":",1),G(" "+o(u.max_limit),1)]),t("p",zt,o(c(r)("cart.validUntil"))+": "+o(P(u.end_date)),1)],2)}),128))])):g("",!0)])]),t("div",Bt,[t("div",Lt,[t("span",Qt,o(s.total_price)+" "+o(c(r)("currency")),1),t("button",{class:"text-red-500 p-2 rounded-full mx-4 hover:bg-gray-300 transition duration-300",disabled:x.value[s.id],onClick:u=>R(s.id)},[...e[6]||(e[6]=[t("i",{class:"pi pi-trash text-lg"},null,-1)])],8,Vt)]),t("div",Wt,[t("button",{class:"w-8 h-8 rounded-full text-green-600 font-bold hover:bg-gray-300 transition duration-300",disabled:x.value[s.id],onClick:u=>A(s.id)}," + ",8,Ft),t("input",{type:"number",value:s.quantity,min:"1",class:"px-2 w-16 text-center font-bold text-lg bg-transparent focus:outline-none quantity-input",disabled:x.value[s.id],onChange:u=>N(s.id,u.target.value)},null,40,Pt),t("button",{class:"w-8 h-8 rounded-full text-green-600 font-bold hover:bg-gray-300 transition duration-300",disabled:x.value[s.id]||s.quantity<=1,onClick:u=>H(s.id)}," - ",8,Ut)])])])}),128))]))),128))])),$.value>0?(n(),i("hr",Rt)):g("",!0),$.value>0?(n(),i("div",At,[t("div",Ht,[t("h2",Jt,o(c(r)("cart.eligibleGiftsTitle"))+" ("+o($.value)+")",1),e[7]||(e[7]=t("i",{class:"pi pi-gift text-purple-600 text-2xl mx-2"},null,-1))]),(n(!0),i(y,null,v(C.value,a=>(n(),i("div",{key:a.warehouse_id,class:"mb-6"},[p.value!=="all"&&S(a).length>0?(n(),i("h3",Kt,o(a.name),1)):g("",!0),(n(!0),i(y,null,v(S(a),s=>{var d,b;return n(),i("div",{key:s.id,class:"flex flex-col sm:flex-row items-center justify-between border border-purple-200 bg-purple-50 rounded-xl p-4 mb-4"},[t("div",Ot,[t("div",Xt,[(b=(d=s.product.media)==null?void 0:d[0])!=null&&b.url?(n(),i("img",{key:0,src:s.product.media[0].url,alt:s.product.commercial_name,class:"w-full h-full object-cover rounded-xl opacity-70",loading:"lazy",onError:z},null,40,Yt)):g("",!0)]),t("div",Zt,[t("h3",te,o(s.product.commercial_name),1),t("p",ee,o(c(r)("cart.gift"))+" - "+o(c(r)("cart.complimentary")),1),t("div",se,[(n(!0),i(y,null,v(s.product.scientific_structure,j=>(n(),i("span",{key:j,class:"bg-purple-200 text-purple-800 text-xs font-medium px-3 py-1 rounded-full"},o(j),1))),128))])])]),t("div",re,[t("span",ae,o(c(r)("cart.free")),1),e[10]||(e[10]=t("button",{class:"p-2 rounded-full mx-4 text-gray-400 cursor-not-allowed",disabled:""},[t("i",{class:"pi pi-trash text-lg"})],-1)),t("div",le,[e[8]||(e[8]=t("button",{class:"w-8 h-8 rounded-full text-purple-600 font-bold",disabled:""}," + ",-1)),t("span",oe,o(s.quantity),1),e[9]||(e[9]=t("button",{class:"w-8 h-8 rounded-full text-purple-600 font-bold",disabled:""}," - ",-1))])])])}),128))]))),128))])):g("",!0)])]),Q(c(et))]))}},de=K(ne,[["__scopeId","data-v-04f331d3"]]);export{de as default};
