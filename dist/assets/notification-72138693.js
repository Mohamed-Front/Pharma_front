import{z as q,u as G,a as Q,r as v,c as T,m as X,o as Y,e as o,h as n,g as r,i as d,w,j as l,C as k,t as u,F as N,y as D,b as C,J as F,f as I,K as S,L as Z,E as B,M as R,N as ee,A as P,B as ae,O as te}from"./index-2cd76906.js";const se={class:"min-h-screen bg-gray-100 flex justify-center items-start p-4"},re={class:"w-full max-w-7xl bg-white rounded-2xl shadow-xl overflow-hidden"},le=["aria-selected"],oe=["aria-selected"],ne=["id"],ie={key:0,class:"flex justify-end mb-4"},de={key:1,class:"flex flex-col items-center justify-center h-64 text-gray-500"},ce={class:"text-lg"},ue={key:2,class:"space-y-4"},me={class:"flex justify-between items-start p-4"},ve={key:3,class:"space-y-4"},_e=["onClick","aria-label"],ge={class:"flex justify-between items-center"},fe={class:"flex-1 min-w-0"},pe={class:"items-center mx-4"},he={class:"text-gray-400 text-sm flex-shrink-0"},ye={key:0,class:"mt-2 text-xs text-gray-500"},xe={key:4,class:"flex flex-col items-center justify-center h-64 text-gray-500"},be={class:"text-lg"},$e={__name:"notification",setup(we){const j=q(),{t}=G(),y=Q(),f=v(!0),p=v(null),E=()=>({data:[],total:0,unread_count:0,current_page:1,last_page:1}),_=v(E()),g=v(E()),c=v(0),$=v([]),h=v(1),A=v(10),b=T(()=>c.value===0?_.value:g.value),L=T(()=>b.value.total),V=a=>{if(!a)return"";const e=new Date,s=new Date(a),i=Math.floor((e-s)/(1e3*60)),m=Math.floor(i/60);return m>0?`${t("since")||"since"} ${m} ${t("hours_ago")||"hours ago"}`:i>0?`${t("since")||"since"} ${i} ${t("minutes_ago")||"minutes ago"}`:t("just_now")||"just now"},O=a=>{const e=s=>{const i=a[s]||{},m=i.data||[];return{data:m,total:i.total||0,unread_count:m.filter(W=>!W.read_at).length,current_page:i.current_page||1,last_page:i.last_page||1}};_.value=e("admin_notifications"),g.value=e("warehouse_notifications")},M=()=>{$.value=b.value.data,h.value=b.value.current_page},x=async(a=1)=>{f.value=!0,p.value=null;try{const e=await C.get(`/api/notification/get?page=${a}&per_page=${A.value}`);O(e.data.data),M()}catch(e){p.value=e.message||t("notification.loadError")||"Failed to load notifications.",y.add({severity:"error",summary:t("error"),detail:p.value,life:3e3}),console.error("Error fetching data:",e)}finally{f.value=!1}},z=async a=>{if(!a.read_at)try{await C.post(`/api/notification/read/${a.id}`),a.read_at=new Date().toISOString(),_.value.unread_count=_.value.data.filter(e=>!e.read_at).length,g.value.unread_count=g.value.data.filter(e=>!e.read_at).length,y.add({severity:"success",summary:t("success"),detail:t("notification.markedRead")||"Notification marked as read.",life:1500})}catch(e){y.add({severity:"error",summary:t("error"),detail:t("notification.markAsReadError")||"Failed to mark notification as read.",life:3e3}),console.error("Error marking notification as read:",e)}},H=async()=>{f.value=!0;try{const a=c.value===0?"admin":"warehouse";await C.post(`/api/notification/read-all?type=${a}`);const e=c.value===0?_:g;e.value.data.forEach(s=>{s.read_at||(s.read_at=new Date().toISOString())}),e.value.unread_count=0,y.add({severity:"success",summary:t("success"),detail:t("notification.markedAllRead")||"All notifications marked as read.",life:3e3}),x(h.value)}catch(a){y.add({severity:"error",summary:t("error"),detail:t("notification.markAllReadError")||"Failed to mark all notifications as read.",life:3e3}),console.error("Error marking all as read:",a)}finally{f.value=!1}},J=a=>{z(a);const e=a.metadata||{};a.type==="warehouse"?a.redirect_type==="order_status_changed"&&e.order_id?j.push({name:"pharmacy-orders"}):a.redirect_type==="offer_created"&&e.offer_id?j.push({name:"pharmacy-offers"}):console.log(`Unhandled warehouse redirect: ${a.redirect_type}`):a.type==="admin"&&console.log(`Admin notification clicked: ${a.title}`)},K=a=>{c.value=a.index,h.value=1,x(1)},U=a=>{const e=a.page+1;h.value=e,x(e)};return X(c,()=>{M()}),Y(()=>{x()}),(a,e)=>(o(),n("div",se,[r("div",re,[d(l(Z),{"active-index":c.value,onTabChange:K,class:"bg-gradient-to-r from-[#43A167] to-[#8fd3a9]",role:"tablist"},{default:w(()=>[d(l(F),null,{header:w(()=>[r("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":c.value===0,"aria-controls":"admin-notifications"},[e[1]||(e[1]=r("i",{class:"pi pi-user text-xl"},null,-1)),r("span",null,u(l(t)("notifications.admin_messages")||"Admin Messages"),1),_.value.unread_count>0?(o(),I(l(S),{key:0,value:_.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):k("",!0)],8,le)]),_:1}),d(l(F),null,{header:w(()=>[r("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":c.value===1,"aria-controls":"warehouse-notifications"},[e[2]||(e[2]=r("i",{class:"pi pi-home text-xl"},null,-1)),r("span",null,u(l(t)("notifications.warehouse_notes")||"Warehouse Notes"),1),g.value.unread_count>0?(o(),I(l(S),{key:0,value:g.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):k("",!0)],8,oe)]),_:1})]),_:1},8,["active-index"]),r("div",{class:"p-6 bg-gray-50 min-h-[400px]",id:c.value===0?"admin-notifications":"warehouse-notifications",role:"tabpanel"},[L.value>0&&!f.value&&!p.value?(o(),n("div",ie,[d(l(B),{label:l(t)("mark_all_read")||"Mark All As Read",icon:"pi pi-check-double",severity:"success",outlined:"",onClick:H,disabled:b.value.unread_count===0,class:"text-sm"},null,8,["label","disabled"])])):k("",!0),p.value?(o(),n("div",de,[e[3]||(e[3]=r("i",{class:"pi pi-exclamation-triangle text-5xl mb-4 opacity-50"},null,-1)),r("p",ce,u(p.value),1),d(l(B),{label:l(t)("retry")||"Retry",icon:"pi pi-refresh",class:"mt-4",onClick:e[0]||(e[0]=s=>x(h.value))},null,8,["label"])])):f.value?(o(),n("div",ue,[(o(),n(N,null,D(5,s=>d(l(ee),{key:s,class:"shadow-md rounded-lg"},{content:w(()=>[r("div",me,[d(l(R),{width:"60%",height:"1.5rem",class:"rounded"}),d(l(R),{width:"15%",height:"1rem",class:"rounded"})]),d(l(R),{width:"90%",height:"1rem",class:"mt-2 mx-4 rounded"})]),_:1})),64))])):$.value.length>0?(o(),n("div",ve,[(o(!0),n(N,null,D($.value,s=>(o(),n("div",{key:s.id,class:P(["notification-item p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer",{"bg-blue-50 border-l-4 border-[#43A167]":!s.read_at}]),onClick:i=>J(s),role:"button","aria-label":s.title||l(t)("no_title")},[r("div",ge,[r("div",fe,[r("div",{class:P(["font-semibold text-lg truncate",{"text-gray-900":!s.read_at,"text-gray-500":s.read_at}])},u(s.title||l(t)("no_title")),3)]),r("div",pe,[r("p",he,u(V(s.created_at)),1)])]),r("div",{class:P(["mt-2 text-sm leading-relaxed",{"text-gray-700":!s.read_at,"text-gray-500":s.read_at}])},u(s.body||l(t)("no_body")),3),s.metadata?(o(),n("div",ye,[(o(!0),n(N,null,D(s.metadata,(i,m)=>(o(),n("span",{key:m},[ae(u(m)+": "+u(i),1),e[4]||(e[4]=r("br",null,null,-1))]))),128))])):k("",!0)],10,_e))),128)),d(l(te),{rows:A.value,totalRecords:L.value,first:(h.value-1)*A.value,onPage:U,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink"},null,8,["rows","totalRecords","first"])])):(o(),n("div",xe,[e[5]||(e[5]=r("i",{class:"pi pi-bell-slash text-5xl mb-4 opacity-50"},null,-1)),r("p",be,u(l(t)("notification.noData")||"No notifications in this section."),1)]))],8,ne)])]))}};export{$e as default};
