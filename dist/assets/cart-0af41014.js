import{_ as X,u as Y,j as Z,i as tt,r as E,g as h,d as et,o as n,c as i,k as e,t as o,m as c,l as j,F as g,x as y,z as U,y as b,B as I,E as st,q as S,A as rt}from"./index-d45c326e.js";const at={class:"bg-gray-100 min-h-screen p-4 sm:p-8 font-[Inter]"},lt={class:"max-w-7xl mx-auto flex flex-col lg:flex-row gap-8"},ot={class:"flex-shrink-0 w-full lg:w-96 bg-white rounded-3xl shadow-lg p-6 flex flex-col items-stretch"},nt={class:"flex items-center border-b pb-4 mb-4"},it={class:"text-xl font-bold"},ct={class:"flex justify-between py-2 text-gray-600"},dt={class:"font-medium"},ut={class:"flex justify-between py-2 text-gray-600"},pt={class:"text-red-500"},mt={class:"font-medium"},_t={class:"flex justify-between font-bold text-lg border-t pt-4 mt-4"},ft=["disabled"],xt={class:"flex items-center justify-center mt-4 text-xs text-gray-500"},gt={class:"flex-grow w-full bg-white rounded-3xl shadow-lg p-6 flex flex-col"},yt={class:"flex flex-wrap gap-2 mb-6 border-b pb-4"},vt=["onClick"],bt={key:0,class:"flex justify-center mb-10"},ht={key:1,class:"text-center text-gray-600 py-8"},wt={key:2,class:"mb-8"},kt={class:"flex items-center pb-4 mb-4"},qt={class:"text-xl font-bold"},Ct={key:0,class:"text-center text-gray-500 p-4 border rounded-xl"},Et={key:0,class:"text-lg font-semibold text-gray-700 mb-4"},jt={class:"flex items-center w-full sm:w-auto mb-4 sm:mb-0"},It={class:"w-16 h-16 bg-green-100 rounded-xl flex items-center justify-center shrink-0"},St=["src","alt"],Mt={class:"flex-grow mx-4"},Gt={class:"font-bold text-lg"},$t={class:"text-sm text-gray-500"},Dt={class:"flex flex-wrap gap-2 mt-2"},Tt={key:0,class:"text-sm text-red-500 mt-1"},Nt={key:1,class:"mt-3 space-y-2"},Pt={class:"font-semibold"},zt={class:"mt-1"},Bt={key:0,class:"text-green-700 font-bold mt-1"},Ft={key:1,class:"text-orange-600 text-xs"},Lt={class:"text-xs text-gray-600 mt-1"},Ut={class:"flex items-center w-full sm:w-auto justify-between sm:justify-start"},Vt={class:"flex items-center ml-4"},Wt={class:"font-bold text-lg"},Qt=["disabled","onClick"],Rt={class:"flex items-center bg-gray-200 rounded-full px-2 py-1"},At=["disabled","onClick"],Ht={class:"px-4 font-bold text-lg"},Jt=["disabled","onClick"],Kt={key:3,class:"my-8 border-t border-gray-200"},Ot={key:4},Xt={class:"flex items-center pb-4 mb-4"},Yt={class:"text-xl font-bold text-purple-700"},Zt={key:0,class:"text-lg font-semibold text-gray-700 mb-4"},te={class:"flex items-center w-full sm:w-auto mb-4 sm:mb-0"},ee={class:"w-16 h-16 bg-purple-100 rounded-xl flex items-center justify-center shrink-0"},se=["src","alt"],re={class:"flex-grow mx-4"},ae={class:"font-bold text-lg text-purple-800"},le={class:"text-sm text-purple-600"},oe={class:"flex flex-wrap gap-2 mt-2"},ne={class:"flex items-center w-full sm:w-auto justify-between sm:justify-start text-purple-800"},ie={class:"font-bold text-lg mr-4"},ce={class:"flex items-center bg-purple-200 rounded-full px-2 py-1 opacity-70 cursor-not-allowed"},de={class:"px-4 font-bold text-lg"},ue={__name:"cart",setup(pe){const{t:s}=Y(),p=Z();tt();const x=E([]),_=E([]),m=E("all"),w=E(!1),f=E({}),M=l=>l.items.filter(t=>t.is_gift!==1),G=l=>l.items.filter(t=>t.is_gift===1),N=h(()=>k.value.flatMap(l=>M(l)).length),$=h(()=>k.value.flatMap(l=>G(l)).length),D=(l,t)=>{let r=[];if(t==="all")r=l.flatMap(a=>a.items);else{const a=l.find(u=>u.warehouse_id===t);r=a?a.items:[]}return r.filter(a=>a.is_gift!==1)},k=h(()=>m.value==="all"?_.value:_.value.filter(l=>l.warehouse_id===m.value)),V=h(()=>D(_.value,m.value).reduce((t,r)=>t+(r.original_price||0),0)),W=h(()=>D(_.value,m.value).reduce((t,r)=>t+(r.total_discounts||0),0)),Q=h(()=>D(_.value,m.value).reduce((t,r)=>t+(r.total_price||0),0)),P=l=>({Paracetamol:"pi-tablet",Caffeine:"pi-bolt","First Scientific Structure":"pi-capsules"})[l]||"pi-tablet",R=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),z=l=>{l.target.style.display="none",l.target.nextElementSibling&&(l.target.nextElementSibling.style.display="block")},B=l=>({1:s("cart.unit"),2:s("cart.box"),3:s("cart.pack"),5:s("cart.unit")})[l]||s("cart.unit"),T=(l,t)=>l>=t.min_limit,A=(l,t)=>{if(!T(l,t))return 0;const r=Math.floor(l/t.min_limit),a=t.max_limit?Math.floor(t.max_limit/t.min_limit):r;return Math.min(r,a)*t.gift_quantity},q=async()=>{var l,t;w.value=!0;try{const r=await I.get("/api/cart/get");r.data.success&&r.data.data?(_.value=r.data.data.warehouses.map(a=>({...a,name:a.warehouse_name||`Warehouse ${a.warehouse_id}`,items:a.items.map(u=>({...u,description:u.description||s("cart.defaultDescription")})).sort((u,v)=>u.is_gift-v.is_gift)})),x.value=_.value.flatMap(a=>a.items)):(_.value=[],x.value=[],p.add({severity:"warn",summary:s("warning"),detail:s("cart.empty"),life:3e3}))}catch(r){_.value=[],x.value=[];const a=((t=(l=r.response)==null?void 0:l.data)==null?void 0:t.message)||s("cart.fetchError");p.add({severity:"error",summary:s("error"),detail:a,life:3e3}),console.error("Error fetching cart:",r)}finally{w.value=!1}},H=async l=>{const t=x.value.find(r=>r.id===l);if(!(t&&t.is_gift===1)){f.value[l]=!0;try{const r=await I.post("/api/cart/remove/item",{item_id:l});if(r.data.success)await q(),p.add({severity:"success",summary:s("success"),detail:s("cart.removeSuccess"),life:3e3});else throw new Error(r.data.message||s("cart.removeError"))}catch(r){p.add({severity:"error",summary:s("error"),detail:r.message||s("cart.removeError"),life:3e3})}finally{delete f.value[l]}}},J=async l=>{const t=x.value.find(r=>r.id===l);if(!(!t||t.is_gift===1)){f.value[l]=!0;try{(await I.post("/api/cart/add/item",{product_id:t.product_id,quantity:t.quantity+1})).data.success&&(await q(),p.add({severity:"success",summary:s("success"),detail:s("cart.updateSuccess"),life:3e3}))}catch(r){p.add({severity:"error",summary:s("error"),detail:r.message||s("cart.updateError"),life:3e3})}finally{delete f.value[l]}}},K=async l=>{const t=x.value.find(r=>r.id===l);if(!(!t||t.quantity<=1||t.is_gift===1)){f.value[l]=!0;try{(await I.post("/api/cart/add/item",{product_id:t.product_id,quantity:t.quantity-1})).data.success&&(await q(),p.add({severity:"success",summary:s("success"),detail:s("cart.updateSuccess"),life:3e3}))}catch(r){p.add({severity:"error",summary:s("error"),detail:r.message||s("cart.updateError"),life:3e3})}finally{delete f.value[l]}}},O=async()=>{const l=k.value.map(t=>t.warehouse_id);if(l.length===0){p.add({severity:"warn",summary:s("warning"),detail:s("cart.empty"),life:3e3});return}try{const t=l.join(",");p.add({severity:"info",summary:s("info"),detail:s("cart.checkoutProcessing"),life:3e3});const r=await I.post(`/api/order?select=${encodeURIComponent(t)}`);if(r.data.success)p.add({severity:"success",summary:s("success"),detail:s("cart.orderSuccess"),life:3e3}),await q(),m.value="all";else throw new Error(r.data.message||s("cart.checkoutError"))}catch(t){p.add({severity:"error",summary:s("error"),detail:t.message||s("cart.checkoutError"),life:3e3})}},F=l=>{m.value=l};return et(q),(l,t)=>(n(),i("div",at,[e("div",lt,[e("div",ot,[e("div",nt,[e("h2",it,o(c(s)("cart.orderDetails")),1),t[1]||(t[1]=e("i",{class:"pi pi-shopping-cart text-green-600 text-2xl mx-2"},null,-1))]),e("div",ct,[e("span",null,o(V.value)+" "+o(c(s)("currency")),1),e("span",dt,o(c(s)("cart.subtotal")),1)]),e("div",ut,[e("span",pt,"-"+o(W.value)+" "+o(c(s)("currency")),1),e("span",mt,o(c(s)("cart.discount")),1)]),e("div",_t,[e("span",null,o(Q.value)+" "+o(c(s)("currency")),1),e("span",null,o(c(s)("cart.total")),1)]),e("button",{class:"bg-green-600 text-white rounded-full py-3 mt-8 font-bold text-lg shadow-lg hover:bg-green-700 transition duration-300",disabled:w.value||x.value.length===0,onClick:O},o(c(s)("cart.checkout")),9,ft),e("div",xt,[t[2]||(t[2]=e("i",{class:"pi pi-check-circle text-green-600 mr-1"},null,-1)),e("span",null,o(c(s)("cart.securePayment")),1)])]),e("div",gt,[e("div",yt,[e("button",{class:j(["px-4 py-2 rounded-lg shadow-sm border",m.value==="all"?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border-gray-200 hover:bg-gray-100"]),onClick:t[0]||(t[0]=r=>F("all"))},o(c(s)("cart.all")),3),(n(!0),i(g,null,y(_.value,r=>(n(),i("button",{key:r.warehouse_id,class:j(["px-4 py-2 rounded-lg shadow-sm border",m.value===r.warehouse_id?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border-gray-200 hover:bg-gray-100"]),onClick:a=>F(r.warehouse_id)},o(r.warehouse_name),11,vt))),128))]),w.value?(n(),i("div",bt,[U(c(st),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):!w.value&&x.value.length===0?(n(),i("div",ht,[e("p",null,o(c(s)("cart.empty")),1)])):(n(),i("div",wt,[e("div",kt,[e("h2",qt,o(c(s)("cart.requestedItems"))+" ("+o(N.value)+")",1),t[3]||(t[3]=e("i",{class:"pi pi-box text-green-600 text-2xl mx-2"},null,-1))]),N.value===0?(n(),i("div",Ct,o(c(s)("cart.noPurchasedItems")),1)):b("",!0),(n(!0),i(g,null,y(k.value,r=>(n(),i("div",{key:r.warehouse_id,class:"mb-6"},[m.value!=="all"&&M(r).length>0?(n(),i("h3",Et,o(r.name),1)):b("",!0),(n(!0),i(g,null,y(M(r),a=>{var u,v,C;return n(),i("div",{key:a.id,class:"flex flex-col sm:flex-row items-center justify-between border-b pb-4 mb-4 last:border-b-0 last:mb-0"},[e("div",jt,[e("div",It,[(v=(u=a.product.media)==null?void 0:u[0])!=null&&v.url?(n(),i("img",{key:0,src:a.product.media[0].url,alt:a.product.commercial_name,class:"w-full h-full object-cover rounded-xl",loading:"lazy",onError:z},null,40,St)):(n(),i("i",{key:1,class:j(["pi",P(a.product.scientific_structure[0]),"text-green-600 text-2xl"])},null,2))]),e("div",Mt,[e("h3",Gt,o(a.product.commercial_name),1),e("p",$t,o(a.description||c(s)("cart.defaultDescription")),1),e("div",Dt,[(n(!0),i(g,null,y(a.product.scientific_structure,d=>(n(),i("span",{key:d,class:"bg-gray-200 text-gray-800 text-xs font-medium px-3 py-1 rounded-full"},o(d),1))),128))]),a.total_discounts>0?(n(),i("p",Tt,o(c(s)("cart.discount"))+": -"+o(a.total_discounts)+" "+o(c(s)("currency")),1)):b("",!0),a.product.has_active_offer&&((C=a.product.active_offers)!=null&&C.length)?(n(),i("div",Nt,[(n(!0),i(g,null,y(a.product.active_offers,d=>{var L;return n(),i("div",{key:d.id,class:j(["bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 text-green-800 text-xs font-medium p-3 rounded-lg",{"ring-2 ring-green-500":T(a.quantity,d)}])},[e("p",Pt,o(d.description),1),e("p",zt,[t[4]||(t[4]=e("i",{class:"pi pi-gift mr-1"},null,-1)),e("strong",null,o(c(s)("cart.gift"))+":",1),S(" "+o(d.gift_quantity)+" × "+o(((L=d.gift_product)==null?void 0:L.commercial_name)||c(s)("cart.unknownGift")),1)]),e("p",null,[e("strong",null,o(c(s)("cart.minLimit"))+":",1),S(" "+o(d.min_limit)+" "+o(B(d.quantity_unit))+" ",1),t[5]||(t[5]=e("span",{class:"mx-2"},"|",-1)),e("strong",null,o(c(s)("cart.maxLimit"))+":",1),S(" "+o(d.max_limit)+" "+o(B(d.quantity_unit)),1)]),T(a.quantity,d)?(n(),i("p",Bt,[t[6]||(t[6]=e("i",{class:"pi pi-check-circle mr-1"},null,-1)),S(" "+o(c(s)("cart.eligibleGifts",{count:A(a.quantity,d)})),1)])):(n(),i("p",Ft,o(c(s)("cart.needMore",{needed:d.min_limit-a.quantity})),1)),e("p",Lt,o(c(s)("cart.validUntil"))+": "+o(R(d.end_date)),1)],2)}),128))])):b("",!0)])]),e("div",Ut,[e("div",Vt,[e("span",Wt,o(a.total_price)+" "+o(c(s)("currency")),1),e("button",{class:"text-red-500 p-2 rounded-full mx-4 hover:bg-gray-300 transition duration-300",disabled:f.value[a.id],onClick:d=>H(a.id)},[...t[7]||(t[7]=[e("i",{class:"pi pi-trash text-lg"},null,-1)])],8,Qt)]),e("div",Rt,[e("button",{class:"w-8 h-8 rounded-full text-green-600 font-bold hover:bg-gray-300 transition duration-300",disabled:f.value[a.id],onClick:d=>J(a.id)}," + ",8,At),e("span",Ht,o(a.quantity),1),e("button",{class:"w-8 h-8 rounded-full text-green-600 font-bold hover:bg-gray-300 transition duration-300",disabled:f.value[a.id]||a.quantity<=1,onClick:d=>K(a.id)}," - ",8,Jt)])])])}),128))]))),128))])),$.value>0?(n(),i("hr",Kt)):b("",!0),$.value>0?(n(),i("div",Ot,[e("div",Xt,[e("h2",Yt,o(c(s)("cart.eligibleGiftsTitle"))+" ("+o($.value)+")",1),t[8]||(t[8]=e("i",{class:"pi pi-gift text-purple-600 text-2xl mx-2"},null,-1))]),(n(!0),i(g,null,y(k.value,r=>(n(),i("div",{key:r.warehouse_id,class:"mb-6"},[m.value!=="all"&&G(r).length>0?(n(),i("h3",Zt,o(r.name),1)):b("",!0),(n(!0),i(g,null,y(G(r),a=>{var u,v;return n(),i("div",{key:a.id,class:"flex flex-col sm:flex-row items-center justify-between border border-purple-200 bg-purple-50 rounded-xl p-4 mb-4"},[e("div",te,[e("div",ee,[(v=(u=a.product.media)==null?void 0:u[0])!=null&&v.url?(n(),i("img",{key:0,src:a.product.media[0].url,alt:a.product.commercial_name,class:"w-full h-full object-cover rounded-xl opacity-70",loading:"lazy",onError:z},null,40,se)):(n(),i("i",{key:1,class:j(["pi",P(a.product.scientific_structure[0]),"text-purple-600 text-2xl"])},null,2))]),e("div",re,[e("h3",ae,o(a.product.commercial_name),1),e("p",le,o(c(s)("cart.gift"))+" - "+o(c(s)("cart.complimentary")),1),e("div",oe,[(n(!0),i(g,null,y(a.product.scientific_structure,C=>(n(),i("span",{key:C,class:"bg-purple-200 text-purple-800 text-xs font-medium px-3 py-1 rounded-full"},o(C),1))),128))])])]),e("div",ne,[e("span",ie,o(c(s)("cart.free")),1),t[11]||(t[11]=e("button",{class:"p-2 rounded-full mx-4 text-gray-400 cursor-not-allowed",disabled:""},[e("i",{class:"pi pi-trash text-lg"})],-1)),e("div",ce,[t[9]||(t[9]=e("button",{class:"w-8 h-8 rounded-full text-purple-600 font-bold",disabled:""}," + ",-1)),e("span",de,o(a.quantity),1),t[10]||(t[10]=e("button",{class:"w-8 h-8 rounded-full text-purple-600 font-bold",disabled:""}," - ",-1))])])])}),128))]))),128))])):b("",!0)])]),U(c(rt))]))}},_e=X(ue,[["__scopeId","data-v-e4fa774a"]]);export{_e as default};
