import{_ as ie,u as ne,a as de,r as v,m as W,a7 as re,o as ce,d as y,a8 as Z,Z as S,e as g,h as b,g as s,i as o,w as u,t as d,j as l,C as w,b as U,a9 as ue,B as m,A as f}from"./index-2cd76906.js";const pe={class:"grid"},ve={class:"col-12"},ye={class:"p-4 card shadow-2 border-round"},me={class:"text-2xl font-bold"},fe={class:"flex gap-2 align-items-center"},_e={class:"p-input-icon-left"},he={class:"card shadow-1 surface-0"},ge={class:"py-4 text-center"},be={class:"text-xl"},xe={class:"flex py-4 justify-content-center align-items-center"},we={key:0,class:"mt-3 text-600 text-sm text-right"},Ve={class:"p-fluid"},ke={class:"field my-3"},Ce={class:"py-1",for:"name"},Te={key:0,class:"p-error"},De={class:"field my-3"},Se={class:"py-1",for:"lat"},Ue={key:0,class:"p-error"},Fe={class:"field my-3"},Ne={class:"py-1",for:"long"},Ie={key:0,class:"p-error"},$e={class:"field my-3"},Ee={class:"py-1",for:"type"},Be={class:"p-fluid"},Me={class:"field my-3"},je={class:"py-1",for:"name"},Le={key:0,class:"p-error"},Re={class:"field my-3"},qe={class:"py-1",for:"lat"},ze={key:0,class:"p-error"},Ae={class:"field my-3"},He={class:"py-1",for:"long"},Oe={key:0,class:"p-error"},Ge={class:"field my-3"},Qe={class:"py-1",for:"type"},We={class:"flex align-items-center justify-content-center"},Ze={__name:"index",setup(Je){const{t:e}=ne(),_=de(),V=v(0),j=v(!0),k=v([]),z=v(""),F=v(!1),C=v(!1),T=v(!1),x=v(null),A=v(null),B=v({}),N=v(""),L=v({}),i=v({name:"",lat:"",long:"",type:"pharmacy"}),r=v({name:!1,lat:!1,long:!1,type:!1}),I=async()=>{j.value=!0;try{const n=V.value===0?"pharmacy":"warehouse",a=await U.get("/api/city",{params:{limit:1e6,search:N.value,type:n}});k.value=a.data.data||[]}catch{_.add({severity:"error",summary:e("error"),detail:e("city.loadError"),life:3e3})}finally{j.value=!1}},J=()=>{var n;return(n=A.value)==null?void 0:n.exportCSV()},K=n=>{z.value=n,F.value=!0},P=async()=>{try{await U.delete(`/api/city/${z.value}`),await I(),F.value=!1,_.add({severity:"success",summary:e("success"),detail:e("city.deleteSuccess"),life:3e3})}catch{_.add({severity:"error",summary:e("error"),detail:e("city.deleteError"),life:3e3})}},X=async n=>{var a,p;L.value[n]=!0;try{const c=k.value.find($=>$.id===n),h=c.status;c.status=c.status===1?0:1,await U.post(`/api/city/change-status/${n}`),I()}catch(c){const h=k.value.find($=>$.id===n);h&&(h.status=h.status===1?0:1),_.add({severity:"error",summary:e("error"),detail:((p=(a=c.response)==null?void 0:a.data)==null?void 0:p.message)||e("city.statusChangeError"),life:4e3})}finally{L.value[n]=!1}},Y=()=>{B.value={global:{value:null,matchMode:ue.CONTAINS}}},M=()=>{i.value={name:"",lat:"",long:"",type:V.value===0?"pharmacy":"warehouse"},x.value=null,r.value={name:!1,lat:!1,long:!1,type:!1}},ee=()=>{const n=parseFloat(i.value.lat),a=parseFloat(i.value.long);return r.value.name=!i.value.name.trim(),r.value.type=!["pharmacy","warehouse"].includes(i.value.type),r.value.lat=isNaN(n)||n<-90||n>90,r.value.long=isNaN(a)||a<-180||a>180,!Object.values(r.value).some(p=>p)},ae=()=>{M(),C.value=!0},le=async n=>{x.value=n;try{const a=await U.get(`/api/city/${n}`);i.value={name:a.data.data.name,lat:String(a.data.data.lat),long:String(a.data.data.long),type:a.data.data.type},T.value=!0}catch{_.add({severity:"error",summary:e("error"),detail:e("city.loadError"),life:3e3})}},H=async()=>{var a,p;if(!ee()){_.add({severity:"warn",summary:e("validation.error"),detail:e("validation.fixErrors"),life:4e3});return}const n={name:i.value.name.trim(),lat:parseFloat(i.value.lat),long:parseFloat(i.value.long),type:i.value.type};try{x.value?await U.put(`/api/city/${x.value}`,n):await U.post("/api/city",n),await I(),C.value=T.value=!1,_.add({severity:"success",summary:e("success"),detail:x.value?e("city.updateSuccess"):e("city.createSuccess"),life:3e3}),M()}catch(c){const h=((p=(a=c.response)==null?void 0:a.data)==null?void 0:p.message)||e("city.saveError");_.add({severity:"error",summary:e("error"),detail:h,life:5e3})}};return W(V,()=>{N.value="",B.value.global.value=null,I()}),W(N,n=>{B.value.global.value=n}),re(Y),ce(I),(n,a)=>{const p=y("InputText"),c=y("Button"),h=y("Toolbar"),$=y("Toast"),O=y("TabPanel"),te=y("TabView"),D=y("Column"),se=y("ProgressSpinner"),oe=y("DataTable"),G=y("Dropdown"),R=y("Dialog"),E=Z("can"),q=Z("tooltip");return S((g(),b("div",pe,[s("div",ve,[s("div",ye,[o(h,{class:"mb-4"},{start:u(()=>[s("h2",me,d(V.value===0?l(e)("city.pharmacy"):l(e)("city.warehouse")),1)]),end:u(()=>[s("div",fe,[s("span",_e,[a[16]||(a[16]=s("i",{class:"pi pi-search"},null,-1)),o(p,{modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=t=>N.value=t),placeholder:l(e)("search"),class:"w-full md:w-20rem"},null,8,["modelValue","placeholder"])]),S(o(c,{label:l(e)("city.export"),icon:"pi pi-upload",class:"p-button-outlined",onClick:J},null,8,["label"]),[[E,"export cities"]]),S(o(c,{label:l(e)("city.new"),icon:"pi pi-plus",class:"p-button-success",onClick:ae},null,8,["label"]),[[E,"create cities"]])])]),_:1}),o($),o(te,{activeIndex:V.value,"onUpdate:activeIndex":a[1]||(a[1]=t=>V.value=t),class:"mb-4"},{default:u(()=>[o(O,{header:l(e)("city.pharmacy")},null,8,["header"]),o(O,{header:l(e)("city.warehouse")},null,8,["header"])]),_:1},8,["activeIndex"]),s("div",he,[o(oe,{ref_key:"dt",ref:A,value:k.value,loading:j.value,"data-key":"id",paginator:!1,filters:B.value,globalFilterFields:["name","lat","long","type"],responsiveLayout:"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{empty:u(()=>[s("div",ge,[a[17]||(a[17]=s("i",{class:"mb-2 text-2xl pi pi-exclamation-circle"},null,-1)),s("p",be,d(l(e)("city.noData")),1)])]),loading:u(()=>[s("div",xe,[o(se,{style:{width:"50px",height:"50px"},strokeWidth:"4"})])]),default:u(()=>[o(D,{field:"id",header:"ID",sortable:!0,style:{width:"60px"}},{body:u(t=>[m(d(t.data.id),1)]),_:1}),o(D,{field:"name",header:l(e)("city.name"),sortable:!0},{body:u(t=>[m(d(t.data.name),1)]),_:1},8,["header"]),o(D,{field:"lat",header:l(e)("city.lat"),sortable:!0},{body:u(t=>[m(d(t.data.lat),1)]),_:1},8,["header"]),o(D,{field:"long",header:l(e)("city.long"),sortable:!0},{body:u(t=>[m(d(t.data.long),1)]),_:1},8,["header"]),o(D,{field:"status_description",header:l(e)("status_description"),sortable:!0},{body:u(t=>[m(d(t.data.status_description),1)]),_:1},8,["header"]),o(D,{header:l(e)("actions"),headerStyle:"min-width:12rem"},{body:u(t=>[S(o(c,{icon:"pi pi-pencil",class:"p-detail",onClick:Q=>le(t.data.id)},null,8,["onClick"]),[[E,"edit cities"],[q,l(e)("edit"),void 0,{top:!0}]]),S(o(c,{icon:"pi pi-trash",class:"p-delete mx-1",onClick:Q=>K(t.data.id)},null,8,["onClick"]),[[E,"delete cities"],[q,l(e)("delete"),void 0,{top:!0}]]),S(o(c,{icon:t.data.status===1?"pi pi-ban":"pi pi-check-circle",class:f(["0",t.data.status===1?"p-detail":"p-delete"]),loading:L.value[t.data.id],onClick:Q=>X(t.data.id)},null,8,["icon","class","loading","onClick"]),[[q,t.data.status===1?l(e)("deactivate"):l(e)("activate"),void 0,{top:!0}]])]),_:1},8,["header"])]),_:1},8,["value","loading","filters"]),k.value.length>0?(g(),b("div",we,d(l(e)("total"))+": "+d(k.value.length)+" "+d(l(e)("entries")),1)):w("",!0)]),o(R,{visible:C.value,"onUpdate:visible":a[7]||(a[7]=t=>C.value=t),style:{width:"500px"},header:x.value?l(e)("city.editTitle"):l(e)("city.createTitle"),modal:!0,onHide:M},{footer:u(()=>[o(c,{label:l(e)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:a[6]||(a[6]=t=>C.value=T.value=!1)},null,8,["label"]),o(c,{label:l(e)("save"),icon:"pi pi-check",class:"p-button-success",onClick:H},null,8,["label"])]),default:u(()=>[s("div",Ve,[s("div",ke,[s("p",Ce,[m(d(l(e)("city.name"))+" ",1),a[18]||(a[18]=s("span",{class:"text-red-500"},"*",-1))]),o(p,{id:"name",modelValue:i.value.name,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value.name=t),placeholder:l(e)("city.name"),class:f({"p-invalid":r.value.name})},null,8,["modelValue","placeholder","class"]),r.value.name?(g(),b("small",Te,d(l(e)("validation.required")),1)):w("",!0)]),s("div",De,[s("p",Se,[m(d(l(e)("city.lat"))+" ",1),a[19]||(a[19]=s("span",{class:"text-red-500"},"*",-1))]),o(p,{id:"lat",modelValue:i.value.lat,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value.lat=t),type:"number",step:"0.000001",placeholder:"e.g. 30.0444 (-90 to 90)",class:f({"p-invalid":r.value.lat})},null,8,["modelValue","class"]),r.value.lat?(g(),b("small",Ue,d(l(e)("validation.latRange"))+" (-90 to 90) ",1)):w("",!0)]),s("div",Fe,[s("p",Ne,[m(d(l(e)("city.long"))+" ",1),a[20]||(a[20]=s("span",{class:"text-red-500"},"*",-1))]),o(p,{id:"long",modelValue:i.value.long,"onUpdate:modelValue":a[4]||(a[4]=t=>i.value.long=t),type:"number",step:"0.000001",placeholder:"e.g. 31.2357 (-180 to 180)",class:f({"p-invalid":r.value.long})},null,8,["modelValue","class"]),r.value.long?(g(),b("small",Ie," Please enter a longitude between -180 and 180. ")):w("",!0)]),s("div",$e,[s("p",Ee,d(l(e)("city.type")),1),o(G,{modelValue:i.value.type,"onUpdate:modelValue":a[5]||(a[5]=t=>i.value.type=t),options:[{label:l(e)("city.pharmacy"),value:"pharmacy"},{label:l(e)("city.warehouse"),value:"warehouse"}],optionLabel:"label",optionValue:"value",placeholder:l(e)("city.selectType"),class:f({"p-invalid":r.value.type})},null,8,["modelValue","options","placeholder","class"])])])]),_:1},8,["visible","header"]),o(R,{visible:T.value,"onUpdate:visible":a[13]||(a[13]=t=>T.value=t),style:{width:"500px"},header:x.value?l(e)("city.editTitle"):l(e)("city.createTitle"),modal:!0,onHide:M},{footer:u(()=>[o(c,{label:l(e)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:a[12]||(a[12]=t=>C.value=T.value=!1)},null,8,["label"]),o(c,{label:l(e)("save"),icon:"pi pi-check",class:"p-button-success",onClick:H},null,8,["label"])]),default:u(()=>[s("div",Be,[s("div",Me,[s("p",je,[m(d(l(e)("city.name"))+" ",1),a[21]||(a[21]=s("span",{class:"text-red-500"},"*",-1))]),o(p,{id:"name",modelValue:i.value.name,"onUpdate:modelValue":a[8]||(a[8]=t=>i.value.name=t),placeholder:l(e)("city.name"),class:f({"p-invalid":r.value.name})},null,8,["modelValue","placeholder","class"]),r.value.name?(g(),b("small",Le,d(l(e)("validation.required")),1)):w("",!0)]),s("div",Re,[s("p",qe,[m(d(l(e)("city.lat"))+" ",1),a[22]||(a[22]=s("span",{class:"text-red-500"},"*",-1))]),o(p,{id:"lat",modelValue:i.value.lat,"onUpdate:modelValue":a[9]||(a[9]=t=>i.value.lat=t),type:"number",step:"0.000001",placeholder:"e.g. 30.0444 (-90 to 90)",class:f({"p-invalid":r.value.lat})},null,8,["modelValue","class"]),r.value.lat?(g(),b("small",ze,d(l(e)("validation.latRange"))+" (-90 to 90) ",1)):w("",!0)]),s("div",Ae,[s("p",He,[m(d(l(e)("city.long"))+" ",1),a[23]||(a[23]=s("span",{class:"text-red-500"},"*",-1))]),o(p,{id:"long",modelValue:i.value.long,"onUpdate:modelValue":a[10]||(a[10]=t=>i.value.long=t),type:"number",step:"0.000001",placeholder:"e.g. 31.2357 (-180 to 180)",class:f({"p-invalid":r.value.long})},null,8,["modelValue","class"]),r.value.long?(g(),b("small",Oe," Please enter a longitude between -180 and 180. ")):w("",!0)]),s("div",Ge,[s("p",Qe,d(l(e)("city.type")),1),o(G,{modelValue:i.value.type,"onUpdate:modelValue":a[11]||(a[11]=t=>i.value.type=t),options:[{label:l(e)("city.pharmacy"),value:"pharmacy"},{label:l(e)("city.warehouse"),value:"warehouse"}],optionLabel:"label",optionValue:"value",placeholder:l(e)("city.selectType"),class:f({"p-invalid":r.value.type})},null,8,["modelValue","options","placeholder","class"])])])]),_:1},8,["visible","header"]),o(R,{visible:F.value,"onUpdate:visible":a[15]||(a[15]=t=>F.value=t),style:{width:"450px"},header:l(e)("city.deleteConfirmTitle"),modal:!0},{footer:u(()=>[o(c,{label:l(e)("no"),icon:"pi pi-times",class:"p-button-text",onClick:a[14]||(a[14]=t=>F.value=!1)},null,8,["label"]),o(c,{label:l(e)("yes"),icon:"pi pi-check",class:"p-button-danger",onClick:P},null,8,["label"])]),default:u(()=>[s("div",We,[a[24]||(a[24]=s("i",{class:"mr-3 pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"var(--red-500)"}},null,-1)),s("span",null,d(l(e)("city.deleteConfirmMessage")),1)])]),_:1},8,["visible","header"])])])])),[[E,"list cities"]])}}},Pe=ie(Ze,[["__scopeId","data-v-09e8418e"]]);export{Pe as default};
