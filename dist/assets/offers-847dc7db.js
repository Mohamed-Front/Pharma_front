import{_ as W,u as z,e as D,r as v,d as G,w as M,a as R,f as r,g as n,m as t,t as i,z as f,l as d,F as L,k as P,j as V,y as x,i as B,v as F,q,G as H,D as J,C as w,A as K}from"./index-b2b8894e.js";const X={class:"bg-gray-50 min-h-screen"},Y={class:"py-10 px-4 max-w-7xl mx-auto"},Z={class:"text-2xl md:text-3xl font-bold text-gray-900 mb-8 text-center"},ee={class:"flex justify-center mb-8"},ae={class:"relative w-full max-w-lg"},te={key:0,class:"flex justify-center mb-10"},se={key:1,class:"text-center text-gray-500 py-10"},le={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10"},re={class:"flex justify-between"},ne={class:"flex justify-between items-start mb-2"},ie={class:"bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-full"},oe={class:"text-lg md:text-xl font-bold text-gray-900"},de={class:"text-sm text-gray-600"},ce=["src","alt"],ue={class:"flex items-center gap-2 my-3"},ge={class:"text-sm text-gray-700"},me={class:"text-sm text-gray-700"},_e={class:"flex flex-wrap gap-2 mb-4"},pe={class:"flex flex-col gap-2 mb-4"},ve={class:"flex items-center gap-2"},xe={class:"text-green-800 text-sm font-bold"},ye=["title"],fe={class:"flex gap-4 text-xs text-gray-700 mt-1"},he={key:0},be={key:1},we={key:0,class:"bg-gray-100 text-gray-600 text-xs font-semibold px-2 py-1 rounded-full w-fit"},ke={class:"flex items-center justify-between w-full mt-auto mb-4"},Ce={class:"text-lg md:text-xl font-bold text-green-600"},$e={key:3,class:"flex justify-center items-center gap-2"},je={key:0,class:"px-4 py-2 text-gray-500"},Le={__name:"offers",setup(Pe){const{t:o}=z(),k=D(),y=v([]),u=v(1),c=v(1),h=v(!1),m=v(""),b=v({}),C=v(localStorage.getItem("appLang")||"ar"),E=[{id:0,product_id:0,name_en:"Fallback Product",name_ar:"منتج احتياطي",pharmaceutical_form:"Unknown",scientific_structure:[],discount:[],price:0,media:[{url:"/images/fallback-product.jpg"}],warehouse:{name:"Unknown Warehouse",address:"Unknown Address"}}],U=async(l=1)=>{var s,e;h.value=!0;try{const _=m.value?`search=${encodeURIComponent(m.value)}&`:"",p=await q.get(`/api/pharmacy-home/get/offers?${_}page=${l}`);if(p.data.success&&((s=p.data.data)==null?void 0:s.length)>0){if(y.value=p.data.data.filter(a=>a.warehouse).map(a=>{var O,S;return{id:a.id,product_id:a.id,name_en:a.commercial_name||"Unknown Product",name_ar:a.commercial_name||"منتج غير معروف",pharmaceutical_form:a.pharmaceutical_form||"Unknown",scientific_structure:a.scientific_structure||[],discount:a.active_offers.length>0?a.active_offers.map(g=>{var T;let j="";if(g.discount_type===3){const Q=((T=g.gift_product)==null?void 0:T.commercial_name)||"Unknown Gift";j=` ${g.gift_quantity||1}x ${Q}`}else g.discount_type===1?j=`${g.discount_value}% OFF`:g.discount_type===2&&(j=`$${g.discount_value} OFF`);return{id:g.id,display:j,description:g.description||"No description",min_limit:g.min_limit,max_limit:g.max_limit}}):[],price:parseFloat(a.price)||0,media:a.media||[{url:"/images/fallback-product.jpg"}],warehouse:{name:((O=a.warehouse)==null?void 0:O.name)||"Unknown Warehouse",address:((S=a.warehouse)==null?void 0:S.address)||"Unknown Address"}}}),c.value=p.data.pagination.last_page||1,u.value=p.data.pagination.current_page||1,y.value.length===0)throw new Error("No valid products found")}else y.value=E,c.value=1,u.value=1,k.add({severity:"warn",summary:o("warning"),detail:o("error.noOffers"),life:3e3})}catch(_){y.value=E,c.value=1,u.value=1,k.add({severity:"error",summary:o("error"),detail:o("error.fetchOffers"),life:3e3}),console.error("Error fetching offers:",((e=_.response)==null?void 0:e.data)||_.message)}finally{h.value=!1}},A=async l=>{var s;b.value[l]=!0;try{const e=await q.post("/api/cart/add/item",{product_id:l,quantity:1});if(e.data.success)k.add({severity:"success",summary:o("success"),detail:o("cart.addSuccess"),life:3e3});else throw new Error(e.data.message||o("error.addToCart"))}catch(e){k.add({severity:"error",summary:o("error"),detail:e.message||o("error.addToCart"),life:3e3}),console.error("Error adding to cart:",((s=e.response)==null?void 0:s.data)||e.message)}finally{b.value[l]=!1}},N=G(()=>m.value?y.value.filter(l=>(C.value==="en"?l.name_en.toLowerCase():l.name_ar.toLowerCase()).includes(m.value.toLowerCase())||l.scientific_structure.some(s=>s.toLowerCase().includes(m.value.toLowerCase()))):y.value),$=l=>{l>=1&&l<=c.value&&(u.value=l,U(l))},I=l=>{l.target.src="/images/fallback-product.jpg"};return M(m,()=>{u.value=1,U(1)}),R(()=>{U()}),(l,s)=>(r(),n("div",X,[t("div",Y,[t("h1",Z,i(l.$t("navigation.offers")),1),t("div",ee,[t("div",ae,[f(d(H),{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),placeholder:d(o)("navbar.search"),class:"w-full p-3 pr-12 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent","aria-label":"Search offers"},null,8,["modelValue","placeholder"])])]),h.value?(r(),n("div",te,[f(d(J),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):!h.value&&N.value.length===0?(r(),n("div",se,i(d(o)("error.noOffers")),1)):(r(),n("div",le,[(r(!0),n(L,null,P(N.value,e=>{var _,p;return r(),n("div",{key:e.id,class:"bg-white rounded-xl shadow-md p-4 relative overflow-hidden flex flex-col"},[t("div",re,[t("div",null,[t("div",ne,[t("span",ie,i(d(o)("offers.only")),1)]),t("div",null,[t("h3",oe,i(C.value==="en"?e.name_en:e.name_ar),1),t("p",de,i(e.pharmaceutical_form),1)])]),t("div",null,[(p=(_=e.media)==null?void 0:_[0])!=null&&p.url?(r(),n("img",{key:0,src:e.media[0].url,alt:C.value==="en"?e.name_en:e.name_ar,class:"w-16 h-16 object-cover rounded-lg",onError:I},null,40,ce)):x("",!0)])]),t("div",ue,[s[4]||(s[4]=t("i",{class:"pi pi-map-marker text-green-600 text-lg"},null,-1)),t("span",ge,i(e.warehouse.name),1),s[5]||(s[5]=t("i",{class:"pi pi-building text-green-600 text-lg"},null,-1)),t("span",me,i(e.warehouse.address),1)]),t("div",_e,[(r(!0),n(L,null,P(e.scientific_structure,a=>(r(),n("span",{key:a,class:"bg-gray-200 text-gray-800 text-xs font-medium px-3 py-1 rounded-full"},i(a),1))),128))]),t("div",pe,[(r(!0),n(L,null,P(e.discount,a=>(r(),n("div",{key:a.id,class:F(["flex flex-col p-2 rounded-lg",{"bg-green-100":a.min_limit||a.max_limit,"bg-red-100":!a.min_limit&&!a.max_limit}])},[t("div",ve,[t("span",xe,i(a.display),1),t("span",{class:"text-gray-600 text-xs truncate",title:a.description},"("+i(a.description.slice(0,25))+i(a.description.length>25?"...":"")+")",9,ye)]),t("div",fe,[a.min_limit!==null?(r(),n("span",he,i(l.$t("offerss.minLimit"))+": "+i(a.min_limit),1)):x("",!0),a.max_limit!==null?(r(),n("span",be,i(l.$t("offerss.maxLimit"))+": "+i(a.max_limit),1)):x("",!0)])],2))),128)),e.discount.length?x("",!0):(r(),n("span",we,i(d(o)("noOffers")),1))]),t("div",ke,[t("span",Ce,i(e.price+"$"),1)]),f(d(w),{label:b.value[e.product_id]?d(o)("cart.adding"):d(o)("cart.addToCart"),icon:b.value[e.product_id]?"pi pi-spin pi-spinner ml-2":"pi pi-cart-plus ml-2",class:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 w-full rounded-lg transition-colors flex items-center justify-center",disabled:b.value[e.product_id],onClick:a=>A(e.product_id),"aria-label":d(o)("cart.addToCart")+" "+(C.value==="en"?e.name_en:e.name_ar)},null,8,["label","icon","disabled","onClick","aria-label"])])}),128))])),!h.value&&c.value>1?(r(),n("div",$e,[f(d(w),{disabled:u.value===1,class:"px-4 py-2 bg-white text-gray-600 rounded-lg shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors disabled:opacity-50","aria-label":"Previous page",onClick:s[1]||(s[1]=e=>$(u.value-1))},{default:V(()=>[...s[6]||(s[6]=[t("i",{class:"pi pi-chevron-right"},null,-1)])]),_:1},8,["disabled"]),(r(!0),n(L,null,P(Math.min(c.value,5),e=>(r(),B(d(w),{key:e,label:e.toString(),class:F([u.value===e?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-100","px-4 py-2 rounded-lg shadow-sm transition-colors"]),onClick:_=>$(e),"aria-label":"Page "+e},null,8,["label","class","onClick","aria-label"]))),128)),c.value>5?(r(),n("span",je,"...")):x("",!0),c.value>5?(r(),B(d(w),{key:1,label:c.value.toString(),class:F([u.value===c.value?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-100","px-4 py-2 rounded-lg shadow-sm transition-colors"]),onClick:s[2]||(s[2]=e=>$(c.value)),"aria-label":"Page "+c.value},null,8,["label","class","aria-label"])):x("",!0),f(d(w),{disabled:u.value===c.value,class:"px-4 py-2 bg-white text-gray-600 rounded-lg shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors disabled:opacity-50","aria-label":"Next page",onClick:s[3]||(s[3]=e=>$(u.value+1))},{default:V(()=>[...s[7]||(s[7]=[t("i",{class:"pi pi-chevron-left"},null,-1)])]),_:1},8,["disabled"])])):x("",!0),f(d(K))])]))}},Ee=W(Le,[["__scopeId","data-v-f18f9bda"]]);export{Ee as default};
