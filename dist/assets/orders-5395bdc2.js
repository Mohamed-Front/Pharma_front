import{_ as Y,u as Z,e as I,r as g,f as l,g as d,m as e,t as a,l as r,x as _,z as $,j as T,y as D,q as j,D as O,F as M,k as S,i as ee,v as w,B as te,R as U,S as R,T as se,U as oe,N as ae,A as re}from"./index-b2b8894e.js";const ne={class:"bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen p-4 sm:p-6 md:p-8 font-sans"},ie={class:"max-w-7xl mx-auto bg-white rounded-2xl shadow-2xl p-6 sm:p-8"},le={class:"flex flex-col sm:flex-row items-center justify-between gap-4 mb-8"},de={class:"text-3xl sm:text-4xl font-extrabold text-gray-900 tracking-tight"},ce={class:"flex items-center gap-3"},ue={key:0,class:"flex justify-center py-16"},ge={key:1,class:"text-center py-16"},me={class:"mt-4 text-lg text-gray-500 font-medium"},ve={key:2,class:"space-y-4"},_e={class:"w-full grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 items-center gap-4 p-4 bg-gray-50 hover:bg-gray-100 transition-colors duration-200 rounded-lg"},pe={class:"text-sm font-semibold text-gray-900 truncate"},ye={class:"text-sm text-gray-600 truncate hidden sm:inline"},he={class:"text-sm text-gray-600 truncate"},xe={class:"text-sm font-bold text-gray-900 hidden lg:inline text-right"},fe=["onClick","disabled"],be={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},we={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ke={key:0,class:"flex justify-center p-6"},Ce={key:1,class:"p-6 text-center text-red-600 font-medium bg-red-50 rounded-lg"},Ee={key:2,class:"p-6 bg-gray-50 rounded-lg"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},$e={class:"space-y-3"},De={class:"text-gray-900"},je={class:"text-gray-600"},Me={class:"text-gray-900"},Le={class:"text-gray-600"},Be={class:"text-gray-900"},He={class:"text-gray-600"},Ne={class:"space-y-3"},Se={class:"text-gray-900"},Te={class:"font-bold text-indigo-600"},Ve={class:"text-gray-900"},ze={class:"text-gray-600"},Ae={class:"text-gray-900"},Oe={class:"text-gray-600"},Ue={class:"mb-8"},Re={class:"text-xl font-semibold text-gray-900 mb-4"},We={class:"flex flex-col gap-4"},Fe=["onUpdate:modelValue","placeholder"],qe={class:"flex justify-end gap-3"},Ge=["onClick","disabled"],Qe=["onClick","disabled"],Je={key:0,class:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ke={class:"mb-8"},Xe={class:"text-xl font-semibold text-gray-900 mb-2"},Ye={key:0,class:"text-gray-500 text-center py-2 bg-gray-100 rounded-lg"},Ze={key:1,class:"space-y-4"},Ie={class:"flex items-center justify-between mb-2"},et={class:"text-xs text-gray-500"},tt={class:"text-gray-800"},st={class:"text-xl font-semibold text-gray-900 mb-2"},ot={key:0,class:"text-gray-500 text-center py-2 bg-gray-100 rounded-lg"},at={key:1,class:"overflow-x-auto border border-gray-200 rounded-lg shadow-md"},rt={class:"w-full table-auto border-collapse"},nt={class:"bg-gray-200 text-gray-700 text-left rtl:text-right text-sm"},it={class:"p-4 font-semibold w-1/4"},lt={class:"p-4 font-semibold w-1/12"},dt={class:"p-4 font-semibold w-1/12"},ct={class:"p-4 font-semibold w-1/12"},ut={class:"p-4 font-semibold w-1/12"},gt={class:"p-4 font-semibold w-1/4 text-center"},mt=["onClick"],vt={class:"p-4 text-gray-700 font-medium"},_t={class:"p-4 text-gray-600"},pt={class:"p-4 text-gray-600"},yt={class:"p-4 text-gray-600"},ht={class:"p-4 text-indigo-600 font-bold"},xt={class:"p-4 text-center"},ft={class:"text-sm font-medium text-indigo-600 hover:text-indigo-800 flex items-center justify-center gap-1 mx-auto"},bt={class:"ml-1 text-xs px-2 py-0.5 bg-indigo-200 text-indigo-800 rounded-full"},wt={key:0},kt={colspan:6,class:"p-4 bg-white/90 border-t border-indigo-200"},Ct={class:"p-4 space-y-6"},Et={class:"space-y-3"},Pt={class:"font-semibold text-gray-800"},$t={key:0,class:"text-gray-500 text-center py-3 bg-gray-50 rounded-lg"},Dt={key:1,class:"space-y-2 max-h-48 overflow-y-auto pr-2"},jt={class:"flex items-center justify-between text-xs mb-1"},Mt={class:"text-gray-500"},Lt={class:"text-sm text-gray-800"},Bt={class:"pt-4 border-t border-gray-200"},Ht={class:"font-semibold text-gray-800 mb-2"},Nt={class:"flex flex-col gap-3"},St=["onUpdate:modelValue","placeholder"],Tt={class:"flex justify-end"},Vt=["onClick","disabled"],zt={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},At={key:3,class:"mt-8"},Ot={__name:"orders",setup(Ut){const{t:s}=Z({missingWarn:!1,fallbackWarn:!1}),m=I(),f=g([]),L=g(!1),E=g(1),k=g(10),V=g(0),u=g({}),z=g(null),y=g({}),C=g({}),P=g({}),b=g(null),h=g({}),B=g({}),W=(n,t)=>n.items.find(o=>o.id===t),F=n=>{b.value=b.value===n?null:n},H=async()=>{var n,t,o;L.value=!0;try{const c=await j.get(`/api/order?page=${E.value}&limit=${k.value}`);c.data.success&&c.data.data?(f.value=c.data.data,V.value=((n=c.data.pagination)==null?void 0:n.total)||f.value.length,k.value=((t=c.data.pagination)==null?void 0:t.per_page)||k.value,E.value=((o=c.data.pagination)==null?void 0:o.current_page)||E.value,u.value={},y.value={},C.value={},P.value={},b.value=null,h.value={}):(f.value=[],m.add({severity:"warn",summary:s("warning"),detail:s("orders.empty"),life:3e3}))}catch(c){f.value=[],m.add({severity:"error",summary:s("error"),detail:s("orders.fetchError"),life:3e3}),console.error("Error fetching orders:",c)}finally{L.value=!1}},q=async(n,t)=>{var o;if(!((o=u.value[t])!=null&&o.data)){u.value[t]={loading:!0,data:null,error:!1};try{const c=await j.get(`/api/order/${t}`);if(c.data.success&&c.data.data){const x=c.data.data;x.items=x.items.map(v=>({...v,comments:v.comments||[]})),u.value[t]={loading:!1,data:x,error:!1},x.items.forEach(v=>{h.value[v.id]||(h.value[v.id]="")})}else throw new Error("Invalid response data")}catch(c){u.value[t]={loading:!1,data:null,error:!0},m.add({severity:"error",summary:s("error"),detail:s("orders.detailsError"),life:3e3}),console.error(`Error fetching order ${t}:`,c)}}},G=async n=>{P.value[n]=!0;try{if((await j.post(`/api/order/revert/${n}`)).data.success)m.add({severity:"success",summary:s("success"),detail:s("orders.revertSuccess"),life:3e3}),await H();else throw new Error("Invalid response data")}catch(t){m.add({severity:"error",summary:s("error"),detail:s("orders.revertError"),life:3e3}),console.error(`Error reverting order ${n} to cart:`,t)}finally{P.value[n]=!1}},Q=async n=>{var t;if(!((t=y.value[n])!=null&&t.trim())){m.add({severity:"warn",summary:s("warning"),detail:s("orders.commentEmpty"),life:3e3});return}C.value[n]=!0;try{const o=await j.post(`/api/order/comment/${n}`,{body:y.value[n].trim()});if(o.data.success&&o.data.data)u.value[n].data.comments.push({id:o.data.data.id,body:o.data.data.body,created_at:o.data.data.created_at||new Date().toISOString(),is_you:!0}),y.value[n]="",m.add({severity:"success",summary:s("success"),detail:s("orders.commentSuccess"),life:3e3});else throw new Error("Invalid response data")}catch(o){m.add({severity:"error",summary:s("error"),detail:s("orders.commentError"),life:3e3}),console.error(`Error submitting comment for order ${n}:`,o)}finally{C.value[n]=!1}},J=async(n,t)=>{var o;if(!((o=h.value[t])!=null&&o.trim())){m.add({severity:"warn",summary:s("warning"),detail:s("orders.commentEmpty"),life:3e3});return}B.value[t]=!0;try{const c=await j.post(`/api/order/item/comment/${t}`,{body:h.value[t].trim()});if(c.data.success&&c.data.data){const x=u.value[n].data,v=W(x,t);v&&v.comments.push({id:c.data.data.id,body:c.data.data.body,created_at:c.data.data.created_at||new Date().toISOString(),is_you:!0}),h.value[t]="",m.add({severity:"success",summary:s("success"),detail:s("orders.itemCommentSuccess"),life:3e3})}else throw new Error("Invalid response data")}catch(c){m.add({severity:"error",summary:s("error"),detail:s("orders.itemCommentError"),life:3e3}),console.error(`Error submitting item comment for item ${t}:`,c)}finally{B.value[t]=!1}},K=n=>{y.value[n]=""},X=n=>{E.value=n.page+1,k.value=n.rows,z.value=null,b.value=null,H()},N=n=>!n||isNaN(Date.parse(n))?s("orders.invalidDate"):new Date(n).toLocaleDateString(s("locale")==="ar"?"ar-EG":"en-US",{day:"2-digit",month:"long",year:"numeric"});return H(),(n,t)=>(l(),d("div",ne,[e("div",ie,[e("div",le,[e("h2",de,a(r(s)("orders.title")),1),e("div",ce,[e("button",{onClick:H,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center gap-2"},[t[1]||(t[1]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),_(" "+a(r(s)("refresh")),1)])])]),L.value?(l(),d("div",ue,[$(r(O),{style:{width:"60px",height:"60px"},strokeWidth:"4",class:"text-indigo-500"})])):!L.value&&f.value.length===0?(l(),d("div",ge,[t[2]||(t[2]=e("svg",{class:"mx-auto w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h18M3 3v18M3 3l18 18M3 21h18M3 21l18-18"})],-1)),e("p",me,a(r(s)("orders.empty")),1)])):(l(),d("div",ve,[$(r(oe),{activeIndex:z.value,onTabOpen:t[0]||(t[0]=o=>q(o.index,f.value[o.index].id))},{default:T(()=>[(l(!0),d(M,null,S(f.value,o=>(l(),ee(r(se),{key:o.id},{header:T(()=>[e("div",_e,[e("span",pe,a(o.number),1),e("span",ye,a(N(o.created_at)),1),e("span",he,a(o.warehouse.name),1),e("span",{class:w(["px-3 py-1 text-xs font-semibold rounded-full text-white capitalize",{"bg-green-500":o.status_description==="delivered","bg-red-500":o.status_description==="cancelled","bg-blue-500":o.status_description==="reverted","bg-yellow-500":o.status_description==="pending"}])},a(r(s)(`orders.status.${o.status_description}`)),3),e("span",xe,a(o.total_price),1),e("button",{onClick:te(c=>G(o.id),["stop"]),class:"px-3 py-1 bg-green-600 text-white text-xs font-semibold rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center gap-2",disabled:P.value[o.id]},[P.value[o.id]?(l(),d("svg",be,[...t[3]||(t[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(l(),d("svg",we,[...t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"},null,-1)])])),_(" "+a(r(s)("sell")),1)],8,fe)])]),default:T(()=>{var c,x,v;return[(c=u.value[o.id])!=null&&c.loading?(l(),d("div",ke,[$(r(O),{style:{width:"40px",height:"40px"},strokeWidth:"4",class:"text-indigo-500"})])):(x=u.value[o.id])!=null&&x.error?(l(),d("div",Ce,a(r(s)("orders.detailsError")),1)):(v=u.value[o.id])!=null&&v.data?(l(),d("div",Ee,[e("div",Pe,[e("div",$e,[e("p",null,[e("strong",De,a(r(s)("orders.id"))+":",1),t[5]||(t[5]=_()),e("span",je,a(u.value[o.id].data.number),1)]),e("p",null,[e("strong",Me,a(r(s)("orders.date"))+":",1),t[6]||(t[6]=_()),e("span",Le,a(N(u.value[o.id].data.created_at)),1)]),e("p",null,[e("strong",Be,a(r(s)("orders.pharmacy"))+":",1),t[7]||(t[7]=_()),e("span",He,a(u.value[o.id].data.pharmacy.name),1)])]),e("div",Ne,[e("p",null,[e("strong",Se,a(r(s)("orders.totalPrice"))+":",1),t[8]||(t[8]=_()),e("span",Te,a(u.value[o.id].data.total_price),1)]),e("p",null,[e("strong",Ve,a(r(s)("orders.totalDiscounts"))+":",1),t[9]||(t[9]=_()),e("span",ze,a(u.value[o.id].data.total_discounts),1)]),e("p",null,[e("strong",Ae,a(r(s)("orders.delivery"))+":",1),t[10]||(t[10]=_()),e("span",Oe,a(u.value[o.id].data.delivery),1)])])]),t[14]||(t[14]=e("hr",{class:"my-8 border-gray-200"},null,-1)),e("div",Ue,[e("h3",Re,a(r(s)("orders.addComment"))+" ("+a(r(s)("orders.orderLevel"))+")",1),e("div",We,[U(e("textarea",{"onUpdate:modelValue":i=>y.value[o.id]=i,placeholder:r(s)("orders.commentPlaceholder"),class:"w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-y",rows:"4"},null,8,Fe),[[R,y.value[o.id]]]),e("div",qe,[e("button",{onClick:i=>K(o.id),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors duration-200",disabled:!y.value[o.id]||C.value[o.id]},a(r(s)("orders.clear")),9,Ge),e("button",{onClick:i=>Q(o.id),class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center gap-2",disabled:!y.value[o.id]||C.value[o.id]},[C.value[o.id]?(l(),d("svg",Je,[...t[11]||(t[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):D("",!0),_(" "+a(r(s)("orders.submitComment")),1)],8,Qe)])])]),t[15]||(t[15]=e("hr",{class:"my-8 border-gray-200"},null,-1)),e("div",Ke,[e("h3",Xe,a(r(s)("orders.comments"))+" ("+a(r(s)("orders.orderLevel"))+")",1),u.value[o.id].data.comments.length===0?(l(),d("div",Ye,a(r(s)("orders.noComments")),1)):(l(),d("div",Ze,[(l(!0),d(M,null,S(u.value[o.id].data.comments,i=>(l(),d("div",{key:i.id,class:w(["p-4 rounded-lg shadow-sm transition-all duration-200",i.is_you?"bg-indigo-50 hover:bg-indigo-100":"bg-gray-100 hover:bg-gray-200"])},[e("div",Ie,[e("p",{class:w(["font-semibold text-sm",i.is_you?"text-indigo-700":"text-gray-700"])},a(i.is_you?r(s)("orders.you"):u.value[o.id].data.warehouse.name),3),e("p",et,a(N(i.created_at)),1)]),e("p",tt,a(i.body),1)],2))),128))]))]),t[16]||(t[16]=e("hr",{class:"my-8 border-gray-200"},null,-1)),e("div",null,[e("h3",st,a(r(s)("orders.items")),1),u.value[o.id].data.items.length===0?(l(),d("div",ot,a(r(s)("orders.noItems")),1)):(l(),d("div",at,[e("table",rt,[e("thead",null,[e("tr",nt,[e("th",it,a(r(s)("orders.itemsProduct")),1),e("th",lt,a(r(s)("orders.itemsQuantity")),1),e("th",dt,a(r(s)("orders.itemsOriginalPrice")),1),e("th",ct,a(r(s)("orders.itemsTotalDiscounts")),1),e("th",ut,a(r(s)("orders.itemsTotalPrice")),1),e("th",gt,a(r(s)("orders.itemCommentAction")),1)])]),e("tbody",null,[(l(!0),d(M,null,S(u.value[o.id].data.items,i=>{var A;return l(),d(M,{key:i.id},[e("tr",{onClick:p=>F(i.id),class:w(["border-b border-gray-100 transition-colors duration-200 cursor-pointer",b.value===i.id?"bg-indigo-100/50 hover:bg-indigo-100":"hover:bg-gray-50"])},[e("td",vt,a(i.product.commercial_name),1),e("td",_t,a(i.quantity),1),e("td",pt,a(i.original_price),1),e("td",yt,a(i.total_discounts),1),e("td",ht,a(i.total_price),1),e("td",xt,[e("button",ft,[(l(),d("svg",{class:w(["w-4 h-4 transform transition-transform duration-200",{"rotate-180":b.value===i.id}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[12]||(t[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2)),_(" "+a(b.value===i.id?r(s)("orders.hideComments"):r(s)("orders.viewComments"))+" ",1),e("span",bt,a(((A=i.comments)==null?void 0:A.length)||0),1)])])],10,mt),b.value===i.id?(l(),d("tr",wt,[e("td",kt,[e("div",Ct,[e("div",Et,[e("h4",Pt,a(r(s)("orders.existingItemComments")),1),!i.comments||i.comments.length===0?(l(),d("div",$t,a(r(s)("orders.noItemComments")),1)):(l(),d("div",Dt,[(l(!0),d(M,null,S(i.comments,p=>(l(),d("div",{key:p.id,class:w(["p-3 rounded-lg shadow-xs",p.is_you?"bg-indigo-50 border border-indigo-200":"bg-gray-100 border border-gray-200"])},[e("div",jt,[e("span",{class:w(["font-medium",p.is_you?"text-indigo-700":"text-gray-700"])},a(p.is_you?r(s)("orders.you"):u.value[o.id].data.warehouse.name),3),e("span",Mt,a(N(p.created_at)),1)]),e("p",Lt,a(p.body),1)],2))),128))]))]),e("div",Bt,[e("h4",Ht,a(r(s)("orders.addItemComment")),1),e("div",Nt,[U(e("textarea",{"onUpdate:modelValue":p=>h.value[i.id]=p,placeholder:r(s)("orders.itemCommentPlaceholder"),class:"w-full p-3 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-y",rows:"3"},null,8,St),[[R,h.value[i.id]]]),e("div",Tt,[e("button",{onClick:p=>J(o.id,i.id),class:"px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center gap-2",disabled:!h.value[i.id]||B.value[i.id]},[B.value[i.id]?(l(),d("svg",zt,[...t[13]||(t[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):D("",!0),_(" "+a(r(s)("orders.submitComment")),1)],8,Vt)])])])])])])):D("",!0)],64)}),128))])])]))])])):D("",!0)]}),_:2},1024))),128))]),_:1},8,["activeIndex"])])),f.value.length>0?(l(),d("div",At,[$(r(ae),{rows:k.value,totalRecords:V.value,first:(E.value-1)*k.value,onPage:X,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown ",rowsPerPageOptions:[10,20,50],class:"bg-white p-4 rounded-lg shadow-sm"},null,8,["rows","totalRecords","first"])])):D("",!0),$(r(re))])]))}},Wt=Y(Ot,[["__scopeId","data-v-aa9227c0"]]);export{Wt as default};
