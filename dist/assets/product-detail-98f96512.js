import{_ as P,j as F,i as R,P as N,u as j,r as g,w as B,d as L,o as c,c as d,k as r,t as l,m as i,y,l as O,q as p,F as v,x as w,z as k,B as $,D as S,A as q}from"./index-d45c326e.js";const U={class:"bg-white"},V={class:"py-12 px-4 max-w-7xl m-auto"},I={class:"flex flex-col items-center justify-center text-center mb-10"},M={class:"text-2xl md:text-3xl font-extrabold text-gray-800"},z={key:0,class:"flex justify-center mb-10"},A={key:1,class:"bg-white rounded-xl shadow-md p-6 max-w-3xl mx-auto"},K={class:"flex flex-col md:flex-row gap-6"},W={class:"flex-shrink-0"},G=["src","alt"],H={class:"flex-1"},J={class:"text-2xl font-bold text-gray-900 mb-2"},Q={class:"text-sm text-gray-600 mb-2"},X={class:"text-sm text-gray-600 mb-2"},Y={class:"text-sm text-gray-600 mb-2"},Z={key:0,class:"text-sm text-gray-600 mb-2"},ee={class:"flex flex-wrap gap-2 mb-4"},te={class:"flex items-center justify-between mb-4"},ae={class:"flex flex-wrap gap-2"},se=["title"],re={key:0,class:"bg-gray-100 text-gray-600 text-xs font-semibold px-2 py-1 rounded-full"},oe={class:"text-xl font-bold text-green-600"},le={key:2,class:"text-center text-gray-600"},ne={__name:"product-detail",setup(ie){const m=F();R();const f=N(),{t}=j(),e=g(null),_=g(!0),x=g(!1),C=g(localStorage.getItem("appLang")||"en"),h={id:0,commercial_name:"Sample Product",scientific_structure:["Unknown"],price:"0.00",pharmaceutical_form:"Unknown",category:{name_en:"Unknown",name_ar:"غير معروف"},company:{name:"Unknown Company"},media:[{url:"/assets/fallback-image.png"}],offers:[],warehouse_id:0,in_cart:!1},b=async()=>{var n,a;_.value=!0;try{const o=await $.get(`/api/pharmacy-home/product/${f.params.id}`);o.data&&o.data.data?e.value={...o.data.data,discount:o.data.data.offers.map(s=>({id:s.id,discount_type:s.discount_type,discount_value:s.discount_value,display:s.discount_type===1?`${s.discount_value}% OFF`:`$${s.discount_value} OFF`,description:s.status==="expired"?"Expired Offer":`Buy ${s.min_limit}-${s.max_limit} units`})),tags:((n=o.data.data.scientific_structure)==null?void 0:n.length)>0?o.data.data.scientific_structure:[t("tags.unknown")]}:(e.value=h,m.add({severity:"warn",summary:t("warning"),detail:t("error.noProduct"),life:3e3}))}catch(o){e.value=h;let s=t("error.fetchProduct");((a=o.response)==null?void 0:a.status)===404?s=t("error.productNotFound"):o.code==="ERR_NETWORK"&&(s=t("error.network")),m.add({severity:"error",summary:t("error"),detail:s,life:3e3}),console.error("Error fetching product:",o)}finally{_.value=!1}},E=async n=>{var a,o;x.value=!0;try{const s=await $.post("/api/cart/add/item",{product_id:n,quantity:1});if(s.data.success)e.value&&(e.value.in_cart=!0),m.add({severity:"success",summary:t("success"),detail:t("cart.addSuccess"),life:3e3});else throw new Error(s.data.message||t("error.addToCart"))}catch(s){m.add({severity:"error",summary:t("error"),detail:((o=(a=s.response)==null?void 0:a.data)==null?void 0:o.message)||t("error.addToCart"),life:3e3}),console.error("Error adding to cart:",s)}finally{x.value=!1}},T=n=>({كبسولة:"pi-capsules",حقن:"pi-syringe",قرص:"pi-pill",شراب:"pi-bottle",222:"pi-pill",44:"pi-syringe"})[n]||"pi-tablet",D=n=>{n.target.src="/assets/fallback-image.png"};return B(()=>f.params.id,(n,a)=>{n&&n!==a&&(console.log(`Route ID changed from ${a} to ${n}. Refetching data.`),e.value=null,_.value=!0,b())},{immediate:!1}),L(()=>{b()}),(n,a)=>{var o,s;return c(),d("div",U,[r("div",V,[r("div",I,[r("h2",M,l(i(t)("product.details")),1)]),_.value?(c(),d("div",z,[...a[1]||(a[1]=[r("i",{class:"pi pi-spin pi-spinner text-3xl text-gray-600"},null,-1)])])):e.value?(c(),d("div",A,[r("div",K,[r("div",W,[(s=(o=e.value.media)==null?void 0:o[0])!=null&&s.url?(c(),d("img",{key:0,src:e.value.media[0].url,alt:e.value.commercial_name,class:"w-48 h-48 object-cover rounded-lg",onError:D},null,40,G)):y("",!0)]),r("div",H,[r("h3",J,l(e.value.commercial_name),1),r("p",Q,[r("i",{class:O(["pi",T(e.value.pharmaceutical_form),"mr-1"])},null,2),p(" "+l(e.value.pharmaceutical_form||i(t)("unknown")),1)]),r("p",X,[a[2]||(a[2]=r("i",{class:"pi pi-tag mr-1"},null,-1)),p(" "+l(i(t)("category"))+": "+l(C.value==="ar"?e.value.category.name_ar:e.value.category.name_en),1)]),r("p",Y,[a[3]||(a[3]=r("i",{class:"pi pi-building mr-1"},null,-1)),p(" "+l(i(t)("company"))+": "+l(e.value.company.name),1)]),e.value.expiration_to?(c(),d("p",Z,[a[4]||(a[4]=r("i",{class:"pi pi-calendar mr-1"},null,-1)),p(" "+l(i(t)("expires"))+": "+l(new Date(e.value.expiration_to).toLocaleDateString()),1)])):y("",!0),r("div",ee,[(c(!0),d(v,null,w(e.value.tags,u=>(c(),d("span",{key:u,class:"bg-gray-200 text-gray-800 text-xs font-medium px-3 py-1 rounded-full"},l(u),1))),128))]),r("div",te,[r("div",ae,[(c(!0),d(v,null,w(e.value.discount,u=>(c(),d("span",{key:u.id,class:"bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full truncate",title:u.description},l(u.display),9,se))),128)),!e.value.discount||!e.value.discount.length?(c(),d("span",re,l(i(t)("noOffers")),1)):y("",!0)]),r("span",oe,[p(l(e.value.price)+"$ ",1),e.value.price_unit!==1&&e.value.quantity_unit?(c(),d(v,{key:0},[p(" per "+l(e.value.quantity_unit),1)],64)):y("",!0)])]),k(i(S),{label:x.value?i(t)("cart.adding"):e.value.in_cart?i(t)("cart.addToCart"):i(t)("cart.addToCart"),icon:x.value?"pi pi-spin pi-spinner mr-2":"pi pi-cart-plus mr-2",class:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 w-full rounded-lg transition-colors",onClick:a[0]||(a[0]=u=>E(e.value.id)),"aria-label":i(t)("cart.addToCart")+" "+e.value.commercial_name},null,8,["label","icon","aria-label"])])])])):(c(),d("div",le,l(i(t)("error.noProduct")),1)),a[5]||(a[5]=p(" < ",-1)),k(i(q))])])}}},de=P(ne,[["__scopeId","data-v-a7c0088f"]]);export{de as default};
