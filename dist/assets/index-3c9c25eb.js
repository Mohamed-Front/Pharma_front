import{_ as le,s as se,u as ie,e as oe,r as c,d as re,w as I,a as ne,f as n,g as u,m as i,z as r,l as t,j as w,y as $,t as d,F as P,k as L,q as k,C as V,I as B,i as M,J as U,K as de,L as T,M as ce,v as j,x as ue,N as pe,a7 as me,a8 as ve,G as W,Q as O,X as fe}from"./index-b2b8894e.js";const _e={class:"min-h-screen bg-gray-100 flex justify-center items-start p-4"},ye={class:"w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden"},he={class:"p-4 flex justify-end"},ge=["aria-selected"],be=["aria-selected"],xe=["id"],we={key:0,class:"flex justify-end mb-4"},ke={key:1,class:"flex flex-col items-center justify-center h-64 text-gray-500"},Ee={class:"text-lg"},$e={key:2,class:"space-y-4"},Ve={class:"flex justify-between items-start p-4"},Ne={key:3,class:"space-y-4"},Ce=["onClick","aria-label"],Pe={class:"flex justify-between items-center"},Ae={class:"flex-1 min-w-0"},Re={class:"items-center mx-4"},Se={class:"text-gray-400 text-sm flex-shrink-0"},De={key:0,class:"mt-2 text-xs text-gray-500"},Le={key:4,class:"flex flex-col items-center justify-center h-64 text-gray-500"},Te={class:"text-lg"},je={class:"p-fluid space-y-4"},Fe={class:"field"},qe={for:"type",class:"block text-sm font-medium text-gray-700"},Ie={key:0,class:"field"},Be={for:"ids",class:"block text-sm font-medium text-gray-700"},Me={class:"field"},Ue={for:"title_en",class:"block text-sm font-medium text-gray-700"},We={class:"field"},Oe={for:"title_ar",class:"block text-sm font-medium text-gray-700"},ze={class:"field"},Ge={for:"body_en",class:"block text-sm font-medium text-gray-700"},He={class:"field"},Je={for:"body_ar",class:"block text-sm font-medium text-gray-700"},Ke={__name:"index",setup(Qe){const F=se(),{t:a}=ie(),p=oe(),h=c(!0),g=c(null),A=()=>({data:[],total:0,unread_count:0,current_page:1,last_page:1}),v=c(A()),f=c(A()),m=c(0),N=c([]),b=c(1),R=c(10),E=c(!1),o=c({type:"",ids:[],title_en:"",title_ar:"",body_en:"",body_ar:""}),z=c([{label:a("notifications.pharmacy")||"Pharmacy",value:"pharmacy"},{label:a("notifications.warehouse")||"Warehouse",value:"warehouse"}]),S=c([]),D=c([]),G=re(()=>o.value.type==="pharmacy"?S.value:o.value.type==="warehouse"?D.value:[]),H=l=>{if(!l)return"";const e=new Date,s=new Date(l),_=Math.floor((e-s)/(1e3*60)),y=Math.floor(_/60);return y>0?`${a("since")||"since"} ${y} ${a("hours_ago")||"hours ago"}`:_>0?`${a("since")||"since"} ${_} ${a("minutes_ago")||"minutes ago"}`:a("just_now")||"just now"},J=l=>{const e=s=>{const _=l[s]||{},y=_.data||[];return{data:y,total:_.total||0,unread_count:y.filter(C=>!C.read_at).length,current_page:_.current_page||1,last_page:_.last_page||1}};v.value=e("pharmacy_notifications"),f.value=e("warehouse_notifications")},q=()=>{let l;switch(m.value){case 0:l=v.value;break;case 1:l=f.value;break;default:l=A()}N.value=l.data,b.value=l.current_page},x=async(l=1)=>{h.value=!0,g.value=null;try{const e=await k.get(`/api/notification/get?page=${l}&per_page=${R.value}`);h.value=!1,J(e.data.data),q()}catch(e){h.value=!1,g.value=e.message||a("notification.loadError")||"Failed to load notifications.",p.add({severity:"error",summary:a("error")||"Error",detail:g.value,life:3e3}),console.error("Error fetching data:",e)}},K=async()=>{if(!(S.value.length>0))try{const l=await k.get("/api/pharmacy-request");S.value=l.data.data.map(e=>({label:e.name||e.id,value:e.id}))}catch(l){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.loadPharmaciesError")||"Failed to load pharmacies.",life:3e3}),console.error("Error fetching pharmacies:",l)}},Q=async()=>{if(!(D.value.length>0))try{const l=await k.get("/api/warehouse-request");D.value=l.data.data.map(e=>({label:e.name||e.id,value:e.id}))}catch(l){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.loadWarehousesError")||"Failed to load warehouses.",life:3e3}),console.error("Error fetching warehouses:",l)}},X=async l=>{if(!l.read_at)try{await k.post(`/api/notification/read/${l.id}`),l.read_at=new Date().toISOString(),v.value.unread_count=v.value.data.filter(e=>!e.read_at).length,f.value.unread_count=f.value.data.filter(e=>!e.read_at).length,p.add({severity:"success",summary:a("success")||"Success",detail:a("notification.markedRead")||"Notification marked as read.",life:1500})}catch(e){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.markAsReadError")||"Failed to mark notification as read.",life:3e3}),console.error("Error marking notification as read:",e)}},Y=async()=>{h.value=!0;try{const l=m.value===0?"pharmacy":"warehouse";await k.post(`/api/notification/read-all?type=${l}`);const e=l==="pharmacy"?v:f;e.value.data.forEach(s=>s.read_at=s.read_at||new Date().toISOString()),e.value.unread_count=0,p.add({severity:"success",summary:a("success")||"Success",detail:a("notification.markedAllRead")||"All notifications marked as read.",life:3e3}),x(b.value)}catch(l){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.markAllReadError")||"Failed to mark all notifications as read.",life:3e3}),console.error("Error marking all notifications as read:",l)}},Z=l=>{X(l),l.type==="pharmacy"?F.push({name:"pharmacy_request_show",params:{id:l.metadata.pharmacy_request_id}}):F.push({name:"warehouse_request_show",params:{id:l.metadata.warehouse_request_id}})},ee=async()=>{if(!o.value.type||o.value.ids.length===0||!o.value.title_en||!o.value.body_en){p.add({severity:"warn",summary:a("warning")||"Warning",detail:a("notification.missing_fields")||"Please fill all required fields (Type, Recipients, English Title, English Body).",life:3e3});return}try{await k.post("/api/notification/send",o.value),p.add({severity:"success",summary:a("success")||"Success",detail:a("notification.sent")||"Notification sent successfully.",life:3e3}),E.value=!1,o.value={type:"",ids:[],title_en:"",title_ar:"",body_en:"",body_ar:""},x(b.value)}catch(l){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.sendError")||"Failed to send notification.",life:3e3}),console.error("Error sending notification:",l)}},ae=l=>{m.value=l.index,x(1)},te=l=>{const e=l.page+1;b.value=e,x(e)};return I(m,q),I(()=>o.value.type,l=>{o.value.ids=[],l==="pharmacy"?K():l==="warehouse"&&Q()}),ne(()=>{x()}),(l,e)=>(n(),u(P,null,[i("div",_e,[i("div",ye,[i("div",he,[r(t(V),{label:t(a)("notification.send_notification")||"Send Notification",icon:"pi pi-send",severity:"primary",onClick:e[0]||(e[0]=s=>E.value=!0)},null,8,["label"])]),r(t(de),{"active-index":m.value,onTabChange:ae,class:"bg-gradient-to-r from-[#43A167] to-[#8fd3a9]",role:"tablist"},{default:w(()=>[r(t(B),null,{header:w(()=>[i("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":m.value===0,"aria-controls":"pharmacy-notifications"},[e[10]||(e[10]=i("i",{class:"pi pi-building text-xl"},null,-1)),i("span",null,d(t(a)("notifications.pharmacy_notes")||"Pharmacy Notes"),1),v.value.unread_count>0?(n(),M(t(U),{key:0,value:v.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):$("",!0)],8,ge)]),_:1}),r(t(B),null,{header:w(()=>[i("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":m.value===1,"aria-controls":"warehouse-notifications"},[e[11]||(e[11]=i("i",{class:"pi pi-box text-xl"},null,-1)),i("span",null,d(t(a)("notifications.warehouse_shipments")||"Warehouse Shipments"),1),f.value.unread_count>0?(n(),M(t(U),{key:0,value:f.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):$("",!0)],8,be)]),_:1})]),_:1},8,["active-index"]),i("div",{class:"p-6 bg-gray-50 min-h-[400px]",id:m.value===0?"pharmacy-notifications":"warehouse-notifications",role:"tabpanel"},[!h.value&&!g.value&&N.value.length>0?(n(),u("div",we,[r(t(V),{label:t(a)("notification.mark_all_read")||"Mark All As Read",icon:"pi pi-check-double",severity:"success",outlined:"",onClick:Y,disabled:m.value===0?v.value.unread_count===0:f.value.unread_count===0,class:"text-sm"},null,8,["label","disabled"])])):$("",!0),g.value?(n(),u("div",ke,[e[12]||(e[12]=i("i",{class:"pi pi-exclamation-triangle text-5xl mb-4 opacity-50"},null,-1)),i("p",Ee,d(g.value),1),r(t(V),{label:t(a)("retry")||"Retry",icon:"pi pi-refresh",class:"mt-4",onClick:e[1]||(e[1]=s=>x(b.value))},null,8,["label"])])):h.value?(n(),u("div",$e,[(n(),u(P,null,L(5,s=>r(t(ce),{key:s,class:"shadow-md rounded-lg"},{content:w(()=>[i("div",Ve,[r(t(T),{width:"60%",height:"1.5rem",class:"rounded"}),r(t(T),{width:"15%",height:"1rem",class:"rounded"})]),r(t(T),{width:"90%",height:"1rem",class:"mt-2 mx-4 rounded"})]),_:1})),64))])):N.value.length>0?(n(),u("div",Ne,[(n(!0),u(P,null,L(N.value,(s,_)=>(n(),u("div",{key:s.id,class:j(["notification-item p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer",{"bg-blue-50 border-l-4 border-[#43A167]":!s.read_at}]),onClick:y=>Z(s),role:"button","aria-label":s.title||t(a)("no_title")},[i("div",Pe,[i("div",Ae,[i("div",{class:j(["font-semibold text-lg truncate",{"text-gray-900":!s.read_at,"text-gray-500":s.read_at}])},d(s.title||t(a)("no_title")),3)]),i("div",Re,[i("p",Se,d(H(s.created_at)),1)])]),i("div",{class:j(["mt-2 text-sm leading-relaxed",{"text-gray-700":!s.read_at,"text-gray-500":s.read_at}])},d(s.body||t(a)("no_body")),3),s.metadata?(n(),u("div",De,[(n(!0),u(P,null,L(s.metadata,(y,C)=>(n(),u("span",{key:C},[ue(d(C)+": "+d(y),1),e[13]||(e[13]=i("br",null,null,-1))]))),128))])):$("",!0)],10,Ce))),128)),r(t(pe),{rows:R.value,totalRecords:m.value===0?v.value.total:f.value.total,first:(b.value-1)*R.value,onPage:te,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink"},null,8,["rows","totalRecords","first"])])):(n(),u("div",Le,[e[14]||(e[14]=i("i",{class:"pi pi-bell-slash text-5xl mb-4 opacity-50"},null,-1)),i("p",Te,d(t(a)("notification.noData")||"No notifications in this section."),1)]))],8,xe)])]),r(t(fe),{visible:E.value,"onUpdate:visible":e[9]||(e[9]=s=>E.value=s),header:t(a)("notification.send_notification")||"Send Notification",style:{width:"50vw"},modal:!0,class:"rounded-lg"},{footer:w(()=>[r(t(V),{label:t(a)("notification.cancel")||"Cancel",icon:"pi pi-times",text:"",onClick:e[8]||(e[8]=s=>E.value=!1)},null,8,["label"]),r(t(V),{label:t(a)("notification.send")||"Send",icon:"pi pi-check",onClick:ee,disabled:!o.value.type||o.value.ids.length===0||!o.value.title_en||!o.value.body_en},null,8,["label","disabled"])]),default:w(()=>[i("div",je,[i("div",Fe,[i("label",qe,d(t(a)("notification.type")||"Type"),1),r(t(me),{id:"type",modelValue:o.value.type,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.type=s),options:z.value,optionLabel:"label",optionValue:"value",placeholder:t(a)("notification.select_type")||"Select Type",class:"w-full"},null,8,["modelValue","options","placeholder"])]),o.value.type?(n(),u("div",Ie,[i("label",Be,d(t(a)("notification.recipients")||"Recipients"),1),r(t(ve),{id:"ids",modelValue:o.value.ids,"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.ids=s),options:G.value,optionLabel:"label",optionValue:"value",placeholder:t(a)("notification.select_recipients")||"Select Recipients",display:"chip",class:"w-full"},null,8,["modelValue","options","placeholder"])])):$("",!0),i("div",Me,[i("label",Ue,d(t(a)("notification.title_en")||"Title (English)"),1),r(t(W),{id:"title_en",modelValue:o.value.title_en,"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.title_en=s),placeholder:t(a)("notification.enter_title_en")||"Enter title in English",class:"w-full"},null,8,["modelValue","placeholder"])]),i("div",We,[i("label",Oe,d(t(a)("notification.title_ar")||"Title (Arabic)"),1),r(t(W),{id:"title_ar",modelValue:o.value.title_ar,"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.title_ar=s),placeholder:t(a)("notification.enter_title_ar")||"Enter title in Arabic",class:"w-full"},null,8,["modelValue","placeholder"])]),i("div",ze,[i("label",Ge,d(t(a)("notification.body_en")||"Body (English)"),1),r(t(O),{id:"body_en",modelValue:o.value.body_en,"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.body_en=s),placeholder:t(a)("notification.enter_body_en")||"Enter body in English",rows:"3",class:"w-full"},null,8,["modelValue","placeholder"])]),i("div",He,[i("label",Je,d(t(a)("notification.body_ar")||"Body (Arabic)"),1),r(t(O),{id:"body_ar",modelValue:o.value.body_ar,"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.body_ar=s),placeholder:t(a)("notification.enter_body_ar")||"Enter body in Arabic",rows:"3",class:"w-full"},null,8,["modelValue","placeholder"])])])]),_:1},8,["visible","header"])],64))}},Ye=le(Ke,[["__scopeId","data-v-0e6a94bc"]]);export{Ye as default};
