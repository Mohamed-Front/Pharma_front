import{_ as F,u as L,j as Q,i as R,r as x,g as w,d as A,o as d,c as u,k as o,t as l,m as i,l as C,F as k,x as E,z as $,B as b,E as U,y as S,A as G}from"./index-2f0b6a57.js";const H={class:"bg-gray-100 min-h-screen p-4 sm:p-8 font-[Inter]"},J={class:"max-w-7xl mx-auto flex flex-col lg:flex-row gap-8"},K={class:"flex-shrink-0 w-full lg:w-96 bg-white rounded-3xl shadow-lg p-6 flex flex-col items-stretch"},O={class:"flex items-center border-b pb-4 mb-4"},X={class:"text-xl font-bold"},Y={class:"flex justify-between py-2 text-gray-600"},Z={class:"font-medium"},ee={class:"flex justify-between py-2 text-gray-600"},te={class:"text-red-500"},se={class:"font-medium"},re={class:"flex justify-between font-bold text-lg border-t pt-4 mt-4"},ae=["disabled"],oe={class:"flex items-center justify-center mt-4 text-xs text-gray-500"},le={class:"flex-grow w-full bg-white rounded-3xl shadow-lg p-6 flex flex-col"},ie={class:"flex items-center border-b pb-4 mb-4"},ce={class:"text-xl font-bold"},ne={class:"flex flex-wrap gap-2 mb-6"},de=["onClick"],ue={key:0,class:"flex justify-center mb-10"},pe={key:1,class:"text-center text-gray-600 py-8"},_e={key:2},me={key:0,class:"text-lg font-semibold text-gray-700 mb-4"},fe={class:"flex items-center w-full sm:w-auto mb-4 sm:mb-0"},ye={class:"w-16 h-16 bg-green-100 rounded-xl flex items-center justify-center shrink-0"},ve=["src","alt"],ge={class:"flex-grow mx-4"},he={class:"font-bold text-lg"},xe={class:"text-sm text-gray-500"},be={class:"flex flex-wrap gap-2 mt-2"},we={key:0,class:"text-sm text-red-500 mt-1"},ke={class:"flex items-center w-full sm:w-auto justify-between sm:justify-start"},Ee={class:"flex items-center ml-4"},Ce={class:"font-bold text-lg"},qe=["disabled","onClick"],je={class:"flex items-center bg-gray-200 rounded-full px-2 py-1"},Ie=["disabled","onClick"],$e={class:"px-4 font-bold text-lg"},Se=["disabled","onClick"],Te={__name:"cart",setup(Me){const{t:r}=L(),_=Q();R();const m=x([]),c=x([]),p=x("all"),v=x(!1),f=x({}),q=w(()=>p.value==="all"?c.value:c.value.filter(t=>t.warehouse_id===p.value)),T=w(()=>{if(p.value==="all")return c.value.reduce((e,s)=>e+(s.original_price||0),0);const t=c.value.find(e=>e.warehouse_id===p.value);return t&&t.original_price||0}),M=w(()=>{if(p.value==="all")return c.value.reduce((e,s)=>e+(s.total_discounts||0),0);const t=c.value.find(e=>e.warehouse_id===p.value);return t&&t.total_discounts||0}),B=w(()=>{if(p.value==="all")return c.value.reduce((e,s)=>e+(s.total_price||0),0);const t=c.value.find(e=>e.warehouse_id===p.value);return t&&t.total_price||0}),D=t=>({Paracetamol:"pi-tablet",Caffeine:"pi-bolt"})[t]||"pi-tablet",P=t=>{t.target.style.display="none",t.target.nextElementSibling.style.display="block"},g=async()=>{v.value=!0;try{const t=await b.get("/api/cart/get");t.data.success&&t.data.data?(c.value=t.data.data.warehouses.map((e,s)=>({...e,name:e.warehouse_name||`Warehouse ${e.warehouse_id||s+1}`,items:e.items.map(a=>({...a,description:a.description||r("cart.defaultDescription")}))})),m.value=c.value.flatMap(e=>e.items)):(c.value=[],m.value=[],_.add({severity:"warn",summary:r("warning"),detail:r("cart.empty"),life:3e3}))}catch(t){c.value=[],m.value=[],_.add({severity:"error",summary:r("error"),detail:r("cart.fetchError"),life:3e3}),console.error("Error fetching cart:",t)}finally{v.value=!1}},W=async t=>{f.value[t]=!0;try{const e=m.value.find(a=>a.id===t);if(!e)return;const s=await b.post("/api/cart/remove/item",{item_id:e.id});if(s.data.success)c.value=c.value.map(a=>({...a,items:a.items.filter(n=>n.id!==t),original_price:a.items.filter(n=>n.id!==t).reduce((n,y)=>n+(y.original_price||0),0),total_discounts:a.items.filter(n=>n.id!==t).reduce((n,y)=>n+(y.total_discounts||0),0),total_price:a.items.filter(n=>n.id!==t).reduce((n,y)=>n+(y.total_price||0),0)})).filter(a=>a.items.length>0),m.value=m.value.filter(a=>a.id!==t),_.add({severity:"success",summary:r("success"),detail:r("cart.removeSuccess"),life:3e3}),g();else throw new Error(s.data.message||r("cart.removeError"))}catch(e){_.add({severity:"error",summary:r("error"),detail:e.message||r("cart.removeError"),life:3e3}),console.error("Error removing item:",e)}finally{f.value[t]=!1}},z=async t=>{f.value[t]=!0;const e=m.value.find(s=>s.id===t);if(e)try{const s=await b.post("/api/cart/add/item",{product_id:e.product_id,quantity:e.quantity+1});if(s.data.success)e.quantity++,e.original_price=e.product.price*e.quantity,e.total_price=e.original_price-(e.total_discounts||0),j(e.product.warehouse_id),_.add({severity:"success",summary:r("success"),detail:r("cart.updateSuccess"),life:3e3});else throw new Error(s.data.message||r("cart.updateError"))}catch(s){_.add({severity:"error",summary:r("error"),detail:s.message||r("cart.updateError"),life:3e3}),g(),console.error("Error incrementing quantity:",s)}finally{f.value[t]=!1}},N=async t=>{const e=m.value.find(s=>s.id===t);if(!(!e||e.quantity<=1)){f.value[t]=!0;try{const s=await b.post("/api/cart/add/item",{product_id:e.product_id,quantity:e.quantity-1});if(s.data.success)e.quantity--,e.original_price=e.product.price*e.quantity,e.total_price=e.original_price-(e.total_discounts||0),j(e.product.warehouse_id),_.add({severity:"success",summary:r("success"),detail:r("cart.updateSuccess"),life:3e3}),g();else throw new Error(s.data.message||r("cart.updateError"))}catch(s){_.add({severity:"error",summary:r("error"),detail:s.message||r("cart.updateError"),life:3e3}),console.error("Error decrementing quantity:",s)}finally{f.value[t]=!1}}},j=t=>{const e=c.value.find(s=>s.warehouse_id===t);e&&(e.original_price=e.items.reduce((s,a)=>s+(a.original_price||0),0),e.total_discounts=e.items.reduce((s,a)=>s+(a.total_discounts||0),0),e.total_price=e.items.reduce((s,a)=>s+(a.total_price||0),0))},V=async()=>{if(m.value.length===0){_.add({severity:"warn",summary:r("warning"),detail:r("cart.empty"),life:3e3});return}try{const t=[...new Set(q.value.flatMap(s=>s.items).map(s=>s.product.warehouse_id))].join(",");_.add({severity:"info",summary:r("info"),detail:r("cart.checkoutProcessing"),life:3e3});const e=await b.post(`/api/order?select=${encodeURIComponent(t)}`);if(e.data.success)_.add({severity:"success",summary:r("success"),detail:r("cart.orderSuccess"),life:3e3}),g(),p.value="all",c.value=[],m.value=[];else throw new Error(e.data.message||r("cart.checkoutError"))}catch(t){_.add({severity:"error",summary:r("error"),detail:t.message||r("cart.checkoutError"),life:3e3}),console.error("Error proceeding to checkout:",t)}},I=t=>{p.value=t};return A(g),(t,e)=>(d(),u("div",H,[o("div",J,[o("div",K,[o("div",O,[o("h2",X,l(i(r)("cart.orderDetails")),1),e[1]||(e[1]=o("i",{class:"pi pi-shopping-cart text-green-600 text-2xl mx-2"},null,-1))]),o("div",Y,[o("span",null,l(T.value)+" "+l(i(r)("currency")),1),o("span",Z,l(i(r)("cart.subtotal")),1)]),o("div",ee,[o("span",te,"-"+l(M.value)+" "+l(i(r)("currency")),1),o("span",se,l(i(r)("cart.discount")),1)]),o("div",re,[o("span",null,l(B.value)+" "+l(i(r)("currency")),1),o("span",null,l(i(r)("cart.total")),1)]),o("button",{class:"bg-green-600 text-white rounded-full py-3 mt-8 font-bold text-lg shadow-lg hover:bg-green-700 transition duration-300",disabled:v.value||m.value.length===0,onClick:V},l(i(r)("cart.checkout")),9,ae),o("div",oe,[e[2]||(e[2]=o("i",{class:"pi pi-check-circle text-green-600 mr-1"},null,-1)),o("span",null,l(i(r)("cart.securePayment")),1)])]),o("div",le,[o("div",ie,[o("h2",ce,l(i(r)("cart.requestedItems")),1),e[3]||(e[3]=o("i",{class:"pi pi-box text-green-600 text-2xl mx-2"},null,-1))]),o("div",ne,[o("button",{class:C(["px-4 py-2 rounded-lg shadow-sm border",p.value==="all"?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border-gray-200 hover:bg-gray-100"]),onClick:e[0]||(e[0]=s=>I("all"))},l(i(r)("cart.all")),3),(d(!0),u(k,null,E(c.value,s=>(d(),u("button",{key:s.warehouse_id,class:C(["px-4 py-2 rounded-lg shadow-sm border",p.value===s.warehouse_id?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border-gray-200 hover:bg-gray-100"]),onClick:a=>I(s.warehouse_id)},l(s.warehouse_name),11,de))),128))]),v.value?(d(),u("div",ue,[$(i(U),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):!v.value&&m.value.length===0?(d(),u("div",pe,[o("p",null,l(i(r)("cart.empty")),1)])):(d(),u("div",_e,[(d(!0),u(k,null,E(q.value,s=>(d(),u("div",{key:s.warehouse_id,class:"mb-6"},[p.value!=="all"?(d(),u("h3",me,l(s.name),1)):S("",!0),(d(!0),u(k,null,E(s.items,a=>{var n,y;return d(),u("div",{key:a.id,class:"flex flex-col sm:flex-row items-center justify-between border-b pb-4 mb-4 last:border-b-0 last:mb-0"},[o("div",fe,[o("div",ye,[(y=(n=a.product.media)==null?void 0:n[0])!=null&&y.url?(d(),u("img",{key:0,src:a.product.media[0].url,alt:a.product.commercial_name,class:"w-full h-full object-cover rounded-xl",loading:"lazy",onError:P},null,40,ve)):(d(),u("i",{key:1,class:C(["pi",D(a.product.scientific_structure[0]),"text-green-600 text-2xl"])},null,2))]),o("div",ge,[o("h3",he,l(a.product.commercial_name),1),o("p",xe,l(a.description||i(r)("cart.defaultDescription")),1),o("div",be,[(d(!0),u(k,null,E(a.product.scientific_structure,h=>(d(),u("span",{key:h,class:"bg-gray-200 text-gray-800 text-xs font-medium px-3 py-1 rounded-full"},l(h),1))),128))]),a.total_discounts>0?(d(),u("p",we,l(i(r)("cart.discount"))+": -"+l(a.total_discounts)+" "+l(i(r)("currency")),1)):S("",!0)])]),o("div",ke,[o("div",Ee,[o("span",Ce,l(a.total_price)+" "+l(i(r)("currency")),1),o("button",{class:"text-red-500 p-2 rounded-full mx-4 hover:bg-gray-300 transition duration-300",disabled:f.value[a.id],onClick:h=>W(a.id)},[...e[4]||(e[4]=[o("i",{class:"pi pi-trash text-lg"},null,-1)])],8,qe)]),o("div",je,[o("button",{class:"w-8 h-8 rounded-full text-green-600 font-bold hover:bg-gray-300 transition duration-300",disabled:f.value[a.id],onClick:h=>z(a.id)}," + ",8,Ie),o("span",$e,l(a.quantity),1),o("button",{class:"w-8 h-8 rounded-full text-green-600 font-bold hover:bg-gray-300 transition duration-300",disabled:f.value[a.id]||a.quantity<=1,onClick:h=>N(a.id)}," - ",8,Se)])])])}),128))]))),128))]))])]),$(i(G))]))}},De=F(Te,[["__scopeId","data-v-e2e7d06d"]]);export{De as default};
