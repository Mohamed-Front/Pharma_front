import{z as le,u as se,a as ie,r as c,c as oe,m as q,o as re,e as n,h as u,g as i,i as r,j as t,w,C as $,t as d,F as C,y as L,b as k,E as V,J as M,f as U,K as I,L as ne,M as T,N as de,A as j,B as ce,O as ue,ab as pe,ad as me,H as O,S as W,a1 as fe}from"./index-2cd76906.js";const ve={class:"min-h-screen bg-gray-100 flex justify-center items-start p-4"},_e={class:"w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden"},ye={class:"p-4 flex justify-end"},he=["aria-selected"],ge=["aria-selected"],be=["id"],xe={key:0,class:"flex justify-end mb-4"},we={key:1,class:"flex flex-col items-center justify-center h-64 text-gray-500"},ke={class:"text-lg"},Ee={key:2,class:"space-y-4"},$e={class:"flex justify-between items-start p-4"},Ve={key:3,class:"space-y-4"},Ne=["onClick","aria-label"],Ae={class:"flex justify-between items-center"},Ce={class:"flex-1 min-w-0"},Pe={class:"items-center mx-4"},Se={class:"text-gray-400 text-sm flex-shrink-0"},Re={key:0,class:"mt-2 text-xs text-gray-500"},De={key:4,class:"flex flex-col items-center justify-center h-64 text-gray-500"},Le={class:"text-lg"},Te={class:"p-fluid space-y-4"},je={class:"field"},Fe={for:"type",class:"block text-sm font-medium text-gray-700"},Be={key:0,class:"field"},qe={for:"ids",class:"block text-sm font-medium text-gray-700"},Me={class:"field"},Ue={for:"title_en",class:"block text-sm font-medium text-gray-700"},Ie={class:"field"},Oe={for:"title_ar",class:"block text-sm font-medium text-gray-700"},We={class:"field"},ze={for:"body_en",class:"block text-sm font-medium text-gray-700"},He={class:"field"},Je={for:"body_ar",class:"block text-sm font-medium text-gray-700"},Qe={__name:"index",setup(Ke){const F=le(),{t:a}=se(),p=ie(),h=c(!0),g=c(null),P=()=>({data:[],total:0,unread_count:0,current_page:1,last_page:1}),f=c(P()),v=c(P()),m=c(0),N=c([]),b=c(1),S=c(10),E=c(!1),o=c({type:"",ids:[],title_en:"",title_ar:"",body_en:"",body_ar:""}),z=c([{label:a("notifications.pharmacy")||"Pharmacy",value:"pharmacy"},{label:a("notifications.warehouse")||"Warehouse",value:"warehouse"}]),R=c([]),D=c([]),H=oe(()=>o.value.type==="pharmacy"?R.value:o.value.type==="warehouse"?D.value:[]),J=l=>{if(!l)return"";const e=new Date,s=new Date(l),_=Math.floor((e-s)/(1e3*60)),y=Math.floor(_/60);return y>0?`${a("since")||"since"} ${y} ${a("hours_ago")||"hours ago"}`:_>0?`${a("since")||"since"} ${_} ${a("minutes_ago")||"minutes ago"}`:a("just_now")||"just now"},K=l=>{const e=s=>{const _=l[s]||{},y=_.data||[];return{data:y,total:_.total||0,unread_count:y.filter(A=>!A.read_at).length,current_page:_.current_page||1,last_page:_.last_page||1}};f.value=e("pharmacy_notifications"),v.value=e("warehouse_notifications")},B=()=>{let l;switch(m.value){case 0:l=f.value;break;case 1:l=v.value;break;default:l=P()}N.value=l.data,b.value=l.current_page},x=async(l=1)=>{h.value=!0,g.value=null;try{const e=await k.get(`/api/notification/get?page=${l}&per_page=${S.value}`);h.value=!1,K(e.data.data),B()}catch(e){h.value=!1,g.value=e.message||a("notification.loadError")||"Failed to load notifications.",p.add({severity:"error",summary:a("error")||"Error",detail:g.value,life:3e3}),console.error("Error fetching data:",e)}},G=async()=>{if(!(R.value.length>0))try{const l=await k.get("/api/pharmacy-request");R.value=l.data.data.map(e=>({label:e.name||e.id,value:e.id}))}catch(l){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.loadPharmaciesError")||"Failed to load pharmacies.",life:3e3}),console.error("Error fetching pharmacies:",l)}},Q=async()=>{if(!(D.value.length>0))try{const l=await k.get("/api/warehouse-request");D.value=l.data.data.map(e=>({label:e.name||e.id,value:e.id}))}catch(l){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.loadWarehousesError")||"Failed to load warehouses.",life:3e3}),console.error("Error fetching warehouses:",l)}},X=async l=>{if(!l.read_at)try{await k.post(`/api/notification/read/${l.id}`),l.read_at=new Date().toISOString(),f.value.unread_count=f.value.data.filter(e=>!e.read_at).length,v.value.unread_count=v.value.data.filter(e=>!e.read_at).length,p.add({severity:"success",summary:a("success")||"Success",detail:a("notification.markedRead")||"Notification marked as read.",life:1500})}catch(e){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.markAsReadError")||"Failed to mark notification as read.",life:3e3}),console.error("Error marking notification as read:",e)}},Y=async()=>{h.value=!0;try{const l=m.value===0?"pharmacy":"warehouse";await k.post(`/api/notification/read-all?type=${l}`);const e=l==="pharmacy"?f:v;e.value.data.forEach(s=>s.read_at=s.read_at||new Date().toISOString()),e.value.unread_count=0,p.add({severity:"success",summary:a("success")||"Success",detail:a("notification.markedAllRead")||"All notifications marked as read.",life:3e3}),x(b.value)}catch(l){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.markAllReadError")||"Failed to mark all notifications as read.",life:3e3}),console.error("Error marking all notifications as read:",l)}},Z=l=>{X(l),l.type==="pharmacy"?F.push({name:"pharmacy_request_show",params:{id:l.metadata.pharmacy_request_id}}):F.push({name:"warehouse_request_show",params:{id:l.metadata.warehouse_request_id}})},ee=async()=>{if(!o.value.type||o.value.ids.length===0||!o.value.title_en||!o.value.body_en){p.add({severity:"warn",summary:a("warning")||"Warning",detail:a("notification.missing_fields")||"Please fill all required fields (Type, Recipients, English Title, English Body).",life:3e3});return}try{await k.post("/api/notification/send",o.value),p.add({severity:"success",summary:a("success")||"Success",detail:a("notification.sent")||"Notification sent successfully.",life:3e3}),E.value=!1,o.value={type:"",ids:[],title_en:"",title_ar:"",body_en:"",body_ar:""},x(b.value)}catch(l){p.add({severity:"error",summary:a("error")||"Error",detail:a("notification.sendError")||"Failed to send notification.",life:3e3}),console.error("Error sending notification:",l)}},ae=l=>{m.value=l.index,x(1)},te=l=>{const e=l.page+1;b.value=e,x(e)};return q(m,B),q(()=>o.value.type,l=>{o.value.ids=[],l==="pharmacy"?G():l==="warehouse"&&Q()}),re(()=>{x()}),(l,e)=>(n(),u(C,null,[i("div",ve,[i("div",_e,[i("div",ye,[r(t(V),{label:t(a)("notification.send_notification")||"Send Notification",icon:"pi pi-send",severity:"primary",onClick:e[0]||(e[0]=s=>E.value=!0)},null,8,["label"])]),r(t(ne),{"active-index":m.value,onTabChange:ae,class:"bg-gradient-to-r from-[#43A167] to-[#8fd3a9]",role:"tablist"},{default:w(()=>[r(t(M),null,{header:w(()=>[i("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":m.value===0,"aria-controls":"pharmacy-notifications"},[e[10]||(e[10]=i("i",{class:"pi pi-building text-xl"},null,-1)),i("span",null,d(t(a)("notifications.pharmacy_notes")||"Pharmacy Notes"),1),f.value.unread_count>0?(n(),U(t(I),{key:0,value:f.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):$("",!0)],8,he)]),_:1}),r(t(M),null,{header:w(()=>[i("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":m.value===1,"aria-controls":"warehouse-notifications"},[e[11]||(e[11]=i("i",{class:"pi pi-box text-xl"},null,-1)),i("span",null,d(t(a)("notifications.warehouse_shipments")||"Warehouse Shipments"),1),v.value.unread_count>0?(n(),U(t(I),{key:0,value:v.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):$("",!0)],8,ge)]),_:1})]),_:1},8,["active-index"]),i("div",{class:"p-6 bg-gray-50 min-h-[400px]",id:m.value===0?"pharmacy-notifications":"warehouse-notifications",role:"tabpanel"},[!h.value&&!g.value&&N.value.length>0?(n(),u("div",xe,[r(t(V),{label:t(a)("notification.mark_all_read")||"Mark All As Read",icon:"pi pi-check-double",severity:"success",outlined:"",onClick:Y,disabled:m.value===0?f.value.unread_count===0:v.value.unread_count===0,class:"text-sm"},null,8,["label","disabled"])])):$("",!0),g.value?(n(),u("div",we,[e[12]||(e[12]=i("i",{class:"pi pi-exclamation-triangle text-5xl mb-4 opacity-50"},null,-1)),i("p",ke,d(g.value),1),r(t(V),{label:t(a)("retry")||"Retry",icon:"pi pi-refresh",class:"mt-4",onClick:e[1]||(e[1]=s=>x(b.value))},null,8,["label"])])):h.value?(n(),u("div",Ee,[(n(),u(C,null,L(5,s=>r(t(de),{key:s,class:"shadow-md rounded-lg"},{content:w(()=>[i("div",$e,[r(t(T),{width:"60%",height:"1.5rem",class:"rounded"}),r(t(T),{width:"15%",height:"1rem",class:"rounded"})]),r(t(T),{width:"90%",height:"1rem",class:"mt-2 mx-4 rounded"})]),_:1})),64))])):N.value.length>0?(n(),u("div",Ve,[(n(!0),u(C,null,L(N.value,(s,_)=>(n(),u("div",{key:s.id,class:j(["notification-item p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer",{"bg-blue-50 border-l-4 border-[#43A167]":!s.read_at}]),onClick:y=>Z(s),role:"button","aria-label":s.title||t(a)("no_title")},[i("div",Ae,[i("div",Ce,[i("div",{class:j(["font-semibold text-lg truncate",{"text-gray-900":!s.read_at,"text-gray-500":s.read_at}])},d(s.title||t(a)("no_title")),3)]),i("div",Pe,[i("p",Se,d(J(s.created_at)),1)])]),i("div",{class:j(["mt-2 text-sm leading-relaxed",{"text-gray-700":!s.read_at,"text-gray-500":s.read_at}])},d(s.body||t(a)("no_body")),3),s.metadata?(n(),u("div",Re,[(n(!0),u(C,null,L(s.metadata,(y,A)=>(n(),u("span",{key:A},[ce(d(A)+": "+d(y),1),e[13]||(e[13]=i("br",null,null,-1))]))),128))])):$("",!0)],10,Ne))),128)),r(t(ue),{rows:S.value,totalRecords:m.value===0?f.value.total:v.value.total,first:(b.value-1)*S.value,onPage:te,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink"},null,8,["rows","totalRecords","first"])])):(n(),u("div",De,[e[14]||(e[14]=i("i",{class:"pi pi-bell-slash text-5xl mb-4 opacity-50"},null,-1)),i("p",Le,d(t(a)("notification.noData")||"No notifications in this section."),1)]))],8,be)])]),r(t(fe),{visible:E.value,"onUpdate:visible":e[9]||(e[9]=s=>E.value=s),header:t(a)("notification.send_notification")||"Send Notification",style:{width:"50vw"},modal:!0,class:"rounded-lg"},{footer:w(()=>[r(t(V),{label:t(a)("notification.cancel")||"Cancel",icon:"pi pi-times",text:"",onClick:e[8]||(e[8]=s=>E.value=!1)},null,8,["label"]),r(t(V),{label:t(a)("notification.send")||"Send",icon:"pi pi-check",onClick:ee,disabled:!o.value.type||o.value.ids.length===0||!o.value.title_en||!o.value.body_en},null,8,["label","disabled"])]),default:w(()=>[i("div",Te,[i("div",je,[i("label",Fe,d(t(a)("notification.type")||"Type"),1),r(t(pe),{id:"type",modelValue:o.value.type,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.type=s),options:z.value,optionLabel:"label",optionValue:"value",placeholder:t(a)("notification.select_type")||"Select Type",class:"w-full"},null,8,["modelValue","options","placeholder"])]),o.value.type?(n(),u("div",Be,[i("label",qe,d(t(a)("notification.recipients")||"Recipients"),1),r(t(me),{id:"ids",modelValue:o.value.ids,"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.ids=s),options:H.value,optionLabel:"label",optionValue:"value",placeholder:t(a)("notification.select_recipients")||"Select Recipients",display:"chip",class:"w-full"},null,8,["modelValue","options","placeholder"])])):$("",!0),i("div",Me,[i("label",Ue,d(t(a)("notification.title_en")||"Title (English)"),1),r(t(O),{id:"title_en",modelValue:o.value.title_en,"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.title_en=s),placeholder:t(a)("notification.enter_title_en")||"Enter title in English",class:"w-full"},null,8,["modelValue","placeholder"])]),i("div",Ie,[i("label",Oe,d(t(a)("notification.title_ar")||"Title (Arabic)"),1),r(t(O),{id:"title_ar",modelValue:o.value.title_ar,"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.title_ar=s),placeholder:t(a)("notification.enter_title_ar")||"Enter title in Arabic",class:"w-full"},null,8,["modelValue","placeholder"])]),i("div",We,[i("label",ze,d(t(a)("notification.body_en")||"Body (English)"),1),r(t(W),{id:"body_en",modelValue:o.value.body_en,"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.body_en=s),placeholder:t(a)("notification.enter_body_en")||"Enter body in English",rows:"3",class:"w-full"},null,8,["modelValue","placeholder"])]),i("div",He,[i("label",Je,d(t(a)("notification.body_ar")||"Body (Arabic)"),1),r(t(W),{id:"body_ar",modelValue:o.value.body_ar,"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.body_ar=s),placeholder:t(a)("notification.enter_body_ar")||"Enter body in Arabic",rows:"3",class:"w-full"},null,8,["modelValue","placeholder"])])])]),_:1},8,["visible","header"])],64))}};export{Qe as default};
