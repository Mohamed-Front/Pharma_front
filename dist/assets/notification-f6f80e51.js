import{_ as W,i as G,u as Q,j as X,r as v,g as M,w as Y,d as Z,o,c as n,k as r,z as d,v as k,m as l,y as w,t as u,F as N,x as A,B as R,J as T,s as F,K as S,L as ee,D as B,M as C,N as te,l as P,q as ae,O as se}from"./index-d45c326e.js";const re={class:"min-h-screen bg-gray-100 flex justify-center items-start p-4"},le={class:"w-full max-w-7xl bg-white rounded-2xl shadow-xl overflow-hidden"},oe=["aria-selected"],ne=["aria-selected"],ie=["id"],de={key:0,class:"flex justify-end mb-4"},ce={key:1,class:"flex flex-col items-center justify-center h-64 text-gray-500"},ue={class:"text-lg"},_e={key:2,class:"space-y-4"},ve={class:"flex justify-between items-start p-4"},me={key:3,class:"space-y-4"},fe=["onClick","aria-label"],ge={class:"flex justify-between items-center"},pe={class:"flex-1 min-w-0"},he={class:"items-center mx-4"},ye={class:"text-gray-400 text-sm flex-shrink-0"},xe={key:0,class:"mt-2 text-xs text-gray-500"},be={key:4,class:"flex flex-col items-center justify-center h-64 text-gray-500"},ke={class:"text-lg"},we={__name:"notification",setup($e){const j=G(),{t:a}=Q(),y=X(),g=v(!0),p=v(null),L=()=>({data:[],total:0,unread_count:0,current_page:1,last_page:1}),m=v(L()),f=v(L()),c=v(0),$=v([]),h=v(1),D=v(10),b=M(()=>c.value===0?m.value:f.value),E=M(()=>b.value.total),V=t=>{if(!t)return"";const e=new Date,s=new Date(t),i=Math.floor((e-s)/(1e3*60)),_=Math.floor(i/60);return _>0?`${a("since")||"since"} ${_} ${a("hours_ago")||"hours ago"}`:i>0?`${a("since")||"since"} ${i} ${a("minutes_ago")||"minutes ago"}`:a("just_now")||"just now"},O=t=>{const e=s=>{const i=t[s]||{},_=i.data||[];return{data:_,total:i.total||0,unread_count:_.filter(U=>!U.read_at).length,current_page:i.current_page||1,last_page:i.last_page||1}};m.value=e("admin_notifications"),f.value=e("warehouse_notifications")},I=()=>{$.value=b.value.data,h.value=b.value.current_page},x=async(t=1)=>{g.value=!0,p.value=null;try{const e=await R.get(`/api/notification/get?page=${t}&per_page=${D.value}`);O(e.data.data),I()}catch(e){p.value=e.message||a("notification.loadError")||"Failed to load notifications.",y.add({severity:"error",summary:a("error"),detail:p.value,life:3e3}),console.error("Error fetching data:",e)}finally{g.value=!1}},z=async t=>{if(!t.read_at)try{await R.post(`/api/notification/read/${t.id}`),t.read_at=new Date().toISOString(),m.value.unread_count=m.value.data.filter(e=>!e.read_at).length,f.value.unread_count=f.value.data.filter(e=>!e.read_at).length,y.add({severity:"success",summary:a("success"),detail:a("notification.markedRead")||"Notification marked as read.",life:1500})}catch(e){y.add({severity:"error",summary:a("error"),detail:a("notification.markAsReadError")||"Failed to mark notification as read.",life:3e3}),console.error("Error marking notification as read:",e)}},q=async()=>{g.value=!0;try{const t=c.value===0?"admin":"warehouse";await R.post(`/api/notification/read-all?type=${t}`);const e=c.value===0?m:f;e.value.data.forEach(s=>{s.read_at||(s.read_at=new Date().toISOString())}),e.value.unread_count=0,y.add({severity:"success",summary:a("success"),detail:a("notification.markedAllRead")||"All notifications marked as read.",life:3e3}),x(h.value)}catch(t){y.add({severity:"error",summary:a("error"),detail:a("notification.markAllReadError")||"Failed to mark all notifications as read.",life:3e3}),console.error("Error marking all as read:",t)}finally{g.value=!1}},H=t=>{z(t);const e=t.metadata||{};t.type==="warehouse"?t.redirect_type==="order_status_changed"&&e.order_id?j.push({name:"pharmacy-orders"}):t.redirect_type==="offer_created"&&e.offer_id?j.push({name:"pharmacy-offers"}):console.log(`Unhandled warehouse redirect: ${t.redirect_type}`):t.type==="admin"&&console.log(`Admin notification clicked: ${t.title}`)},J=t=>{c.value=t.index,h.value=1,x(1)},K=t=>{const e=t.page+1;h.value=e,x(e)};return Y(c,()=>{I()}),Z(()=>{x()}),(t,e)=>(o(),n("div",re,[r("div",le,[d(l(ee),{"active-index":c.value,onTabChange:J,class:"bg-gradient-to-r from-[#43A167] to-[#8fd3a9]",role:"tablist"},{default:k(()=>[d(l(T),null,{header:k(()=>[r("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":c.value===0,"aria-controls":"admin-notifications"},[e[1]||(e[1]=r("i",{class:"pi pi-user text-xl"},null,-1)),r("span",null,u(l(a)("notifications.admin_messages")||"Admin Messages"),1),m.value.unread_count>0?(o(),F(l(S),{key:0,value:m.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):w("",!0)],8,oe)]),_:1}),d(l(T),null,{header:k(()=>[r("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":c.value===1,"aria-controls":"warehouse-notifications"},[e[2]||(e[2]=r("i",{class:"pi pi-home text-xl"},null,-1)),r("span",null,u(l(a)("notifications.warehouse_notes")||"Warehouse Notes"),1),f.value.unread_count>0?(o(),F(l(S),{key:0,value:f.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):w("",!0)],8,ne)]),_:1})]),_:1},8,["active-index"]),r("div",{class:"p-6 bg-gray-50 min-h-[400px]",id:c.value===0?"admin-notifications":"warehouse-notifications",role:"tabpanel"},[E.value>0&&!g.value&&!p.value?(o(),n("div",de,[d(l(B),{label:l(a)("mark_all_read")||"Mark All As Read",icon:"pi pi-check-double",severity:"success",outlined:"",onClick:q,disabled:b.value.unread_count===0,class:"text-sm"},null,8,["label","disabled"])])):w("",!0),p.value?(o(),n("div",ce,[e[3]||(e[3]=r("i",{class:"pi pi-exclamation-triangle text-5xl mb-4 opacity-50"},null,-1)),r("p",ue,u(p.value),1),d(l(B),{label:l(a)("retry")||"Retry",icon:"pi pi-refresh",class:"mt-4",onClick:e[0]||(e[0]=s=>x(h.value))},null,8,["label"])])):g.value?(o(),n("div",_e,[(o(),n(N,null,A(5,s=>d(l(te),{key:s,class:"shadow-md rounded-lg"},{content:k(()=>[r("div",ve,[d(l(C),{width:"60%",height:"1.5rem",class:"rounded"}),d(l(C),{width:"15%",height:"1rem",class:"rounded"})]),d(l(C),{width:"90%",height:"1rem",class:"mt-2 mx-4 rounded"})]),_:1})),64))])):$.value.length>0?(o(),n("div",me,[(o(!0),n(N,null,A($.value,s=>(o(),n("div",{key:s.id,class:P(["notification-item p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer",{"bg-blue-50 border-l-4 border-[#43A167]":!s.read_at}]),onClick:i=>H(s),role:"button","aria-label":s.title||l(a)("no_title")},[r("div",ge,[r("div",pe,[r("div",{class:P(["font-semibold text-lg truncate",{"text-gray-900":!s.read_at,"text-gray-500":s.read_at}])},u(s.title||l(a)("no_title")),3)]),r("div",he,[r("p",ye,u(V(s.created_at)),1)])]),r("div",{class:P(["mt-2 text-sm leading-relaxed",{"text-gray-700":!s.read_at,"text-gray-500":s.read_at}])},u(s.body||l(a)("no_body")),3),s.metadata?(o(),n("div",xe,[(o(!0),n(N,null,A(s.metadata,(i,_)=>(o(),n("span",{key:_},[ae(u(_)+": "+u(i),1),e[4]||(e[4]=r("br",null,null,-1))]))),128))])):w("",!0)],10,fe))),128)),d(l(se),{rows:D.value,totalRecords:E.value,first:(h.value-1)*D.value,onPage:K,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink"},null,8,["rows","totalRecords","first"])])):(o(),n("div",be,[e[5]||(e[5]=r("i",{class:"pi pi-bell-slash text-5xl mb-4 opacity-50"},null,-1)),r("p",ke,u(l(a)("notification.noData")||"No notifications in this section."),1)]))],8,ie)])]))}},Ne=W(we,[["__scopeId","data-v-280bf9f1"]]);export{Ne as default};
