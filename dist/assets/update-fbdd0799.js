import{_ as O,z as N,P as T,a as C,u as G,r as g,m as L,o as M,a8 as S,e as v,h as y,Z as z,g as a,t as f,B as c,i as r,A as _,j as n,C as b,D as I,F as P,b as x,ab as k,Q as V,H as U,S as R,E as A,k as H}from"./index-2cd76906.js";const Q={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},Z={class:"text-3xl font-bold text-center mb-8 text-gray-800"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},K={class:"space-y-2"},W={for:"product",class:"block text-sm font-medium text-gray-700"},X={class:"space-y-2"},Y={for:"discount_type",class:"block text-sm font-medium text-gray-700"},ee={key:0,class:"space-y-2"},te={for:"discount_value",class:"block text-sm font-medium text-gray-700"},le={key:0,class:"text-gray-500"},ae={key:1,class:"space-y-2"},se={for:"gift_product_id",class:"block text-sm font-medium text-gray-700"},ie={key:2,class:"space-y-2"},oe={for:"gift_quantity",class:"block text-sm font-medium text-gray-700"},ue={class:"space-y-2"},de={for:"min_limit",class:"block text-sm font-medium text-gray-700"},re={class:"space-y-2"},ne={for:"max_limit",class:"block text-sm font-medium text-gray-700"},fe={class:"space-y-2"},ce={for:"start_date",class:"block text-sm font-medium text-gray-700"},_e={class:"space-y-2"},pe={for:"end_date",class:"block text-sm font-medium text-gray-700"},me={class:"space-y-2 md:col-span-2"},ve={for:"description",class:"block text-sm font-medium text-gray-700"},ye={class:"pt-6 flex justify-center"},ge={__name:"update",setup(be){const q=N(),$=T(),p=C(),{t:u}=G(),h=g(!1),w=g([]),m=g(!1),e=g({product_id:null,min_limit:null,max_limit:null,discount_type:null,discount_value:null,gift_product_id:null,gift_quantity:null,start_date:null,end_date:null,description:""}),s=g({product_id:!1,discount_type:!1,discount_value:!1,gift_product_id:!1,gift_quantity:!1,min_limit:!1,max_limit:!1,start_date:!1,end_date:!1}),E=async()=>{try{const l=await x.get("/api/product");w.value=l.data.data}catch(l){console.error("Error fetching products:",l),p.add({severity:"error",summary:u("error"),detail:u("error_fetching_data"),life:3e3})}},j=async l=>{var t,o;try{const d=(await x.get(`/api/offer/${l}`)).data.data;e.value={product_id:d.product_id,discount_type:d.discount_type,discount_value:d.discount_value??null,gift_product_id:d.gift_product_id??null,gift_quantity:d.gift_quantity??null,min_limit:d.min_limit,max_limit:d.max_limit,start_date:((t=d.start_date)==null?void 0:t.split("T")[0])||null,end_date:((o=d.end_date)==null?void 0:o.split("T")[0])||null,description:d.description||""}}catch(i){console.error("Error fetching offer:",i),p.add({severity:"error",summary:u("error"),detail:u("error_fetching_offer"),life:3e3}),q.push({name:"offers"})}};L(()=>e.value.discount_type,l=>{l===3?e.value.discount_value=null:(e.value.gift_product_id=null,e.value.gift_quantity=null)});const F=()=>{if(Object.keys(s.value).forEach(l=>s.value[l]=!1),s.value.product_id=!e.value.product_id,s.value.discount_type=!e.value.discount_type,s.value.min_limit=e.value.min_limit===null||e.value.min_limit==="",s.value.max_limit=e.value.max_limit===null||e.value.max_limit==="",s.value.start_date=!e.value.start_date,s.value.end_date=!e.value.end_date,e.value.discount_type===3?(s.value.gift_product_id=!e.value.gift_product_id,s.value.gift_quantity=e.value.gift_quantity===null||e.value.gift_quantity<=0):s.value.discount_value=e.value.discount_value===null||e.value.discount_value==="",e.value.min_limit!=null&&e.value.max_limit!=null&&e.value.min_limit>e.value.max_limit&&(s.value.max_limit=!0),e.value.discount_type===1&&e.value.discount_value!=null&&(e.value.discount_value<0||e.value.discount_value>100)&&(s.value.discount_value=!0),e.value.discount_type===2&&e.value.discount_value!=null&&e.value.discount_value<0&&(s.value.discount_value=!0),e.value.start_date&&e.value.end_date){const l=new Date(e.value.start_date);new Date(e.value.end_date)<l&&(s.value.end_date=!0,p.add({severity:"error",summary:u("error"),detail:u("end_date_before_start"),life:3e3}))}return!Object.values(s.value).some(Boolean)},B=async()=>{var l,t;if(!F()){p.add({severity:"error",summary:u("error"),detail:u("please_fill_required_fields"),life:3e3});return}h.value=!0;try{const o={...e.value};o.discount_type!==3&&(delete o.gift_product_id,delete o.gift_quantity),o.discount_type===3&&delete o.discount_value,m.value?(await x.put(`/api/offer/${$.params.id}`,o),p.add({severity:"success",summary:u("success"),detail:u("offer_updated"),life:3e3})):(await x.post("/api/offer",o),p.add({severity:"success",summary:u("success"),detail:u("offer_created"),life:3e3})),q.push({name:"offers"})}catch(o){console.error("Error:",o);let i=m.value?u("error_updating_offer"):u("error_creating_offer");if(((l=o.response)==null?void 0:l.status)===422){const d=o.response.data.errors;i=Object.values(d).flat().join(", "),Object.keys(d).forEach(D=>{D in s.value&&(s.value[D]=!0)})}else((t=o.response)==null?void 0:t.status)===500&&(i=u("server_error"));p.add({severity:"error",summary:u("error"),detail:i,life:3e3})}finally{h.value=!1}};return M(()=>{E(),$.params.id&&(m.value=!0,j($.params.id))}),(l,t)=>{const o=S("can");return v(),y(P,null,[z((v(),y("div",Q,[a("h1",Z,f(l.$t(m.value?"offer.edit_offer":"offer.create_new_offer")),1),a("form",{onSubmit:I(B,["prevent"]),class:"space-y-6"},[a("div",J,[a("div",K,[a("label",W,[c(f(l.$t("offer.product"))+" ",1),t[10]||(t[10]=a("span",{class:"text-red-500"},"*",-1))]),r(n(k),{filter:"",id:"product",modelValue:e.value.product_id,"onUpdate:modelValue":t[0]||(t[0]=i=>e.value.product_id=i),options:w.value,optionLabel:"commercial_name",optionValue:"id",placeholder:l.$t("offer.select_product"),class:_(["w-full",{"p-invalid":s.value.product_id}])},null,8,["modelValue","options","placeholder","class"])]),a("div",X,[a("label",Y,[c(f(l.$t("offer.discount_type"))+" ",1),t[11]||(t[11]=a("span",{class:"text-red-500"},"*",-1))]),r(n(k),{id:"discount_type",modelValue:e.value.discount_type,"onUpdate:modelValue":t[1]||(t[1]=i=>e.value.discount_type=i),options:[{label:l.$t("offer.percentage"),value:1},{label:l.$t("offer.fixed_amount"),value:2},{label:l.$t("offer.gift"),value:3}],optionLabel:"label",optionValue:"value",placeholder:l.$t("offer.select_discount_type"),class:_(["w-full",{"p-invalid":s.value.discount_type}])},null,8,["modelValue","options","placeholder","class"])]),e.value.discount_type===1||e.value.discount_type===2?(v(),y("div",ee,[a("label",te,[c(f(e.value.discount_type===1?l.$t("offer.percentage"):l.$t("offer.fixed_amount"))+" ",1),t[12]||(t[12]=a("span",{class:"text-red-500"},"*",-1))]),r(n(V),{id:"discount_value",modelValue:e.value.discount_value,"onUpdate:modelValue":t[2]||(t[2]=i=>e.value.discount_value=i),mode:(e.value.discount_type===1,"decimal"),minFractionDigits:e.value.discount_type===1?0:2,maxFractionDigits:2,min:0,max:e.value.discount_type===1?100:null,placeholder:l.$t("offer.enter_discount_value"),class:_(["w-full",{"p-invalid":s.value.discount_value}])},null,8,["modelValue","mode","minFractionDigits","max","placeholder","class"]),e.value.discount_type===1?(v(),y("small",le,"Max 100%")):b("",!0)])):b("",!0),e.value.discount_type===3?(v(),y("div",ae,[a("label",se,[c(f(l.$t("offer.gift_product"))+" ",1),t[13]||(t[13]=a("span",{class:"text-red-500"},"*",-1))]),r(n(k),{filter:"",id:"gift_product_id",modelValue:e.value.gift_product_id,"onUpdate:modelValue":t[3]||(t[3]=i=>e.value.gift_product_id=i),options:w.value,optionLabel:"commercial_name",optionValue:"id",placeholder:l.$t("offer.select_gift_product"),class:_(["w-full",{"p-invalid":s.value.gift_product_id}])},null,8,["modelValue","options","placeholder","class"])])):b("",!0),e.value.discount_type===3?(v(),y("div",ie,[a("label",oe,[c(f(l.$t("offer.gift_quantity"))+" ",1),t[14]||(t[14]=a("span",{class:"text-red-500"},"*",-1))]),r(n(V),{id:"gift_quantity",modelValue:e.value.gift_quantity,"onUpdate:modelValue":t[4]||(t[4]=i=>e.value.gift_quantity=i),useGrouping:!1,min:1,placeholder:l.$t("offer.enter_gift_quantity"),class:_(["w-full",{"p-invalid":s.value.gift_quantity}])},null,8,["modelValue","placeholder","class"])])):b("",!0),a("div",ue,[a("label",de,[c(f(l.$t("offer.min_limit_tooltip"))+" ",1),t[15]||(t[15]=a("span",{class:"text-red-500"},"*",-1))]),r(n(V),{id:"min_limit",modelValue:e.value.min_limit,"onUpdate:modelValue":t[5]||(t[5]=i=>e.value.min_limit=i),useGrouping:!1,min:0,placeholder:l.$t("offer.enter_min_limit"),class:_(["w-full",{"p-invalid":s.value.min_limit}])},null,8,["modelValue","placeholder","class"])]),a("div",re,[a("label",ne,[c(f(l.$t("offer.max_limit_tooltip"))+" ",1),t[16]||(t[16]=a("span",{class:"text-red-500"},"*",-1))]),r(n(V),{id:"max_limit",modelValue:e.value.max_limit,"onUpdate:modelValue":t[6]||(t[6]=i=>e.value.max_limit=i),useGrouping:!1,min:0,placeholder:l.$t("offer.enter_max_limit"),class:_(["w-full",{"p-invalid":s.value.max_limit}])},null,8,["modelValue","placeholder","class"])]),a("div",fe,[a("label",ce,[c(f(l.$t("offer.start_date"))+" ",1),t[17]||(t[17]=a("span",{class:"text-red-500"},"*",-1))]),r(n(U),{id:"start_date",modelValue:e.value.start_date,"onUpdate:modelValue":t[7]||(t[7]=i=>e.value.start_date=i),type:"date",class:_(["w-full",{"p-invalid":s.value.start_date}])},null,8,["modelValue","class"])]),a("div",_e,[a("label",pe,[c(f(l.$t("offer.end_date"))+" ",1),t[18]||(t[18]=a("span",{class:"text-red-500"},"*",-1))]),r(n(U),{id:"end_date",modelValue:e.value.end_date,"onUpdate:modelValue":t[8]||(t[8]=i=>e.value.end_date=i),type:"date",class:_(["w-full",{"p-invalid":s.value.end_date}])},null,8,["modelValue","class"])]),a("div",me,[a("label",ve,f(l.$t("offer.description")),1),r(n(R),{id:"description",modelValue:e.value.description,"onUpdate:modelValue":t[9]||(t[9]=i=>e.value.description=i),placeholder:l.$t("offer.enter_description"),class:"w-full",rows:"4"},null,8,["modelValue","placeholder"])])]),a("div",ye,[r(n(A),{type:"submit",label:l.$t(m.value?"offer.update_offer":"offer.create_offer"),icon:m.value?"pi pi-save":"pi pi-plus",loading:h.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300"},null,8,["label","icon","loading"])])],32)])),[[o,"create offers"]]),r(n(H))],64)}}},Ve=O(ge,[["__scopeId","data-v-4c050309"]]);export{Ve as default};
