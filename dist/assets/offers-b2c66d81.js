import{_ as I,u as W,j as z,r as m,g as D,w as M,d as q,o,c as i,k as s,t as c,m as n,z as _,F as j,x as P,v as S,y as b,s as N,l as T,B as V,H,E as Q,D as w,A as R}from"./index-a2c89516.js";const G={class:"bg-gray-50 min-h-screen"},J={class:"py-10 px-4 max-w-7xl mx-auto"},K={class:"text-2xl md:text-3xl font-bold text-gray-900 mb-8 text-center"},X={class:"flex justify-center mb-8"},Y={class:"relative w-full max-w-lg"},Z={key:0,class:"flex justify-center mb-10"},ee={key:1,class:"text-center text-gray-500 py-10"},ae={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10"},se={class:"flex justify-between"},te={class:"flex justify-between items-start mb-2"},re={class:"bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-full"},le={class:"text-lg md:text-xl font-bold text-gray-900"},oe={class:"text-sm text-gray-600"},ne=["src","alt"],ie={class:"flex items-center gap-2 my-3"},de={class:"text-sm text-gray-700"},ce={class:"text-sm text-gray-700"},ue={class:"flex flex-wrap gap-2 mb-4"},ge={class:"flex items-center justify-between w-full mt-auto mb-4"},pe={class:"flex flex-wrap gap-2"},fe={key:0,class:"bg-gray-100 text-gray-600 text-xs font-semibold px-2 py-1 rounded-full"},me={class:"text-lg md:text-xl font-bold text-green-600"},ve={key:3,class:"flex justify-center items-center gap-2"},_e={key:0,class:"px-4 py-2 text-gray-500"},ye={__name:"offers",setup(xe){const{t:r}=W(),k=z(),v=m([]),u=m(1),d=m(1),y=m(!1),g=m(""),x=m({}),C=m(localStorage.getItem("appLang")||"ar"),U=[{id:0,product_id:0,name_en:"Fallback Product",name_ar:"منتج احتياطي",pharmaceutical_form:"Unknown",scientific_structure:[],discount:[],price:0,media:[{url:"/images/fallback-product.jpg"}],warehouse:{name:"Unknown Warehouse",address:"Unknown Address"}}],L=async(l=1)=>{var a,e;y.value=!0;try{const p=g.value?`search=${encodeURIComponent(g.value)}&`:"",f=await V.get(`/api/pharmacy-home/get/offers?${p}page=${l}`);if(f.data.success&&((a=f.data.data)==null?void 0:a.length)>0){if(v.value=f.data.data.filter(t=>t.warehouse).map(t=>{var F,O;return{id:t.id,product_id:t.id,name_en:t.commercial_name||"Unknown Product",name_ar:t.commercial_name||"منتج غير معروف",pharmaceutical_form:t.pharmaceutical_form||"Unknown",scientific_structure:t.scientific_structure||[],discount:t.active_offers.length>0?t.active_offers.map(h=>({id:h.id,display:h.discount_type===1?`${h.discount_value}% OFF`:`$${h.discount_value} OFF`,description:h.description||"No description"})):[],price:parseFloat(t.price)||0,media:t.media||[{url:"/images/fallback-product.jpg"}],warehouse:{name:((F=t.warehouse)==null?void 0:F.name)||"Unknown Warehouse",address:((O=t.warehouse)==null?void 0:O.address)||"Unknown Address"}}}),d.value=f.data.pagination.last_page||1,u.value=f.data.pagination.current_page||1,v.value.length===0)throw new Error("No valid products found")}else v.value=U,d.value=1,u.value=1,k.add({severity:"warn",summary:r("warning"),detail:r("error.noOffers"),life:3e3})}catch(p){v.value=U,d.value=1,u.value=1,k.add({severity:"error",summary:r("error"),detail:r("error.fetchOffers"),life:3e3}),console.error("Error fetching offers:",((e=p.response)==null?void 0:e.data)||p.message)}finally{y.value=!1}},B=async l=>{var a;x.value[l]=!0;try{const e=await V.post("/api/cart/add/item",{product_id:l,quantity:1});if(e.data.success)k.add({severity:"success",summary:r("success"),detail:r("cart.addSuccess"),life:3e3});else throw new Error(e.data.message||r("error.addToCart"))}catch(e){k.add({severity:"error",summary:r("error"),detail:e.message||r("error.addToCart"),life:3e3}),console.error("Error adding to cart:",((a=e.response)==null?void 0:a.data)||e.message)}finally{x.value[l]=!1}},E=D(()=>g.value?v.value.filter(l=>(C.value==="en"?l.name_en.toLowerCase():l.name_ar.toLowerCase()).includes(g.value.toLowerCase())||l.scientific_structure.some(a=>a.toLowerCase().includes(g.value.toLowerCase()))):v.value),$=l=>{l>=1&&l<=d.value&&(u.value=l,L(l))},A=l=>{l.target.src="/images/fallback-product.jpg"};return M(g,()=>{u.value=1,L(1)}),q(()=>{L()}),(l,a)=>(o(),i("div",G,[s("div",J,[s("h1",K,c(n(r)("offers.title")),1),s("div",X,[s("div",Y,[_(n(H),{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),placeholder:n(r)("search.placeholder"),class:"w-full p-3 pr-12 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent","aria-label":"Search offers"},null,8,["modelValue","placeholder"]),a[4]||(a[4]=s("i",{class:"pi pi-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500","aria-label":"Search icon"},null,-1))])]),y.value?(o(),i("div",Z,[_(n(Q),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):!y.value&&E.value.length===0?(o(),i("div",ee,c(n(r)("error.noOffers")),1)):(o(),i("div",ae,[(o(!0),i(j,null,P(E.value,e=>{var p,f;return o(),i("div",{key:e.id,class:"bg-white rounded-xl shadow-md p-4 relative overflow-hidden flex flex-col"},[s("div",se,[s("div",null,[s("div",te,[s("span",re,c(n(r)("offers.only")),1)]),s("div",null,[s("h3",le,c(C.value==="en"?e.name_en:e.name_ar),1),s("p",oe,c(e.pharmaceutical_form),1)])]),s("div",null,[(f=(p=e.media)==null?void 0:p[0])!=null&&f.url?(o(),i("img",{key:0,src:e.media[0].url,alt:C.value==="en"?e.name_en:e.name_ar,class:"w-16 h-16 object-cover rounded-lg",onError:A},null,40,ne)):b("",!0)])]),s("div",ie,[a[5]||(a[5]=s("i",{class:"pi pi-map-marker text-green-600 text-lg"},null,-1)),s("span",de,c(e.warehouse.name),1),a[6]||(a[6]=s("i",{class:"pi pi-building text-green-600 text-lg"},null,-1)),s("span",ce,c(e.warehouse.address),1)]),s("div",ue,[(o(!0),i(j,null,P(e.scientific_structure,t=>(o(),i("span",{key:t,class:"bg-gray-200 text-gray-800 text-xs font-medium px-3 py-1 rounded-full"},c(t),1))),128))]),s("div",ge,[s("div",pe,[(o(!0),i(j,null,P(e.discount,t=>(o(),i("span",{key:t.id,class:"bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full"},c(t.display)+" ("+c(t.description.slice(0,25))+") ",1))),128)),e.discount.length?b("",!0):(o(),i("span",fe,c(n(r)("noOffers")),1))]),s("span",me,c(e.price+"$"),1)]),_(n(w),{label:x.value[e.product_id]?n(r)("cart.adding"):n(r)("cart.addToCart"),icon:x.value[e.product_id]?"pi pi-spin pi-spinner ml-2":"pi pi-cart-plus ml-2",class:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 w-full rounded-lg transition-colors flex items-center justify-center",disabled:x.value[e.product_id],onClick:t=>B(e.product_id),"aria-label":n(r)("cart.addToCart")+" "+(C.value==="en"?e.name_en:e.name_ar)},null,8,["label","icon","disabled","onClick","aria-label"])])}),128))])),!y.value&&d.value>1?(o(),i("div",ve,[_(n(w),{disabled:u.value===1,class:"px-4 py-2 bg-white text-gray-600 rounded-lg shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors disabled:opacity-50","aria-label":"Previous page",onClick:a[1]||(a[1]=e=>$(u.value-1))},{default:S(()=>[...a[7]||(a[7]=[s("i",{class:"pi pi-chevron-right"},null,-1)])]),_:1},8,["disabled"]),(o(!0),i(j,null,P(Math.min(d.value,5),e=>(o(),N(n(w),{key:e,label:e.toString(),class:T([u.value===e?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-100","px-4 py-2 rounded-lg shadow-sm transition-colors"]),onClick:p=>$(e),"aria-label":"Page "+e},null,8,["label","class","onClick","aria-label"]))),128)),d.value>5?(o(),i("span",_e,"...")):b("",!0),d.value>5?(o(),N(n(w),{key:1,label:d.value.toString(),class:T([u.value===d.value?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-100","px-4 py-2 rounded-lg shadow-sm transition-colors"]),onClick:a[2]||(a[2]=e=>$(d.value)),"aria-label":"Page "+d.value},null,8,["label","class","aria-label"])):b("",!0),_(n(w),{disabled:u.value===d.value,class:"px-4 py-2 bg-white text-gray-600 rounded-lg shadow-sm border border-gray-200 hover:bg-gray-100 transition-colors disabled:opacity-50","aria-label":"Next page",onClick:a[3]||(a[3]=e=>$(u.value+1))},{default:S(()=>[...a[8]||(a[8]=[s("i",{class:"pi pi-chevron-left"},null,-1)])]),_:1},8,["disabled"])])):b("",!0),_(n(R))])]))}},be=I(ye,[["__scopeId","data-v-7fa0b9cf"]]);export{be as default};
