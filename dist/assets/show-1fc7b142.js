import{_ as oe,u as ne,z as ae,P as ie,a as re,r as g,c as W,o as de,d as y,e as i,h as d,g as t,B as r,t as s,j as C,i as n,f as R,w as p,C as I,F as X,y as Y,b as S,A as Z}from"./index-2cd76906.js";const ue={class:"p-6 md:p-10 bg-gray-50 min-h-screen",dir:"rtl"},pe={class:"max-w-7xl mx-auto"},ve={class:"bg-white rounded-2xl shadow-xl overflow-hidden"},ce={class:"text-green-800 p-8"},me={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6"},ge={class:"text-3xl font-bold"},ye={class:"text-yellow-300"},be={class:"mt-2 text-lg opacity-90"},xe={class:"flex flex-wrap gap-3"},_e={key:0,class:"flex justify-center items-center h-96"},fe={key:1,class:"p-8 space-y-10"},we={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},ke={class:"bg-gradient-to-br from-blue-50 to-indigo-100 p-6 rounded-xl"},he={class:"space-y-3 text-gray-800"},Ce={class:"bg-gradient-to-br from-green-50 to-emerald-100 p-6 rounded-xl"},Te={class:"space-y-3 text-gray-700"},Ve={class:"text-2xl font-bold text-green-700"},Re={class:"bg-gray-50 rounded-xl p-6"},je={class:"bg-white border border-gray-200 rounded-lg p-6 m-4 shadow-lg"},Be={class:"font-bold text-lg mb-4 text-indigo-700"},De={class:"text-pink-600"},Ie={key:0,class:"space-y-4 mb-6"},Se={class:"flex-1"},Ee={class:"font-medium text-gray-800"},qe={class:"text-gray-500"},Le={key:1,class:"text-center text-gray-500 py-6"},Ne={class:"mt-6"},Ue={class:"mt-8 text-right"},ze={class:"text-2xl font-bold text-green-700"},Fe={key:0,class:"bg-gradient-to-br from-purple-50 to-pink-100 rounded-xl p-6"},Pe={class:"font-bold text-green-600"},$e={class:"bg-gray-50 rounded-xl p-6"},Ae={key:0,class:"space-y-4 mb-8"},Oe={class:"font-medium text-gray-800"},Ke={class:"text-gray-500"},Me={key:1,class:"text-center text-gray-500 py-10"},Ge={class:"mt-8"},He={class:"text-center py-10"},Je={key:2,class:"text-center py-20"},Qe={key:0,class:"p-4 grid grid-cols-1 lg:grid-cols-3 gap-6",dir:"rtl"},We={class:"space-y-3 p-4 bg-blue-50 rounded-lg"},Xe={class:"space-y-3 p-4 bg-yellow-50 rounded-lg"},Ye={class:"text-lg font-semibold text-green-700"},Ze={class:"space-y-3 p-4 bg-green-50 rounded-lg"},et={class:"text-red-600"},tt={class:"text-2xl font-bold text-green-700 pt-2 border-t mt-4"},st={key:1,class:"text-center py-5"},lt={__name:"show",setup(ot){const{t:v}=ne(),ee=ae(),j=ie(),_=re(),B=g(!0),D=g(!1),T=g(!1),l=g(null),f=g(""),b=g({}),E=g([]),V=g(!1),c=W(()=>{var a;return((a=l.value)==null?void 0:a.invoice)||null}),q=W(()=>f.value.trim()?!0:Object.values(b.value).some(a=>a==null?void 0:a.trim())),L=a=>{const e=a==null?void 0:a.toLowerCase();return e&&(e.includes("pending")||e.includes("مرتجع")||e.includes("معلق"))?"warning":e&&(e.includes("completed")||e.includes("paid")||e.includes("مدفوع"))?"success":e&&e.includes("ملغى")?"danger":(e&&e.includes("زيادة"),"info")},N=async()=>{B.value=!0;try{const a=await S.get(`/api/order/${j.params.id}`);l.value=a.data.data,l.value.items.forEach(e=>{e.id in b.value||(b.value[e.id]="")})}catch{_.add({severity:"error",summary:v("error")||"Error",detail:v("order.loadError")||"Failed to load order",life:4e3})}finally{B.value=!1}},te=async()=>{var a,e;D.value=!0;try{const u=await S.post("/api/invoice",{order_id:j.params.id});l.value&&u.data.data&&(l.value.invoice=u.data.data),_.add({severity:"success",summary:v("success"),detail:v("order.invoiceCreated")||"تم إنشاء الفاتورة بنجاح",life:4e3}),U()}catch(u){_.add({severity:"error",summary:v("error"),detail:((e=(a=u.response)==null?void 0:a.data)==null?void 0:e.message)||v("order.invoiceError")||"فشل إنشاء الفاتورة",life:4e3})}finally{D.value=!1}},U=()=>{V.value=!0},se=async()=>{var e,u;if(!q.value){_.add({severity:"warn",summary:"تحذير",detail:"لا توجد تعليقات لإرسالها",life:3e3});return}T.value=!0;const a={comments:[]};f.value.trim()&&a.comments.push({body:f.value.trim()}),Object.entries(b.value).forEach(([h,w])=>{w!=null&&w.trim()&&a.comments.push({order_item_id:Number(h),body:w.trim()})});try{await S.post(`/api/order/comments/${j.params.id}`,a),_.add({severity:"success",summary:"تم بنجاح",detail:"تم إرسال جميع التعليقات بنجاح",life:5e3}),f.value="",b.value={},await N()}catch(h){_.add({severity:"error",summary:"خطأ",detail:((u=(e=h.response)==null?void 0:e.data)==null?void 0:u.message)||"فشل إرسال التعليقات",life:5e3})}finally{T.value=!1}};return de(N),(a,e)=>{var P,$,A,O,K,M,G,H,J;const u=y("Button"),h=y("Toast"),w=y("ProgressSpinner"),k=y("Tag"),m=y("Column"),z=y("Textarea"),F=y("DataTable"),le=y("Dialog");return i(),d("div",ue,[t("div",pe,[t("div",ve,[t("div",ce,[t("div",me,[t("div",null,[t("h1",ge,[r(s(C(v)("order.detailsTitle"))+" ",1),t("span",ye,"#"+s((P=l.value)==null?void 0:P.number),1)]),t("p",be,s((A=($=l.value)==null?void 0:$.pharmacy)==null?void 0:A.name)+" ← "+s((K=(O=l.value)==null?void 0:O.warehouse)==null?void 0:K.name),1)]),t("div",xe,[n(u,{label:C(v)("order.back"),icon:"pi pi-arrow-right",onClick:e[0]||(e[0]=o=>C(ee).push({name:"order"}))},null,8,["label"]),(M=l.value)!=null&&M.invoice?(i(),R(u,{key:0,label:C(v)("order.viewInvoice")||"عرض الفاتورة",icon:"pi pi-file-pdf",class:"p-button-info",onClick:U},null,8,["label"])):(i(),R(u,{key:1,label:C(v)("order.createInvoice")||"إنشاء فاتورة",icon:"pi pi-plus",class:"p-button-success",loading:D.value,onClick:te},null,8,["label","loading"]))])])]),n(h,{position:"top-left"}),B.value?(i(),d("div",_e,[n(w)])):l.value?(i(),d("div",fe,[t("div",we,[t("div",ke,[e[10]||(e[10]=t("h3",{class:"font-bold text-xl mb-4 text-indigo-800"},"معلومات الطلب",-1)),t("div",he,[t("p",null,[e[5]||(e[5]=t("strong",null,"رقم الطلب:",-1)),r(" "+s(l.value.number),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"الصيدلية:",-1)),r(" "+s((G=l.value.pharmacy)==null?void 0:G.name),1)]),t("p",null,[e[7]||(e[7]=t("strong",null,"المستودع:",-1)),r(" "+s((H=l.value.warehouse)==null?void 0:H.name),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"الحالة:",-1)),n(k,{value:l.value.status_description,severity:L(l.value.status_description),class:"mr-2"},null,8,["value","severity"])]),t("p",null,[e[9]||(e[9]=t("strong",null,"التاريخ:",-1)),r(" "+s(l.value.created_at),1)])])]),t("div",Ce,[e[15]||(e[15]=t("h3",{class:"font-bold text-xl mb-4 text-green-800"},"الأسعار",-1)),t("div",Te,[t("p",null,[e[11]||(e[11]=t("strong",null,"السعر الأصلي:",-1)),r(" "+s(l.value.original_price)+" "+s(l.value.price_unit),1)]),t("p",null,[e[12]||(e[12]=t("strong",null,"التوصيل:",-1)),r(" "+s(l.value.delivery)+" "+s(l.value.price_unit),1)]),t("p",null,[e[13]||(e[13]=t("strong",null,"الخصومات:",-1)),r(" "+s(l.value.total_discounts)+" "+s(l.value.price_unit),1)]),t("p",Ve,[e[14]||(e[14]=t("strong",null,"الإجمالي:",-1)),r(" "+s(l.value.total_price)+" "+s(l.value.price_unit),1)])])])]),t("div",Re,[e[19]||(e[19]=t("h3",{class:"text-2xl font-bold mb-6 text-gray-800"},"المنتجات في الطلب",-1)),n(F,{value:l.value.items.filter(o=>!o.is_gift),expandedRows:E.value,"onUpdate:expandedRows":e[1]||(e[1]=o=>E.value=o),dataKey:"id",responsiveLayout:"scroll",class:"p-datatable-sm",stripedRows:""},{expansion:p(({data:o})=>{var Q;return[t("div",je,[t("h4",Be,[e[16]||(e[16]=r(" تعليقات على: ",-1)),t("span",De,s(o.product.commercial_name),1)]),(Q=o.comments)!=null&&Q.length?(i(),d("div",Ie,[(i(!0),d(X,null,Y(o.comments,x=>(i(),d("div",{key:x.id,class:Z(["flex justify-between items-start bg-gray-50 p-4 rounded-lg border",{"border-blue-300":x.is_you}])},[t("div",Se,[t("p",Ee,s(x.body),1),t("small",qe,s(x.created_at),1)]),x.is_you?(i(),R(k,{key:0,value:"أنت",severity:"info",class:"text-xs"})):I("",!0)],2))),128))])):(i(),d("div",Le,[...e[17]||(e[17]=[t("i",{class:"pi pi-comments text-4xl mb-3 text-gray-300"},null,-1),t("p",null,"لا توجد تعليقات على هذا المنتج بعد",-1)])])),t("div",Ne,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"إضافة تعليق جديد",-1)),n(z,{modelValue:b.value[o.id],"onUpdate:modelValue":x=>b.value[o.id]=x,placeholder:"اكتب تعليقك على هذا المنتج...",rows:"3",class:"w-full",autoResize:""},null,8,["modelValue","onUpdate:modelValue"])])])]}),default:p(()=>[n(m,{expander:!0,headerStyle:"width: 4rem"}),n(m,{field:"product.commercial_name",header:"اسم المنتج"}),n(m,{field:"quantity",header:"الكمية"},{body:p(({data:o})=>[t("span",null,s(o.quantity),1)]),_:1}),n(m,{header:"سعر الوحدة"},{body:p(({data:o})=>[t("span",null,s((o.original_price/o.quantity).toFixed(2))+" "+s(l.value.price_unit),1)]),_:1}),n(m,{header:"السعر قبل الخصم"},{body:p(({data:o})=>[t("span",null,s(o.original_price)+" "+s(l.value.price_unit),1)]),_:1}),n(m,{header:"السعر بعد الخصم"},{body:p(({data:o})=>[t("span",null,s(o.total_price)+" "+s(l.value.price_unit),1)]),_:1})]),_:1},8,["value","expandedRows"]),t("div",Ue,[t("p",ze," الإجمالي: "+s(l.value.total_price)+" "+s(l.value.price_unit),1)])]),l.value.items.some(o=>o.is_gift)?(i(),d("div",Fe,[e[20]||(e[20]=t("h3",{class:"text-2xl font-bold mb-6 text-purple-800"},"الهدايا المجانية",-1)),n(F,{value:l.value.items.filter(o=>o.is_gift),class:"p-datatable-sm",stripedRows:"",responsiveLayout:"scroll"},{default:p(()=>[n(m,{field:"product.commercial_name",header:"اسم المنتج"}),n(m,{header:"الحالة"},{body:p(()=>[n(k,{value:"هدية",severity:"success",icon:"pi pi-gift"})]),_:1}),n(m,{field:"quantity",header:"الكمية"},{body:p(({data:o})=>[t("span",Pe,s(o.quantity),1)]),_:1})]),_:1},8,["value"])])):I("",!0),t("div",$e,[e[23]||(e[23]=t("h3",{class:"text-2xl font-bold mb-6 text-gray-800"},"تعليقات عامة على الطلب",-1)),(J=l.value.comments)!=null&&J.length?(i(),d("div",Ae,[(i(!0),d(X,null,Y(l.value.comments,o=>(i(),d("div",{key:o.id,class:Z(["bg-white p-5 rounded-lg shadow flex justify-between items-start border",{"border-blue-300":o.is_you}])},[t("div",null,[t("p",Oe,s(o.body),1),t("small",Ke,s(o.created_at),1)]),o.is_you?(i(),R(k,{key:0,value:"أنت",severity:"info",class:"text-xs"})):I("",!0)],2))),128))])):(i(),d("div",Me,[...e[21]||(e[21]=[t("i",{class:"pi pi-comments text-5xl mb-4 text-gray-300"},null,-1),t("p",{class:"text-lg"},"لا توجد تعليقات عامة بعد",-1)])])),t("div",Ge,[e[22]||(e[22]=t("h4",{class:"text-xl font-semibold mb-4"},"إضافة تعليق عام على الطلب",-1)),n(z,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),placeholder:"اكتب تعليقك العام هنا...",rows:"4",class:"w-full",autoResize:""},null,8,["modelValue"])])]),t("div",He,[n(u,{label:"إرسال جميع التعليقات",icon:"pi pi-send",iconPos:"left",class:"p-button-lg p-button-success text-xl px-12 py-5",loading:T.value,disabled:!q.value||T.value,onClick:se},null,8,["loading","disabled"])])])):(i(),d("div",Je,[...e[24]||(e[24]=[t("i",{class:"pi pi-exclamation-triangle text-6xl text-gray-400"},null,-1),t("p",{class:"text-2xl mt-6 text-gray-600"},"الطلب غير موجود",-1)])]))])]),n(le,{visible:V.value,"onUpdate:visible":e[4]||(e[4]=o=>V.value=o),header:"تفاصيل الفاتورة",modal:"",style:{width:"80vw"}},{footer:p(()=>[n(u,{label:"إغلاق",onClick:e[3]||(e[3]=o=>V.value=!1),class:"p-button-text"})]),default:p(()=>[c.value&&l.value?(i(),d("div",Qe,[t("div",We,[e[29]||(e[29]=t("h4",{class:"font-bold text-lg text-blue-800 mb-3 border-b pb-2"},"معلومات الفاتورة",-1)),t("p",null,[e[25]||(e[25]=t("strong",null,"رقم الفاتورة:",-1)),e[26]||(e[26]=r()),n(k,{value:c.value.number,severity:"info"},null,8,["value"])]),t("p",null,[e[27]||(e[27]=t("strong",null,"الطلب الأصلي:",-1)),r(" "+s(l.value.number),1)]),t("p",null,[e[28]||(e[28]=t("strong",null,"تاريخ الإصدار:",-1)),r(" "+s(c.value.created_at),1)])]),t("div",Xe,[e[33]||(e[33]=t("h4",{class:"font-bold text-lg text-yellow-800 mb-3 border-b pb-2"},"حالة الدفع",-1)),t("p",null,[e[30]||(e[30]=t("strong",null,"الحالة:",-1)),n(k,{value:c.value.status_description,severity:L(c.value.status_description),class:"mr-2"},null,8,["value","severity"])]),t("p",null,[e[31]||(e[31]=t("strong",null,"المبلغ المدفوع:",-1)),e[32]||(e[32]=r()),t("span",Ye,s(c.value.total_paid)+" "+s(l.value.price_unit),1)])]),t("div",Ze,[e[38]||(e[38]=t("h4",{class:"font-bold text-lg text-green-800 mb-3 border-b pb-2"},"ملخص الأسعار",-1)),t("p",null,[e[34]||(e[34]=t("strong",null,"السعر الأصلي:",-1)),r(" "+s(c.value.original_price)+" "+s(l.value.price_unit),1)]),t("p",null,[e[35]||(e[35]=t("strong",null,"الخصومات:",-1)),e[36]||(e[36]=r()),t("span",et,s(c.value.total_discounts)+" "+s(l.value.price_unit),1)]),t("p",null,[e[37]||(e[37]=t("strong",null,"التوصيل:",-1)),r(" "+s(c.value.delivery)+" "+s(l.value.price_unit),1)]),t("p",tt," الإجمالي النهائي: "+s(c.value.total_price)+" "+s(l.value.price_unit),1)])])):(i(),d("div",st,[...e[39]||(e[39]=[t("i",{class:"pi pi-info-circle text-4xl text-yellow-500 mb-3"},null,-1),t("p",{class:"text-lg text-gray-600"},"لا يمكن عرض بيانات الفاتورة. تأكد من إنشاء الفاتورة.",-1)])]))]),_:1},8,["visible"])])}}},at=oe(lt,[["__scopeId","data-v-f5c6eea8"]]);export{at as default};
