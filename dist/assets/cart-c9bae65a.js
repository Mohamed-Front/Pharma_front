import{_ as Q,u as R,j as U,i as A,r as x,g as E,d as G,o as i,c as n,k as o,t as l,m as c,l as C,F as b,x as w,z as $,B as k,E as H,y as q,A as J}from"./index-abebc0c4.js";const K={class:"bg-gray-100 min-h-screen p-4 sm:p-8 font-[Inter]"},O={class:"max-w-7xl mx-auto flex flex-col lg:flex-row gap-8"},X={class:"flex-shrink-0 w-full lg:w-96 bg-white rounded-3xl shadow-lg p-6 flex flex-col items-stretch"},Y={class:"flex items-center border-b pb-4 mb-4"},Z={class:"text-xl font-bold"},ee={class:"flex justify-between py-2 text-gray-600"},te={class:"font-medium"},se={class:"flex justify-between py-2 text-gray-600"},re={class:"text-red-500"},ae={class:"font-medium"},oe={class:"flex justify-between font-bold text-lg border-t pt-4 mt-4"},le=["disabled"],ie={class:"flex items-center justify-center mt-4 text-xs text-gray-500"},ne={class:"flex-grow w-full bg-white rounded-3xl shadow-lg p-6 flex flex-col"},ce={class:"flex items-center border-b pb-4 mb-4"},de={class:"text-xl font-bold"},ue={class:"flex flex-wrap gap-2 mb-6"},pe=["onClick"],_e={key:0,class:"flex justify-center mb-10"},me={key:1,class:"text-center text-gray-600 py-8"},fe={key:2},ye={key:0,class:"text-lg font-semibold text-gray-700 mb-4"},ve={class:"flex items-center w-full sm:w-auto mb-4 sm:mb-0"},ge={class:"w-16 h-16 bg-green-100 rounded-xl flex items-center justify-center shrink-0"},he=["src","alt"],xe={class:"flex-grow mx-4"},be={class:"font-bold text-lg"},we={class:"text-sm text-gray-500"},ke={class:"flex flex-wrap gap-2 mt-2"},Ee={key:0,class:"text-sm text-red-500 mt-1"},Ce={key:1,class:"mt-2"},qe={class:"flex items-center w-full sm:w-auto justify-between sm:justify-start"},je={class:"flex items-center ml-4"},Ie={class:"font-bold text-lg"},Se=["disabled","onClick"],De={class:"flex items-center bg-gray-200 rounded-full px-2 py-1"},$e=["disabled","onClick"],Te={class:"px-4 font-bold text-lg"},Me=["disabled","onClick"],Be={__name:"cart",setup(Pe){const{t:r}=R(),_=U();A();const m=x([]),d=x([]),p=x("all"),h=x(!1),y=x({}),j=E(()=>p.value==="all"?d.value:d.value.filter(t=>t.warehouse_id===p.value)),T=E(()=>{if(p.value==="all")return d.value.reduce((e,s)=>e+(s.original_price||0),0);const t=d.value.find(e=>e.warehouse_id===p.value);return t&&t.original_price||0}),M=E(()=>{if(p.value==="all")return d.value.reduce((e,s)=>e+(s.total_discounts||0),0);const t=d.value.find(e=>e.warehouse_id===p.value);return t&&t.total_discounts||0}),B=E(()=>{if(p.value==="all")return d.value.reduce((e,s)=>e+(s.total_price||0),0);const t=d.value.find(e=>e.warehouse_id===p.value);return t&&t.total_price||0}),P=t=>({Paracetamol:"pi-tablet",Caffeine:"pi-bolt"})[t]||"pi-tablet",V=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),W=t=>{t.target.style.display="none",t.target.nextElementSibling.style.display="block"},g=async()=>{h.value=!0;try{const t=await k.get("/api/cart/get");t.data.success&&t.data.data?(d.value=t.data.data.warehouses.map((e,s)=>({...e,name:e.warehouse_name||`Warehouse ${e.warehouse_id||s+1}`,items:e.items.map(a=>({...a,description:a.description||r("cart.defaultDescription")}))})),m.value=d.value.flatMap(e=>e.items)):(d.value=[],m.value=[],_.add({severity:"warn",summary:r("warning"),detail:r("cart.empty"),life:3e3}))}catch(t){d.value=[],m.value=[],_.add({severity:"error",summary:r("error"),detail:r("cart.fetchError"),life:3e3}),console.error("Error fetching cart:",t)}finally{h.value=!1}},z=async t=>{y.value[t]=!0;try{const e=m.value.find(a=>a.id===t);if(!e)return;const s=await k.post("/api/cart/remove/item",{item_id:e.id});if(s.data.success)d.value=d.value.map(a=>({...a,items:a.items.filter(u=>u.id!==t),original_price:a.items.filter(u=>u.id!==t).reduce((u,v)=>u+(v.original_price||0),0),total_discounts:a.items.filter(u=>u.id!==t).reduce((u,v)=>u+(v.total_discounts||0),0),total_price:a.items.filter(u=>u.id!==t).reduce((u,v)=>u+(v.total_price||0),0)})).filter(a=>a.items.length>0),m.value=m.value.filter(a=>a.id!==t),_.add({severity:"success",summary:r("success"),detail:r("cart.removeSuccess"),life:3e3}),g();else throw new Error(s.data.message||r("cart.removeError"))}catch(e){_.add({severity:"error",summary:r("error"),detail:e.message||r("cart.removeError"),life:3e3}),console.error("Error removing item:",e)}finally{y.value[t]=!1}},L=async t=>{y.value[t]=!0;const e=m.value.find(s=>s.id===t);if(e)try{const s=await k.post("/api/cart/add/item",{product_id:e.product_id,quantity:e.quantity+1});if(s.data.success)e.quantity++,e.original_price=e.product.price*e.quantity,e.total_price=e.original_price-(e.total_discounts||0),I(e.product.warehouse_id),_.add({severity:"success",summary:r("success"),detail:r("cart.updateSuccess"),life:3e3}),g();else throw new Error(s.data.message||r("cart.updateError"))}catch(s){_.add({severity:"error",summary:r("error"),detail:s.message||r("cart.updateError"),life:3e3}),g(),console.error("Error incrementing quantity:",s)}finally{y.value[t]=!1}},N=async t=>{const e=m.value.find(s=>s.id===t);if(!(!e||e.quantity<=1)){y.value[t]=!0;try{const s=await k.post("/api/cart/add/item",{product_id:e.product_id,quantity:e.quantity-1});if(s.data.success)e.quantity--,e.original_price=e.product.price*e.quantity,e.total_price=e.original_price-(e.total_discounts||0),I(e.product.warehouse_id),_.add({severity:"success",summary:r("success"),detail:r("cart.updateSuccess"),life:3e3}),g();else throw new Error(s.data.message||r("cart.updateError"))}catch(s){_.add({severity:"error",summary:r("error"),detail:s.message||r("cart.updateError"),life:3e3}),console.error("Error decrementing quantity:",s)}finally{y.value[t]=!1}}},I=t=>{const e=d.value.find(s=>s.warehouse_id===t);e&&(e.original_price=e.items.reduce((s,a)=>s+(a.original_price||0),0),e.total_discounts=e.items.reduce((s,a)=>s+(a.total_discounts||0),0),e.total_price=e.items.reduce((s,a)=>s+(a.total_price||0),0))},F=async()=>{if(m.value.length===0){_.add({severity:"warn",summary:r("warning"),detail:r("cart.empty"),life:3e3});return}try{const t=[...new Set(j.value.flatMap(s=>s.items).map(s=>s.product.warehouse_id))].join(",");_.add({severity:"info",summary:r("info"),detail:r("cart.checkoutProcessing"),life:3e3});const e=await k.post(`/api/order?select=${encodeURIComponent(t)}`);if(e.data.success)_.add({severity:"success",summary:r("success"),detail:r("cart.orderSuccess"),life:3e3}),g(),p.value="all",d.value=[],m.value=[];else throw new Error(e.data.message||r("cart.checkoutError"))}catch(t){_.add({severity:"error",summary:r("error"),detail:t.message||r("cart.checkoutError"),life:3e3}),console.error("Error proceeding to checkout:",t)}},S=t=>{p.value=t};return G(g),(t,e)=>(i(),n("div",K,[o("div",O,[o("div",X,[o("div",Y,[o("h2",Z,l(c(r)("cart.orderDetails")),1),e[1]||(e[1]=o("i",{class:"pi pi-shopping-cart text-green-600 text-2xl mx-2"},null,-1))]),o("div",ee,[o("span",null,l(T.value)+" "+l(c(r)("currency")),1),o("span",te,l(c(r)("cart.subtotal")),1)]),o("div",se,[o("span",re,"-"+l(M.value)+" "+l(c(r)("currency")),1),o("span",ae,l(c(r)("cart.discount")),1)]),o("div",oe,[o("span",null,l(B.value)+" "+l(c(r)("currency")),1),o("span",null,l(c(r)("cart.total")),1)]),o("button",{class:"bg-green-600 text-white rounded-full py-3 mt-8 font-bold text-lg shadow-lg hover:bg-green-700 transition duration-300",disabled:h.value||m.value.length===0,onClick:F},l(c(r)("cart.checkout")),9,le),o("div",ie,[e[2]||(e[2]=o("i",{class:"pi pi-check-circle text-green-600 mr-1"},null,-1)),o("span",null,l(c(r)("cart.securePayment")),1)])]),o("div",ne,[o("div",ce,[o("h2",de,l(c(r)("cart.requestedItems")),1),e[3]||(e[3]=o("i",{class:"pi pi-box text-green-600 text-2xl mx-2"},null,-1))]),o("div",ue,[o("button",{class:C(["px-4 py-2 rounded-lg shadow-sm border",p.value==="all"?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border-gray-200 hover:bg-gray-100"]),onClick:e[0]||(e[0]=s=>S("all"))},l(c(r)("cart.all")),3),(i(!0),n(b,null,w(d.value,s=>(i(),n("button",{key:s.warehouse_id,class:C(["px-4 py-2 rounded-lg shadow-sm border",p.value===s.warehouse_id?"bg-green-600 text-white hover:bg-green-700":"bg-white text-gray-600 border-gray-200 hover:bg-gray-100"]),onClick:a=>S(s.warehouse_id)},l(s.warehouse_name),11,pe))),128))]),h.value?(i(),n("div",_e,[$(c(H),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):!h.value&&m.value.length===0?(i(),n("div",me,[o("p",null,l(c(r)("cart.empty")),1)])):(i(),n("div",fe,[(i(!0),n(b,null,w(j.value,s=>(i(),n("div",{key:s.warehouse_id,class:"mb-6"},[p.value!=="all"?(i(),n("h3",ye,l(s.name),1)):q("",!0),(i(!0),n(b,null,w(s.items,a=>{var u,v,D;return i(),n("div",{key:a.id,class:"flex flex-col sm:flex-row items-center justify-between border-b pb-4 mb-4 last:border-b-0 last:mb-0"},[o("div",ve,[o("div",ge,[(v=(u=a.product.media)==null?void 0:u[0])!=null&&v.url?(i(),n("img",{key:0,src:a.product.media[0].url,alt:a.product.commercial_name,class:"w-full h-full object-cover rounded-xl",loading:"lazy",onError:W},null,40,he)):(i(),n("i",{key:1,class:C(["pi",P(a.product.scientific_structure[0]),"text-green-600 text-2xl"])},null,2))]),o("div",xe,[o("h3",be,l(a.product.commercial_name),1),o("p",we,l(a.description||c(r)("cart.defaultDescription")),1),o("div",ke,[(i(!0),n(b,null,w(a.product.scientific_structure,f=>(i(),n("span",{key:f,class:"bg-gray-200 text-gray-800 text-xs font-medium px-3 py-1 rounded-full"},l(f),1))),128))]),a.total_discounts>0?(i(),n("p",Ee,l(c(r)("cart.discount"))+": -"+l(a.total_discounts)+" "+l(c(r)("currency")),1)):q("",!0),a.product.has_active_offer&&((D=a.product.active_offers)!=null&&D.length)?(i(),n("div",Ce,[(i(!0),n(b,null,w(a.product.active_offers,f=>(i(),n("div",{key:f.description,class:"bg-green-50 text-green-800 text-xs font-medium px-3 py-2 rounded-lg mt-1"},[o("p",null,l(f.description),1),o("p",null,"Discount: "+l(f.discount_value)+" "+l(f.discount_type===2?c(r)("currency"):"%"),1),o("p",null,"Valid until: "+l(V(f.end_date)),1)]))),128))])):q("",!0)])]),o("div",qe,[o("div",je,[o("span",Ie,l(a.total_price)+" "+l(c(r)("currency")),1),o("button",{class:"text-red-500 p-2 rounded-full mx-4 hover:bg-gray-300 transition duration-300",disabled:y.value[a.id],onClick:f=>z(a.id)},[...e[4]||(e[4]=[o("i",{class:"pi pi-trash text-lg"},null,-1)])],8,Se)]),o("div",De,[o("button",{class:"w-8 h-8 rounded-full text-green-600 font-bold hover:bg-gray-300 transition duration-300",disabled:y.value[a.id],onClick:f=>L(a.id)}," + ",8,$e),o("span",Te,l(a.quantity),1),o("button",{class:"w-8 h-8 rounded-full text-green-600 font-bold hover:bg-gray-300 transition duration-300",disabled:y.value[a.id]||a.quantity<=1,onClick:f=>N(a.id)}," - ",8,Me)])])])}),128))]))),128))]))])]),$(c(J))]))}},We=Q(Be,[["__scopeId","data-v-d8a80a79"]]);export{We as default};
