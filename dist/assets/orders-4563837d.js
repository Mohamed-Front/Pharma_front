import{_ as Z,u as I,a as ee,r as y,e as d,h as u,g as e,t as l,j as a,B as b,i as m,w as $,C as B,b as A,s as F,F as z,y as O,f as R,A as U,D as se,T as H,S as q,U as te,V as L,E as ae,W as oe,X as le,O as ie,k as re}from"./index-2cd76906.js";const ne={class:"bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen p-4 sm:p-6 md:p-8 font-sans",dir:"rtl"},de={class:"max-w-7xl mx-auto bg-white rounded-2xl shadow-2xl p-6 sm:p-8"},ce={class:"flex flex-col sm:flex-row items-center justify-between gap-4 mb-8"},ue={class:"text-3xl sm:text-4xl font-extrabold text-gray-900 tracking-tight"},me={key:0,class:"flex justify-center py-16"},ge={key:1,class:"text-center py-16"},pe={class:"mt-4 text-lg text-gray-500 font-medium"},ve={key:2,class:"space-y-4"},_e={class:"w-full grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 items-center gap-4 p-4 bg-gray-50 hover:bg-gray-100 transition-colors duration-200 rounded-lg"},ye={class:"text-sm font-semibold text-gray-900 truncate"},he={class:"text-sm text-gray-600 truncate hidden sm:inline"},fe={class:"text-sm text-gray-600 truncate"},xe={class:"text-sm font-bold text-gray-900 hidden lg:inline text-right"},be=["onClick","disabled"],we={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ke={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ce={key:0,class:"flex justify-center p-6"},Pe={key:1,class:"p-6 text-center text-red-600 font-medium bg-red-50 rounded-lg"},$e={key:2,class:"p-6 bg-gray-50 rounded-lg space-y-8"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ve={class:"space-y-3"},je={class:"text-gray-900"},Ee={class:"text-gray-900"},Me={class:"text-gray-900"},De={class:"text-gray-900"},Se={class:"space-y-3"},Be={class:"text-gray-900"},Ae={class:"font-bold text-indigo-600"},Ue={class:"text-gray-900"},ze={class:"text-gray-900"},Oe={class:"bg-white rounded-xl p-6 shadow-sm border"},Re={key:0,class:"space-y-4 mb-6"},He={class:"flex-1"},Ne={class:"font-medium text-gray-800 mb-1"},Te={class:"flex items-center justify-between text-sm"},We={class:"text-gray-500"},Fe={class:"text-gray-400"},qe={class:"flex-shrink-0 ml-3"},Ge={key:1,class:"text-center text-gray-500 py-8 bg-gray-100 rounded-lg"},Xe={class:"mt-6 pt-6 border-t border-gray-200"},Je={class:"text-lg font-semibold text-gray-700 mb-3"},Ke={class:"bg-white rounded-xl p-6 shadow-sm border"},Qe={class:"text-xl font-semibold text-gray-900 mb-6"},Ye={class:"mb-6 p-4 bg-gray-50 rounded-lg"},Ze={class:"text-sm text-gray-600"},Ie={key:0,class:"space-y-2 mb-3"},es={class:"font-medium text-gray-800 mb-1"},ss={class:"flex items-center justify-between"},ts={class:"text-gray-500 text-xs"},as={class:"text-gray-400 text-xs"},os={key:1,class:"text-xs text-gray-500 py-2"},ls={class:"mt-2"},is={class:"flex justify-end mt-8 pt-6 border-t border-gray-200"},rs={key:3,class:"mt-8"},ns={__name:"orders",setup(ds){const{t:o}=I({missingWarn:!1,fallbackWarn:!1}),k=ee(),C=y([]),M=y(!1),V=y(1),P=y(10),N=y(0),r=y({}),T=y(null),h=y({}),f=y({}),j=y({}),E=y({}),G=i=>{const t=i==null?void 0:i.toLowerCase();return t.includes("pending")||t.includes("معلق")||t.includes("مرتجع")?"warning":t.includes("completed")||t.includes("delivered")||t.includes("مدفوع")?"success":t.includes("cancelled")||t.includes("ملغى")?"danger":t.includes("reverted")?"info":"secondary"},D=async()=>{var i,t,s;M.value=!0;try{const c=await A.get(`/api/order?page=${V.value}&limit=${P.value}`);c.data.success&&(C.value=c.data.data,N.value=((i=c.data.pagination)==null?void 0:i.total)||C.value.length,P.value=((t=c.data.pagination)==null?void 0:t.per_page)||P.value,V.value=((s=c.data.pagination)==null?void 0:s.current_page)||V.value,r.value={},h.value={},f.value={},j.value={})}catch{k.add({severity:"error",summary:o("error"),detail:o("orders.fetchError"),life:3e3})}finally{M.value=!1}},X=async(i,t)=>{var s;if(!((s=r.value[t])!=null&&s.data)){r.value[t]={loading:!0};try{const c=await A.get(`/api/order/${t}`);if(c.data.success){const g=c.data.data;g.items=g.items.map(p=>({...p,comments:p.comments||[]})),g.comments=g.comments||[],r.value[t]={loading:!1,data:g,error:!1},h.value[t]||(h.value[t]=""),g.items.forEach(p=>{f.value[p.id]||(f.value[p.id]="")})}}catch{r.value[t]={loading:!1,error:!0},k.add({severity:"error",summary:o("error"),detail:o("orders.detailsError"),life:3e3})}}},W=i=>{var s,c,g;return(s=h.value[i])!=null&&s.trim()?!0:(((g=(c=r.value[i])==null?void 0:c.data)==null?void 0:g.items)||[]).some(p=>{var w;return(w=f.value[p.id])==null?void 0:w.trim()})},J=async i=>{var c,g,p,w;if(!W(i)){k.add({severity:"warn",summary:"تحذير",detail:"لا توجد تعليقات لإرسالها",life:3e3});return}j.value[i]=!0;const t=[];(c=h.value[i])!=null&&c.trim()&&t.push({body:h.value[i].trim()});const s=r.value[i].data.items;s.forEach(v=>{var n;(n=f.value[v.id])!=null&&n.trim()&&t.push({order_item_id:v.id,body:f.value[v.id].trim()})});try{const v=await A.post(`/api/order/comments/${i}`,{comments:t});v.data.success&&((((g=v.data.data)==null?void 0:g.comments)||[]).forEach(x=>{if(x.order_item_id){const _=s.find(Y=>Y.id===x.order_item_id);_&&_.comments.push({...x,is_you:!0})}else r.value[i].data.comments.push({...x,is_you:!0})}),h.value[i]="",s.forEach(x=>{f.value[x.id]=""}),k.add({severity:"success",summary:o("success"),detail:o("orders.commentsSentSuccess"),life:3e3}))}catch(v){k.add({severity:"error",summary:o("error"),detail:((w=(p=v.response)==null?void 0:p.data)==null?void 0:w.message)||o("orders.commentsSendError"),life:3e3}),console.error("Send all comments error:",v)}finally{j.value[i]=!1}},K=async i=>{if(!E.value[i]){E.value[i]=!0;try{await A.post(`/api/order/revert/${i}`),k.add({severity:"success",summary:o("success"),detail:o("orders.revertSuccess"),life:3e3}),D()}catch{k.add({severity:"error",summary:o("error"),detail:o("orders.revertError"),life:3e3})}finally{E.value[i]=!1}}},Q=i=>{V.value=i.page+1,P.value=i.rows,T.value=null,D()},S=i=>i?new Date(i).toLocaleDateString(o("locale")==="ar"?"ar-EG":"en-US",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):o("orders.invalidDate");return D(),(i,t)=>(d(),u("div",ne,[e("div",de,[e("div",ce,[e("h2",ue,l(a(o)("orders.title")),1),e("button",{onClick:D,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center gap-2"},[t[1]||(t[1]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),b(" "+l(a(o)("refresh")),1)])]),M.value?(d(),u("div",me,[m(a(F),{style:{width:"60px",height:"60px"},strokeWidth:"4",class:"text-indigo-500"})])):!M.value&&C.value.length===0?(d(),u("div",ge,[t[2]||(t[2]=e("svg",{class:"mx-auto w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h18M3 3v18M3 3l18 18M3 21h18M3 21l18-18"})],-1)),e("p",pe,l(a(o)("orders.empty")),1)])):(d(),u("div",ve,[m(a(le),{activeIndex:T.value,onTabOpen:t[0]||(t[0]=s=>X(s.index,C.value[s.index].id))},{default:$(()=>[(d(!0),u(z,null,O(C.value,s=>(d(),R(a(oe),{key:s.id},{header:$(()=>[e("div",_e,[e("span",ye,l(s.number),1),e("span",he,l(S(s.created_at)),1),e("span",fe,l(s.warehouse.name),1),e("span",{class:U(["px-3 py-1 text-xs font-semibold rounded-full  capitalize",{"bg-green-500":s.status_description==="delivered"||s.status_description==="مدفوع","bg-red-500":s.status_description==="cancelled"||s.status_description==="ملغى","bg-blue-500":s.status_description==="reverted"||s.status_description==="مرتجع","bg-yellow-500":s.status_description==="pending"||s.status_description==="معلق"}])},l(a(o)(`${s.status_description}`)||s.status_description),3),e("span",xe,l(s.total_price)+" ج.م",1),e("button",{onClick:se(c=>K(s.id),["stop"]),class:"px-3 py-1 bg-green-600 text-white text-xs font-semibold rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center gap-2",disabled:E.value[s.id]},[E.value[s.id]?(d(),u("svg",we,[...t[3]||(t[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(d(),u("svg",ke,[...t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"},null,-1)])])),b(" "+l(a(o)("sell")),1)],8,be)])]),default:$(()=>{var c,g,p,w,v;return[(c=r.value[s.id])!=null&&c.loading?(d(),u("div",Ce,[m(a(F),{style:{width:"40px",height:"40px"},strokeWidth:"4",class:"text-indigo-500"})])):(g=r.value[s.id])!=null&&g.error?(d(),u("div",Pe,l(a(o)("orders.detailsError")),1)):(p=r.value[s.id])!=null&&p.data?(d(),u("div",$e,[e("div",Le,[e("div",Ve,[e("p",null,[e("strong",je,l(a(o)("orders.id"))+":",1),b(" "+l(r.value[s.id].data.number),1)]),e("p",null,[e("strong",Ee,l(a(o)("orders.date"))+":",1),b(" "+l(S(r.value[s.id].data.created_at)),1)]),e("p",null,[e("strong",Me,l(a(o)("orders.pharmacy"))+":",1),b(" "+l(r.value[s.id].data.pharmacy.name),1)]),e("p",null,[e("strong",De,l(a(o)("orders.warehouse"))+":",1),b(" "+l(r.value[s.id].data.warehouse.name),1)])]),e("div",Se,[e("p",null,[e("strong",Be,l(a(o)("orders.totalPrice"))+":",1),t[5]||(t[5]=b()),e("span",Ae,l(r.value[s.id].data.total_price)+" ج.م",1)]),e("p",null,[e("strong",Ue,l(a(o)("orders.totalDiscounts"))+":",1),b(" "+l(r.value[s.id].data.total_discounts)+" ج.م",1)]),e("p",null,[e("strong",ze,l(a(o)("orders.delivery"))+":",1),b(" "+l(r.value[s.id].data.delivery)+" ج.م",1)]),e("p",null,[m(a(H),{value:r.value[s.id].data.status_description,severity:G(r.value[s.id].data.status_description),class:"ml-2"},null,8,["value","severity"])])])]),t[7]||(t[7]=e("hr",{class:"border-gray-200"},null,-1)),e("div",Oe,[(w=r.value[s.id].data.comments)!=null&&w.length?(d(),u("div",Re,[(d(!0),u(z,null,O(r.value[s.id].data.comments,n=>(d(),u("div",{key:n.id,class:U(["p-4 rounded-lg shadow-sm flex justify-between items-start",n.is_you?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200"])},[e("div",He,[e("p",Ne,l(n.body),1),e("div",Te,[e("span",We,l(n.is_you?a(o)("orders.you"):a(o)("orders.warehouseUser")),1),e("span",Fe,l(S(n.created_at)),1)])]),e("div",qe,[n.is_you?(d(),R(a(H),{key:0,value:"أنت",severity:"info",class:"text-xs"})):B("",!0)])],2))),128))])):(d(),u("div",Ge,[t[6]||(t[6]=e("i",{class:"pi pi-comments text-4xl mb-3 text-gray-300"},null,-1)),e("p",null,l(a(o)("orders.noOrderComments")),1)])),e("div",Xe,[e("h4",Je,l(a(o)("orders.addOrderComment")),1),m(a(q),{modelValue:h.value[s.id],"onUpdate:modelValue":n=>h.value[s.id]=n,placeholder:a(o)("orders.orderCommentPlaceholder"),rows:"3",class:"w-full",autoResize:""},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),t[8]||(t[8]=e("hr",{class:"border-gray-200"},null,-1)),e("div",Ke,[e("h3",Qe,l(a(o)("orders.items")),1),e("div",Ye,[e("p",Ze,l(a(o)("orders.totalItems"))+": "+l(((v=r.value[s.id].data.items)==null?void 0:v.length)||0),1)]),m(a(te),{value:r.value[s.id].data.items,responsiveLayout:"scroll",class:"p-datatable-sm",stripedRows:""},{default:$(()=>[m(a(L),{field:"product.commercial_name",header:"اسم المنتج"}),m(a(L),{field:"quantity",header:"الكمية"},{body:$(({data:n})=>[e("span",{class:U({"text-green-600 font-bold":n.is_gift})},l(n.quantity)+" "+l(n.is_gift?"(هدية)":""),3)]),_:1}),m(a(L),{field:"original_price",header:"سعر الوحدة"}),m(a(L),{field:"total_discounts",header:"الخصومات"}),m(a(L),{field:"total_price",header:"الإجمالي"}),m(a(L),{header:"التعليقات",style:{width:"300px"}},{body:$(({data:n})=>{var x;return[(x=n.comments)!=null&&x.length?(d(),u("div",Ie,[(d(!0),u(z,null,O(n.comments,_=>(d(),u("div",{key:_.id,class:U(["p-2 rounded text-xs shadow-sm",_.is_you?"bg-blue-50 border border-blue-200":"bg-gray-50 border border-gray-200"])},[e("p",es,l(_.body),1),e("div",ss,[e("span",ts,l(_.is_you?a(o)("orders.you"):a(o)("orders.pharmacyUser")),1),e("span",as,l(S(_.created_at)),1)]),_.is_you?(d(),R(a(H),{key:0,value:"أنت",severity:"info",size:"small",class:"text-xs mt-1"})):B("",!0)],2))),128))])):(d(),u("div",os,"لا توجد تعليقات")),e("div",ls,[m(a(q),{modelValue:f.value[n.id],"onUpdate:modelValue":_=>f.value[n.id]=_,placeholder:a(o)("orders.itemCommentPlaceholder"),rows:"2",class:"w-full text-sm",autoResize:""},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]}),_:1})]),_:1},8,["value"])]),e("div",is,[m(a(ae),{label:a(o)("orders.sendAllComments"),icon:"pi pi-send",iconPos:"left",class:"p-button-lg p-button-success",loading:j.value[s.id],disabled:j.value[s.id]||!W(s.id),onClick:n=>J(s.id)},null,8,["label","loading","disabled","onClick"])])])):B("",!0)]}),_:2},1024))),128))]),_:1},8,["activeIndex"])])),C.value.length>0?(d(),u("div",rs,[m(a(ie),{rows:P.value,totalRecords:N.value,first:(V.value-1)*P.value,onPage:Q,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],class:"bg-white p-4 rounded-lg shadow-sm"},null,8,["rows","totalRecords","first"])])):B("",!0),m(a(re))])]))}},us=Z(ns,[["__scopeId","data-v-0f149521"]]);export{us as default};
