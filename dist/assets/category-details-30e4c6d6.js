import{_ as O,u as q,a as B,P as L,r as g,c as w,o as P,e as l,h as i,g as e,i as x,j as _,t as d,C as k,F as j,y as T,b as C,s as U,A as Q,Q as W,E as z,k as A}from"./index-2cd76906.js";const G={class:"bg-gray-100 min-h-screen"},M={class:"py-10 px-4 md:px-8 max-w-7xl mx-auto"},R={key:0,class:"flex justify-center py-20"},H={key:1,class:"text-center py-20"},I={class:"text-xl text-gray-600"},J={key:2,class:"space-y-8"},K={class:"bg-white rounded-2xl shadow-lg overflow-hidden"},X={class:"px-8 pb-8 -mt-10 relative"},Y={class:"bg-white rounded-2xl shadow-xl p-8"},Z={class:"text-4xl font-extrabold text-gray-900 mb-3"},ee={key:0,class:"text-lg text-gray-600 mb-6 leading-relaxed"},te={class:"flex items-center gap-4 bg-green-50 text-green-700 px-6 py-4 rounded-xl inline-flex"},se={class:"text-3xl font-bold"},ae={class:"ml-2 text-lg font-medium"},oe={class:"bg-white rounded-2xl shadow-lg overflow-hidden"},ne={class:"overflow-x-auto"},re={class:"w-full"},le={class:"divide-y divide-gray-200"},ie={class:"px-6 py-5"},de={class:"flex items-center gap-4"},ce=["src"],ue={class:"font-semibold text-gray-900 text-base"},_e={class:"px-6 py-5 text-gray-700"},pe={class:"px-6 py-5"},ge={class:"text-lg font-bold text-gray-900"},ye={class:"px-6 py-5"},ve={key:1,class:"text-gray-400 text-xs"},xe={class:"px-6 py-5"},me={class:"px-6 py-5"},fe={key:0,class:"text-center py-16 text-gray-500"},he={class:"text-xl"},be={__name:"category-details",setup(we){const{t:c}=q(),y=B(),$=L(),a=g(null),m=g(!0),h=g(localStorage.getItem("appLang")||"en"),p=g({}),v=g({}),D=w(()=>a.value?h.value==="en"?a.value.name_en||a.value.name_ar:a.value.name_ar||a.value.name_en:""),b=w(()=>a.value?h.value==="en"?a.value.description_en||a.value.description_ar||"":a.value.description_ar||a.value.description_en||"":""),E=o=>Number(o).toLocaleString("en-US"),f=o=>{if(!o||o.length===0)return null;const t=new Date,s=o.filter(n=>{const V=new Date(n.start_date),N=new Date(n.end_date);return n.status==="active"&&t>=V&&t<=N});if(s.length===0)return null;const u=s.find(n=>n.discount_type===2);if(u)return{type:"discount",value:`${u.discount_value}% OFF`};const r=s.find(n=>n.discount_type===3&&n.quantity);return r?{type:"bonus",value:`Buy ${r.min_limit}, Get ${r.quantity} Free`}:{type:"offer",value:"Special Offer"}},F=async o=>{try{m.value=!0;const t=await C.get(`api/pharmacy-home/category/${o}`);if(t.data.success)a.value={...t.data.data,total_products:t.data.data.paginated_products.total},t.data.data.paginated_products.data.forEach(s=>{p.value[s.id]=1});else throw new Error("Failed to load category")}catch(t){y.add({severity:"error",summary:c("error")||"Error",detail:c("error.fetchCategory")||"Could not load category details",life:4e3}),console.error("Error fetching category:",t)}finally{m.value=!1}},S=async o=>{var s,u;const t=p.value[o]||1;if(t<1){y.add({severity:"warn",summary:"Warning",detail:"Quantity must be at least 1",life:3e3});return}v.value[o]=!0;try{const r=await C.post("/api/cart/add/item",{product_id:o,quantity:t});if(r.data.success)y.add({severity:"success",summary:c("success")||"Success",detail:`${t} × ${c("cart.addSuccess")||"Item(s) added to cart"}`,life:3e3}),p.value[o]=1;else throw new Error(r.data.message)}catch(r){const n=((u=(s=r.response)==null?void 0:s.data)==null?void 0:u.message)||r.message||"Failed to add to cart";y.add({severity:"error",summary:c("error"),detail:n,life:4e3})}finally{setTimeout(()=>{delete v.value[o]},1e3)}};return P(()=>{F($.params.id)}),(o,t)=>(l(),i("div",G,[e("div",M,[m.value?(l(),i("div",R,[x(_(U),{style:{width:"70px",height:"70px"},strokeWidth:"5"})])):a.value?(l(),i("div",J,[e("div",K,[t[2]||(t[2]=e("div",{class:"bg-gradient-to-r from-green-600 to-green-700 h-32"},null,-1)),e("div",X,[e("div",Y,[e("h1",Z,d(D.value),1),b.value?(l(),i("p",ee,d(b.value),1)):k("",!0),e("div",te,[t[1]||(t[1]=e("i",{class:"pi pi-box text-3xl"},null,-1)),e("div",null,[e("span",se,d(a.value.total_products),1),e("span",ae,d(_(c)("number_of_products")||"Products"),1)])])])])]),e("div",oe,[t[4]||(t[4]=e("div",{class:"p-6 border-b border-gray-200 bg-gray-50"},null,-1)),e("div",ne,[e("table",re,[e("tbody",le,[(l(!0),i(j,null,T(a.value.paginated_products.data,s=>{var u,r;return l(),i("tr",{key:s.id,class:"hover:bg-gray-50 transition duration-150"},[e("td",ie,[e("div",de,[e("img",{src:((u=s.media[0])==null?void 0:u.url)||"https://via.placeholder.com/64",alt:"Product",class:"w-14 h-14 rounded-lg object-cover border shadow-sm"},null,8,ce),e("div",null,[e("div",ue,d(s.commercial_name),1)])])]),e("td",_e,d(((r=s.company)==null?void 0:r.name)||"—"),1),e("td",pe,[e("span",ge," $"+d(E(s.price)),1)]),e("td",ye,[f(s.active_offers)?(l(),i("span",{key:0,class:Q(["inline-flex items-center px-3 py-1.5 rounded-full text-xs font-bold",f(s.active_offers).type==="discount"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},d(f(s.active_offers).value),3)):(l(),i("span",ve,"—"))]),e("td",xe,[x(_(W),{modelValue:p.value[s.id],"onUpdate:modelValue":n=>p.value[s.id]=n,min:1,max:999,inputClass:"text-center font-medium"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",me,[x(_(z),{icon:v.value[s.id]?"pi pi-spin pi-spinner":"pi pi-shopping-cart",loading:v.value[s.id],class:"bg-green-600 hover:bg-green-700 text-white font-medium px-5",onClick:n=>S(s.id)},null,8,["icon","loading","onClick"])])])}),128))])]),a.value.paginated_products.data.length===0?(l(),i("div",fe,[t[3]||(t[3]=e("i",{class:"pi pi-inbox text-6xl mb-4 text-gray-300"},null,-1)),e("p",he,d(_(c)("no_products_found")||"No products found in this category"),1)])):k("",!0)])])])):(l(),i("div",H,[t[0]||(t[0]=e("i",{class:"pi pi-exclamation-triangle text-6xl text-gray-400 mb-4"},null,-1)),e("p",I,d(_(c)("error.noCategory")||"Category not found"),1)])),x(_(A))])]))}},Ce=O(be,[["__scopeId","data-v-75e4606f"]]);export{Ce as default};
