import{_ as Q,e as X,s as Z,O as ee,u as ae,r as c,a as te,Y as d,f as g,g as b,m as l,t as r,z as n,j as le,B as F,q as h,x as V,v as w,F as oe,k as se,y as re}from"./index-b2b8894e.js";const ie={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},ne={class:"text-3xl font-bold text-center mb-8 text-gray-800"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ce={class:"space-y-2"},de={for:"category",class:"block text-sm font-medium text-gray-700"},pe={class:"space-y-2"},me={for:"company",class:"block text-sm font-medium text-gray-700"},_e={class:"space-y-2 relative"},ve={for:"commercial_name",class:"block text-sm font-medium text-gray-700"},fe={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ye={class:"py-1"},ge=["onClick"],be={class:"space-y-2 md:col-span-2"},he={for:"scientific_structure",class:"block text-sm font-medium text-gray-700"},xe={class:"space-y-2 md:col-span-2"},Ve={for:"usage",class:"block text-sm font-medium text-gray-700"},we={class:"space-y-2"},$e={for:"calibres",class:"block text-sm font-medium text-gray-700"},ke={class:"space-y-2"},qe={for:"quantity",class:"block text-sm font-medium text-gray-700"},Ue={class:"space-y-2"},De={for:"quantity_unit",class:"block text-sm font-medium text-gray-700"},Fe={class:"space-y-2"},Ie={for:"price",class:"block text-sm font-medium text-gray-700"},Ce={class:"space-y-2"},Te={for:"price_unit",class:"block text-sm font-medium text-gray-700"},Ne={class:"space-y-2"},Be={for:"expiration_from",class:"block text-sm font-medium text-gray-700"},Se={class:"space-y-2"},Re={for:"expiration_to",class:"block text-sm font-medium text-gray-700"},Le={class:"space-y-2 md:col-span-2"},Pe={for:"storage_notes",class:"block text-sm font-medium text-gray-700"},je={class:"space-y-2"},Ge={for:"pharmaceutical_form",class:"block text-sm font-medium text-gray-700"},Me={class:"md:col-span-2 space-y-2"},Oe={class:"block text-sm font-medium text-gray-700"},ze={class:"flex justify-center"},Ee={key:0,class:"p-4"},Ae={class:"relative group"},We=["src"],Je={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center rounded-lg transition-all"},Ye={class:"opacity-0 group-hover:opacity-100 flex space-x-3 transition-all"},He={class:"mt-2 text-center text-sm text-gray-500"},Ke={key:1,class:"p-8 flex flex-col items-center"},Qe={class:"text-sm text-center text-gray-600"},Xe={class:"text-blue-500 font-medium"},Ze={class:"pt-6 flex justify-center"},ea={__name:"update",setup(aa){const p=X(),S=Z(),I=ee(),{t:i}=ae(),$=c(!1),k=c([]),q=c([]),U=c([]),D=c(null),_=c(null),x=c(!1),v=c([]),f=c(!1),y=c({company_id:!1,commercial_name:!1,price:!1,price_unit:!1}),t=c({category_id:null,company_id:null,commercial_name:"",scientific_structure:[],usage:"",calibres:"",quantity:null,quantity_unit:null,price:null,price_unit:null,expiration_from:null,expiration_to:null,storage_notes:"",pharmaceutical_form:""}),R=async()=>{try{const[e,a,o]=await Promise.all([h.get("/api/category"),h.get("/api/company"),h.get("/api/scientific-structure")]);k.value=e.data.data||[],q.value=a.data.data||[],U.value=o.data.data||[]}catch{p.add({severity:"error",summary:i("error"),detail:i("error_fetching_data"),life:3e3})}},L=async()=>{var e;try{const o=(await h.get(`/api/product/${I.params.id}`)).data.data;t.value={category_id:o.category_id,company_id:o.company_id,commercial_name:o.commercial_name||"",scientific_structure:Array.isArray(o.scientific_structure)?o.scientific_structure.map(u=>u.name||u):[],usage:o.usage||"",calibres:o.calibres||"",quantity:o.quantity?Number(o.quantity):null,quantity_unit:o.quantity_unit,price:o.price?parseFloat(o.price):null,price_unit:o.price_unit,expiration_from:o.expiration_from,expiration_to:o.expiration_to,storage_notes:o.storage_notes||"",pharmaceutical_form:o.pharmaceutical_form||""},o.media&&((e=o.media[0])!=null&&e.url)&&(_.value=o.media[0].url),P()}catch{p.add({severity:"error",summary:i("error"),detail:i("error_fetching_product"),life:3e3})}},P=()=>{t.value.category_id&&!k.value.find(e=>e.id===t.value.category_id)&&k.value.push({id:t.value.category_id,name_ar:i("product.unknown_category")}),t.value.company_id&&!q.value.find(e=>e.id===t.value.company_id)&&q.value.push({id:t.value.company_id,name:i("product.unknown_company")}),t.value.scientific_structure.forEach(e=>{e&&!U.value.find(a=>a.name===e)&&U.value.push({name:e})})},j=async e=>{if(!e||e.length<2){v.value=[],f.value=!1;return}try{const a=await h.get(`/api/product/by/name?name=${encodeURIComponent(e)}`);v.value=(a.data.data||[]).filter(o=>o.commercial_name!==t.value.commercial_name),f.value=v.value.length>0}catch{p.add({severity:"error",summary:i("error"),detail:i("error_fetching_names"),life:3e3})}},G=e=>{t.value.commercial_name=e,v.value=[],f.value=!1},M=e=>{const a=e.target.value;t.value.commercial_name=a,j(a)},O=e=>{e.preventDefault(),x.value=!0},z=()=>{x.value=!1},E=e=>{if(e.size>1024*1024){p.add({severity:"warn",summary:i("warning"),detail:i("image_too_large"),life:3e3});return}D.value=e;const a=new FileReader;a.onload=o=>_.value=o.target.result,a.readAsDataURL(e),x.value=!1},C=e=>{var o,u,m;const a=((o=e.target.files)==null?void 0:o[0])||((m=(u=e.dataTransfer)==null?void 0:u.files)==null?void 0:m[0]);a&&a.type.startsWith("image/")?E(a):p.add({severity:"error",summary:i("error"),detail:i("invalid_image_type"),life:3e3})},A=()=>{D.value=null,_.value&&!_.value.startsWith("data:")||(_.value=null)},W=()=>{var e;return y.value={company_id:!t.value.company_id,commercial_name:!((e=t.value.commercial_name)!=null&&e.trim()),price:t.value.price===null||t.value.price<=0,price_unit:!t.value.price_unit},!Object.values(y.value).some(Boolean)},J=async()=>{var a,o;if(!W()){p.add({severity:"error",summary:i("error"),detail:i("validation_failed"),life:3e3});return}$.value=!0;const e=new FormData;e.append("_method","PUT"),e.append("category_id",t.value.category_id||""),e.append("company_id",t.value.company_id||""),e.append("commercial_name",t.value.commercial_name||""),t.value.scientific_structure.forEach((u,m)=>e.append(`scientific_structure[${m}]`,u)),e.append("usage",t.value.usage||""),e.append("calibres",t.value.calibres||""),e.append("quantity",t.value.quantity?Math.floor(t.value.quantity):""),e.append("quantity_unit",t.value.quantity_unit||""),e.append("price",t.value.price?Number(t.value.price).toFixed(2):""),e.append("price_unit",t.value.price_unit||""),e.append("expiration_from",t.value.expiration_from||""),e.append("expiration_to",t.value.expiration_to||""),e.append("storage_notes",t.value.storage_notes||""),e.append("pharmaceutical_form",t.value.pharmaceutical_form||""),D.value&&e.append("product_image",D.value);try{await h.post(`/api/product/${I.params.id}`,e,{headers:{"Content-Type":"multipart/form-data"}}),p.add({severity:"success",summary:i("success"),detail:i("product_updated"),life:3e3}),S.push({name:"products"})}catch(u){const m=((o=(a=u.response)==null?void 0:a.data)==null?void 0:o.message)||i("error_updating_product");p.add({severity:"error",summary:i("error"),detail:m,life:5e3})}finally{$.value=!1}};return te(()=>{R(),L()}),(e,a)=>{const o=d("Dropdown"),u=d("InputText"),m=d("MultiSelect"),T=d("Textarea"),N=d("InputNumber"),B=d("Calendar"),Y=d("Button"),H=d("Form"),K=d("Toast");return g(),b("div",ie,[l("h1",ne,r(e.$t("product.update_product")),1),n(H,{onSubmit:F(J,["prevent"]),class:"space-y-6"},{default:le(()=>[l("div",ue,[l("div",ce,[l("label",de,r(e.$t("product.category")),1),n(o,{filter:"",id:"category",modelValue:t.value.category_id,"onUpdate:modelValue":a[0]||(a[0]=s=>t.value.category_id=s),options:k.value,optionLabel:"name_ar",optionValue:"id",placeholder:e.$t("product.select_category"),class:"w-full"},null,8,["modelValue","options","placeholder"])]),l("div",pe,[l("label",me,[V(r(e.$t("product.company"))+" ",1),a[16]||(a[16]=l("span",{class:"text-red-500"},"*",-1))]),n(o,{filter:"",id:"company",modelValue:t.value.company_id,"onUpdate:modelValue":a[1]||(a[1]=s=>t.value.company_id=s),options:q.value,optionLabel:"name",optionValue:"id",placeholder:e.$t("product.select_company"),class:w(["w-full",{"p-invalid":y.value.company_id}])},null,8,["modelValue","options","placeholder","class"])]),l("div",_e,[l("label",ve,[V(r(e.$t("product.commercial_name"))+" ",1),a[17]||(a[17]=l("span",{class:"text-red-500"},"*",-1))]),n(u,{id:"commercial_name",modelValue:t.value.commercial_name,"onUpdate:modelValue":a[2]||(a[2]=s=>t.value.commercial_name=s),placeholder:e.$t("product.enter_commercial_name"),class:w(["w-full",{"p-invalid":y.value.commercial_name}]),onInput:M,onFocus:a[3]||(a[3]=s=>f.value=v.value.length>0),onBlur:a[4]||(a[4]=s=>e.setTimeout(()=>f.value=!1,200))},null,8,["modelValue","placeholder","class"]),f.value?(g(),b("div",fe,[l("ul",ye,[(g(!0),b(oe,null,se(v.value,s=>(g(),b("li",{key:s.id,onClick:ta=>G(s.commercial_name),class:"px-4 py-2 text-sm hover:bg-blue-50 cursor-pointer"},r(s.commercial_name),9,ge))),128))])])):re("",!0)]),l("div",be,[l("label",he,r(e.$t("product.scientific_structure")),1),n(m,{id:"scientific_structure",modelValue:t.value.scientific_structure,"onUpdate:modelValue":a[5]||(a[5]=s=>t.value.scientific_structure=s),options:U.value,optionLabel:"name",optionValue:"name",placeholder:e.$t("product.select_scientific_structure"),display:"chip",class:"w-full"},null,8,["modelValue","options","placeholder"])]),l("div",xe,[l("label",Ve,r(e.$t("product.usage")),1),n(T,{id:"usage",modelValue:t.value.usage,"onUpdate:modelValue":a[6]||(a[6]=s=>t.value.usage=s),placeholder:e.$t("product.enter_usage"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",we,[l("label",$e,r(e.$t("product.calibres")),1),n(u,{id:"calibres",modelValue:t.value.calibres,"onUpdate:modelValue":a[7]||(a[7]=s=>t.value.calibres=s),placeholder:e.$t("product.enter_calibres"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",ke,[l("label",qe,r(e.$t("product.quantity")),1),n(N,{id:"quantity",modelValue:t.value.quantity,"onUpdate:modelValue":a[8]||(a[8]=s=>t.value.quantity=s),useGrouping:!1,min:1,class:"w-full"},null,8,["modelValue"])]),l("div",Ue,[l("label",De,r(e.$t("product.quantity_unit")),1),n(o,{id:"quantity_unit",modelValue:t.value.quantity_unit,"onUpdate:modelValue":a[9]||(a[9]=s=>t.value.quantity_unit=s),options:[{label:"Tablets",value:1},{label:"Capsules",value:2},{label:"Units",value:3}],optionLabel:"label",optionValue:"value",placeholder:e.$t("product.select_quantity_unit"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",Fe,[l("label",Ie,[V(r(e.$t("product.price"))+" ",1),a[18]||(a[18]=l("span",{class:"text-red-500"},"*",-1))]),n(N,{id:"price",modelValue:t.value.price,"onUpdate:modelValue":a[10]||(a[10]=s=>t.value.price=s),mode:"decimal",minFractionDigits:2,maxFractionDigits:2,min:.01,class:w(["w-full",{"p-invalid":y.value.price}])},null,8,["modelValue","class"])]),l("div",Ce,[l("label",Te,[V(r(e.$t("product.price_unit"))+" ",1),a[19]||(a[19]=l("span",{class:"text-red-500"},"*",-1))]),n(o,{id:"price_unit",modelValue:t.value.price_unit,"onUpdate:modelValue":a[11]||(a[11]=s=>t.value.price_unit=s),options:[{label:"USD",value:1},{label:"EUR",value:2},{label:"GBP",value:3}],optionLabel:"label",optionValue:"value",placeholder:e.$t("product.select_price_unit"),class:w(["w-full",{"p-invalid":y.value.price_unit}])},null,8,["modelValue","placeholder","class"])]),l("div",Ne,[l("label",Be,r(e.$t("product.expiration_from")),1),n(B,{id:"expiration_from",modelValue:t.value.expiration_from,"onUpdate:modelValue":a[12]||(a[12]=s=>t.value.expiration_from=s),dateFormat:"yy-mm-dd",showIcon:!0,manualInput:!1,class:"w-full"},null,8,["modelValue"])]),l("div",Se,[l("label",Re,r(e.$t("product.expiration_to")),1),n(B,{id:"expiration_to",modelValue:t.value.expiration_to,"onUpdate:modelValue":a[13]||(a[13]=s=>t.value.expiration_to=s),dateFormat:"yy-mm-dd",showIcon:!0,manualInput:!1,class:"w-full"},null,8,["modelValue"])]),l("div",Le,[l("label",Pe,r(e.$t("product.storage_notes")),1),n(T,{id:"storage_notes",modelValue:t.value.storage_notes,"onUpdate:modelValue":a[14]||(a[14]=s=>t.value.storage_notes=s),placeholder:e.$t("product.enter_storage_notes"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",je,[l("label",Ge,r(e.$t("product.pharmaceutical_form")),1),n(u,{id:"pharmaceutical_form",modelValue:t.value.pharmaceutical_form,"onUpdate:modelValue":a[15]||(a[15]=s=>t.value.pharmaceutical_form=s),placeholder:e.$t("product.enter_pharmaceutical_form"),class:"w-full"},null,8,["modelValue","placeholder"])]),l("div",Me,[l("label",Oe,r(e.$t("product.product_image")),1),l("div",ze,[l("label",{onDragover:F(O,["prevent"]),onDragleave:z,onDrop:F(C,["prevent"]),class:w([{"border-blue-500 bg-blue-50":x.value,"border-gray-300":!x.value},"cursor-pointer w-full max-w-md rounded-xl border-2 border-dashed transition-colors duration-300"])},[l("input",{type:"file",onChange:C,accept:"image/*",class:"hidden"},null,32),_.value?(g(),b("div",Ee,[l("div",Ae,[l("img",{src:_.value,alt:"Preview",class:"w-full h-64 object-cover rounded-lg shadow-md group-hover:scale-105 transition-transform"},null,8,We),l("div",Je,[l("div",Ye,[l("button",{type:"button",onClick:F(A,["stop"]),class:"bg-red-500 text-white p-2 rounded-full hover:bg-red-600"},[...a[20]||(a[20]=[l("i",{class:"pi pi-trash text-sm"},null,-1)])]),a[21]||(a[21]=l("button",{type:"button",class:"bg-white text-gray-700 p-2 rounded-full hover:bg-gray-100"},[l("i",{class:"pi pi-pencil text-sm"})],-1))])])]),l("p",He,r(e.$t("product.click_or_drag_to_change_photo")),1)])):(g(),b("div",Ke,[a[22]||(a[22]=l("div",{class:"bg-blue-100 p-4 rounded-full mb-4"},[l("i",{class:"pi pi-image text-blue-500 text-2xl"})],-1)),l("p",Qe,[l("span",Xe,r(e.$t("product.click_to_upload")),1),V(" "+r(e.$t("product.or_drag_and_drop")),1)]),a[23]||(a[23]=l("p",{class:"text-xs text-gray-400"},"SVG, PNG, JPG, GIF (max 1MB)",-1))]))],34)])])]),l("div",Ze,[n(Y,{type:"submit",label:e.$t("product.update_product"),icon:"pi pi-check",loading:$.value,disabled:$.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all"},null,8,["label","loading","disabled"])])]),_:1}),n(K)])}}},oa=Q(ea,[["__scopeId","data-v-50c36360"]]);export{oa as default};
