import{z as Z,u as G,a as Q,r as _,m as U,o as W,a8 as X,e as i,h as n,g as l,i as u,w as N,j as r,C as w,t as v,F as A,y as C,b as I,J as F,f as S,K as T,L as Y,E as B,M as j,N as ee,A as E,Z as ae,B as te,O as se}from"./index-2cd76906.js";const re={class:"min-h-screen bg-gray-100 flex justify-center items-start p-4"},le={class:"w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden"},oe=["aria-selected"],ie=["aria-selected"],ne=["id"],de={key:0,class:"flex justify-end mb-4"},ce={key:1,class:"flex flex-col items-center justify-center h-64 text-gray-500"},ue={class:"text-lg"},me={key:2,class:"space-y-4"},_e={class:"flex justify-between items-start p-4"},ve={key:3,class:"space-y-4"},pe=["onClick","aria-label"],ge={class:"flex justify-between items-center"},he={class:"flex-1 min-w-0"},fe=["aria-label"],ye={class:"items-center mx-4"},xe={class:"text-gray-400 text-sm flex-shrink-0"},be={key:0,class:"mt-2 text-xs text-gray-500"},ke={key:4,class:"flex flex-col items-center justify-center h-64 text-gray-500"},we={class:"text-lg"},Ne={__name:"index",setup($e){const L=Z(),{t:s}=G(),x=Q(),h=_(!0),f=_(null),$=()=>({data:[],total:0,unread_count:0,current_page:1,last_page:1}),c=_($()),p=_($()),y=_($()),o=_(0),R=_([]),b=_(1),P=_(10),V=e=>{if(!e)return"";const a=new Date,d=new Date(e),t=Math.floor((a-d)/(1e3*60)),m=Math.floor(t/60);return m>0?`${s("since")||"since"} ${m} ${s("hours_ago")||"hours ago"}`:t>0?`${s("since")||"since"} ${t} ${s("minutes_ago")||"minutes ago"}`:s("just_now")||"just now"},O=e=>{const a=d=>{const t=e[d]||{},m=t.data||[];return{data:m,total:t.total||0,unread_count:m.filter(g=>!g.read_at).length,current_page:t.current_page||1,last_page:t.last_page||1}};c.value=a("admin_notifications"),p.value=a("pharmacy_notifications"),y.value=a("warehouse_notifications")},M=()=>{let e;switch(o.value){case 0:e=c.value;break;case 1:e=p.value;break;case 2:e=y.value;break;default:e=$()}R.value=e.data,b.value=e.current_page},k=async(e=1)=>{h.value=!0,f.value=null;try{const a=await I.get(`/api/notification/get?page=${e}&per_page=${P.value}`);h.value=!1,O(a.data.data),M()}catch(a){h.value=!1,f.value=a.message||s("notification.loadError")||"Failed to load notifications.",x.add({severity:"error",summary:s("error"),detail:f.value,life:3e3}),console.error("Error fetching data:",a)}},z=async e=>{if(!e.read_at)try{await I.post(`/api/notification/read/${e.id}`),e.read_at=new Date().toISOString(),c.value.unread_count=c.value.data.filter(a=>!a.read_at).length,p.value.unread_count=p.value.data.filter(a=>!a.read_at).length,y.value.unread_count=y.value.data.filter(a=>!a.read_at).length,x.add({severity:"success",summary:s("success"),detail:s("notification.markedRead")||"Notification marked as read.",life:1500})}catch(a){x.add({severity:"error",summary:s("error"),detail:s("notification.markAsReadError")||"Failed to mark notification as read.",life:3e3}),console.error("Error marking notification as read:",a)}},q=async()=>{h.value=!0;try{const e=o.value===0?"admin":o.value===1?"pharmacy":o.value===2?"warehouse":null;if(!e)return;await I.post(`/api/notification/read-all?type=${e}`);const a=e==="admin"?c:e==="pharmacy"?p:y;a.value.data.forEach(d=>d.read_at=d.read_at||new Date().toISOString()),a.value.unread_count=0,x.add({severity:"success",summary:s("success"),detail:s("notification.markedAllRead")||"All notifications marked as read.",life:3e3}),k(b.value)}catch(e){x.add({severity:"error",summary:s("error"),detail:s("notification.markAllReadError")||"Failed to mark all notifications as read.",life:3e3}),console.error("Error marking all notifications as read:",e)}finally{}},H=e=>{var d,t,m;z(e);const a=e.redirect_id||((d=e.metadata)==null?void 0:d[e.redirect_type.split("_")[0]+"_id"]);if(e.type==="pharmacy")if(e.redirect_type==="order_item_comment"){const g=(t=e.metadata)==null?void 0:t.order_id,D=(m=e.metadata)==null?void 0:m.comment_id;g&&D?L.push({name:"order_show",params:{id:g}}):console.warn("Pharmacy Comment Notification is missing required metadata.")}else e.redirect_type==="order_created"&&a?L.push({name:"order_show",params:{id:a}}):console.log(`Pharmacy notification type ${e.redirect_type} not handled yet. Redirect ID: ${a}`);else console.log(`Default redirect for ${e.type} notification type: ${e.redirect_type}, ID: ${a}`)},J=e=>{o.value=e.index,k(1)},K=e=>{const a=e.page+1;b.value=a,k(a)};return U(o,M),W(()=>{k()}),(e,a)=>{const d=X("tooltip");return i(),n("div",re,[l("div",le,[u(r(Y),{"active-index":o.value,onTabChange:J,class:"bg-gradient-to-r from-[#43A167] to-[#8fd3a9]",role:"tablist"},{default:N(()=>[u(r(F),null,{header:N(()=>[l("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":o.value===0,"aria-controls":"admin-notifications"},[a[1]||(a[1]=l("i",{class:"pi pi-user text-xl"},null,-1)),l("span",null,v(r(s)("notifications.admin_messages")||"Admin Messages"),1),c.value.unread_count>0?(i(),S(r(T),{key:0,value:c.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):w("",!0)],8,oe)]),_:1}),u(r(F),null,{header:N(()=>[l("div",{class:"flex items-center gap-3 px-4 text-black font-semibold text-lg transition-colors rounded-t-lg",role:"tab","aria-selected":o.value===1,"aria-controls":"pharmacy-notifications"},[a[2]||(a[2]=l("i",{class:"pi pi-building text-xl"},null,-1)),l("span",null,v(r(s)("notifications.pharmacy_notes")||"Pharmacy Notes"),1),p.value.unread_count>0?(i(),S(r(T),{key:0,value:p.value.unread_count,severity:"danger",class:"bg-red-500 text-white"},null,8,["value"])):w("",!0)],8,ie)]),_:1})]),_:1},8,["active-index"]),l("div",{class:"p-6 bg-gray-50 min-h-[400px]",id:o.value===0?"admin-notifications":o.value===1?"pharmacy-notifications":"warehouse-notifications",role:"tabpanel"},[o.value===0&&c.value.total>0&&!h.value&&!f.value?(i(),n("div",de,[u(r(B),{label:r(s)("mark_all_read")||"Mark All As Read",icon:"pi pi-check-double",severity:"success",outlined:"",onClick:q,disabled:c.value.unread_count===0,class:"text-sm"},null,8,["label","disabled"])])):w("",!0),f.value?(i(),n("div",ce,[a[3]||(a[3]=l("i",{class:"pi pi-exclamation-triangle text-5xl mb-4 opacity-50"},null,-1)),l("p",ue,v(f.value),1),u(r(B),{label:r(s)("retry")||"Retry",icon:"pi pi-refresh",class:"mt-4",onClick:a[0]||(a[0]=t=>k(b.value))},null,8,["label"])])):h.value?(i(),n("div",me,[(i(),n(A,null,C(5,t=>u(r(ee),{key:t,class:"shadow-md rounded-lg"},{content:N(()=>[l("div",_e,[u(r(j),{width:"60%",height:"1.5rem",class:"rounded"}),u(r(j),{width:"15%",height:"1rem",class:"rounded"})]),u(r(j),{width:"90%",height:"1rem",class:"mt-2 mx-4 rounded"})]),_:1})),64))])):R.value.length>0?(i(),n("div",ve,[(i(!0),n(A,null,C(R.value,(t,m)=>(i(),n("div",{key:t.id,class:E(["notification-item p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer",{"bg-blue-50 border-l-4 border-[#43A167]":!t.read_at}]),onClick:g=>H(t),role:"button","aria-label":t.title||r(s)("no_title")},[l("div",ge,[l("div",he,[l("div",{class:E(["font-semibold text-lg truncate",{"text-gray-900":!t.read_at,"text-gray-500":t.read_at}])},v(t.title||r(s)("no_title")),3)]),o.value===0&&!t.read_at?ae((i(),n("i",{key:0,"aria-label":r(s)("mark_read")||"Mark as Read",class:"pi pi-check"},null,8,fe)),[[d,r(s)("mark_read")||"Mark as Read",void 0,{top:!0}]]):w("",!0),l("div",ye,[l("p",xe,v(V(t.created_at)),1)])]),l("div",{class:E(["mt-2 text-sm leading-relaxed",{"text-gray-700":!t.read_at,"text-gray-500":t.read_at}])},v(t.body||r(s)("no_body")),3),t.metadata?(i(),n("div",be,[(i(!0),n(A,null,C(t.metadata,(g,D)=>(i(),n("span",{key:D},[te(v(D)+": "+v(g),1),a[4]||(a[4]=l("br",null,null,-1))]))),128))])):w("",!0)],10,pe))),128)),u(r(se),{rows:P.value,totalRecords:o.value===0?c.value.total:o.value===1?p.value.total:y.value.total,first:(b.value-1)*P.value,onPage:K,template:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink"},null,8,["rows","totalRecords","first"])])):(i(),n("div",ke,[a[5]||(a[5]=l("i",{class:"pi pi-bell-slash text-5xl mb-4 opacity-50"},null,-1)),l("p",we,v(r(s)("notification.noData")||"No notifications in this section."),1)]))],8,ne)])])}}};export{Ne as default};
